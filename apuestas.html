<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Control de Apuestas Realizadas</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --success: #10b981; --danger: #ef4444; --gold: #fbbf24; --accent: #3b82f6; }
        * { box-sizing: border-box; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); padding: 15px; margin: 0; }
        .container { max-width: 600px; margin: auto; }
        
        .btn-nav { display: block; text-align: center; padding: 12px; color: var(--text); text-decoration: none; margin-bottom: 20px; border: 1px solid #334155; border-radius: 12px; font-size: 13px; font-weight: bold; background: var(--card); }

        /* DASHBOARD DE RENDIMIENTO REAL */
        .performance-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 25px; }
        .perf-card { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); padding: 15px; border-radius: 16px; border: 1px solid #334155; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .perf-label { font-size: 10px; text-transform: uppercase; color: #94a3b8; letter-spacing: 1px; margin-bottom: 5px; display: block; }
        .perf-val { font-size: 22px; font-weight: 800; }
        .val-pos { color: var(--success); }
        .val-neg { color: var(--danger); }

        h3 { font-size: 16px; color: var(--gold); border-left: 3px solid var(--gold); padding-left: 10px; margin: 25px 0 15px 0; }

        /* TARJETAS DE APUESTA */
        .bet-card { background: var(--card); border-radius: 14px; padding: 15px; margin-bottom: 12px; border: 1px solid #334155; border-left: 4px solid var(--gold); }
        .bet-header { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 8px; opacity: 0.7; }
        .bet-main { font-size: 15px; font-weight: 700; margin-bottom: 12px; color: var(--accent); }
        .bet-footer { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        .btn-action { border: none; padding: 12px; border-radius: 8px; font-weight: 800; font-size: 12px; cursor: pointer; text-transform: uppercase; }
        .btn-win { background: var(--success); color: white; }
        .btn-loss { background: var(--danger); color: white; }

        /* HISTORIAL */
        .history-list { background: var(--card); border-radius: 14px; overflow: hidden; border: 1px solid #334155; }
        .history-item { padding: 12px 15px; border-bottom: 1px solid #334155; display: flex; justify-content: space-between; align-items: center; font-size: 13px; }
        .history-item:last-child { border-bottom: none; }
        .res-tag { font-weight: 800; font-size: 11px; padding: 3px 8px; border-radius: 5px; }
        .tag-win { background: rgba(16, 185, 129, 0.15); color: var(--success); }
        .tag-loss { background: rgba(239, 68, 68, 0.15); color: var(--danger); }

        .btn-clear { width: 100%; margin-top: 20px; background: transparent; color: #475569; border: none; font-size: 11px; cursor: pointer; text-decoration: underline; }
    </style>
</head>
<body>
<div class="container">
    <a href="estrategia.html" class="btn-nav">‚Üê VOLVER AL PORTAFOLIO</a>

    <div class="performance-grid">
        <div class="perf-card">
            <span class="perf-label">Balance Real</span>
            <span id="realUnits" class="perf-val">0.00 u.</span>
        </div>
        <div class="perf-card">
            <span class="perf-label">ROI Real</span>
            <span id="realRoi" class="perf-val">0.0%</span>
        </div>
    </div>

    <h3>üéØ Apuestas Pendientes</h3>
    <div id="pendingBets"></div>

    <h3>üìú Historial (√öltimas 15)</h3>
    <div id="historyBets" class="history-list"></div>

    <button class="btn-clear" onclick="clearHistory()">Borrar Historial de Resultados</button>
</div>

<script>
function loadBets() {
    const bets = JSON.parse(localStorage.getItem('activeBets') || "[]");
    const pendingDiv = document.getElementById('pendingBets');
    const historyDiv = document.getElementById('historyBets');
    
    // C√°lculos de Dashboard
    let totalInvertido = 0;
    let balanceNeto = 0;
    
    bets.forEach(b => {
        if(b.estado !== 'PENDIENTE') {
            const stake = parseFloat(b.stake) || 0;
            const cuota = parseFloat(b.cuotaFinal) || 0;
            totalInvertido += stake;
            if(b.estado === 'WIN') {
                balanceNeto += (stake * cuota) - stake;
            } else {
                balanceNeto -= stake;
            }
        }
    });

    // Actualizar UI Dashboard
    const realRoi = totalInvertido > 0 ? ((balanceNeto / totalInvertido) * 100).toFixed(1) : "0.0";
    const unitsEl = document.getElementById('realUnits');
    const roiEl = document.getElementById('realRoi');
    
    unitsEl.innerText = `${balanceNeto >= 0 ? '+' : ''}${balanceNeto.toFixed(2)} u.`;
    unitsEl.className = `perf-val ${balanceNeto >= 0 ? 'val-pos' : 'val-neg'}`;
    
    roiEl.innerText = `${realRoi}%`;
    roiEl.className = `perf-val ${parseFloat(realRoi) >= 0 ? 'val-pos' : 'val-neg'}`;

    // Renderizar Pendientes
    const pending = bets.filter(b => b.estado === 'PENDIENTE');
    pendingDiv.innerHTML = pending.map((b, i) => `
        <div class="bet-card">
            <div class="bet-header">
                <span>${b.estrategia.toUpperCase()}</span> 
                <span>${b.fechaColocada}</span>
            </div>
            <div class="bet-main">${b.equipo} @${b.cuotaFinal}</div>
            <div style="font-size:11px; margin-bottom:12px; opacity:0.8;">Inversi√≥n: <b>${b.stake} unidades</b></div>
            <div class="bet-footer">
                <button class="btn-action btn-win" onclick="resolveBet('${b.fechaColocada}', 'WIN')">Ganada</button>
                <button class="btn-action btn-loss" onclick="resolveBet('${b.fechaColocada}', 'LOSS')">Perdida</button>
            </div>
        </div>
    `).join('') || "<p style='opacity:0.4; text-align:center; font-size:13px;'>No hay apuestas esperando resultado.</p>";

    // Renderizar Historial
    const history = bets.filter(b => b.estado !== 'PENDIENTE').reverse();
    historyDiv.innerHTML = history.slice(0, 15).map(b => {
        const profit = b.estado === 'WIN' ? (b.stake * b.cuotaFinal - b.stake) : -b.stake;
        return `
        <div class="history-item">
            <div>
                <div style="font-weight:bold;">${b.equipo}</div>
                <div style="font-size:10px; opacity:0.6;">@${b.cuotaFinal} ‚Ä¢ Stake ${b.stake}</div>
            </div>
            <div style="text-align:right;">
                <span class="res-tag ${b.estado==='WIN'?'tag-win':'tag-loss'}">${b.estado}</span>
                <div style="font-size:11px; font-weight:bold; margin-top:4px;" class="${profit >= 0 ? 'val-pos' : 'val-neg'}">
                    ${profit >= 0 ? '+' : ''}${profit.toFixed(2)}
                </div>
            </div>
        </div>
    `}).join('') || "<div style='padding:20px; text-align:center; opacity:0.3;'>Historial vac√≠o</div>";
}

function resolveBet(id, result) {
    let bets = JSON.parse(localStorage.getItem('activeBets') || "[]");
    const idx = bets.findIndex(b => b.fechaColocada === id);
    if(idx !== -1) {
        bets[idx].estado = result;
        localStorage.setItem('activeBets', JSON.stringify(bets));
        loadBets();
    }
}

function clearHistory() { 
    if(confirm('¬øDeseas borrar el historial de apuestas resueltas? (Las pendientes se mantendr√°n)')) { 
        let bets = JSON.parse(localStorage.getItem('activeBets') || "[]");
        bets = bets.filter(b => b.estado === 'PENDIENTE');
        localStorage.setItem('activeBets', JSON.stringify(bets));
        loadBets();
    }
}

window.onload = loadBets;
</script>
</body>
</html>
