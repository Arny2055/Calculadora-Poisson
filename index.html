<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Poisson • OU + BTTS — Futurista (con botón)</title>
<style>
  :root{
    --bg:#05070c; --bg2:#0a0f19; --panel:rgba(16,22,33,.65); --panel-solid:#121a29;
    --text:#eaf0ff; --muted:#9aa7ba; --border:#273246; --accent:#7fb3ff; --accent2:#67e3a1;
    --glow:#2b84ff; --shadow:0 20px 60px rgba(0,0,0,.45);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--text); font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
    background:
      radial-gradient(1200px 600px at 10% -10%, #1b2d52 0%, transparent 60%),
      radial-gradient(1000px 650px at 110% 10%, #113d2c 0%, transparent 55%),
      radial-gradient(800px 450px at 50% 110%, #1f183a 0%, transparent 55%),
      linear-gradient(180deg,var(--bg),var(--bg2));
    letter-spacing:.1px;
  }

  header{position:sticky;top:0;z-index:10;backdrop-filter:blur(8px);
    background:linear-gradient(90deg,rgba(10,16,28,.6),rgba(10,16,28,.35));
    border-bottom:1px solid var(--border);}
  .head{max-width:1120px;margin:0 auto;padding:18px 20px;display:flex;align-items:center;gap:14px}
  .logo{width:44px;height:44px;border-radius:14px;overflow:hidden;
    background:radial-gradient(160% 120% at 30% 20%, #8fc2ff 0%, #2b84ff 35%, #2662ff00 70%),
               radial-gradient(140% 120% at 75% 60%, #67e3a1 0%, #29c17a 40%, #2bff5500 75%);
    box-shadow:0 0 0 1px #2b5aa3, 0 10px 28px rgba(43,132,255,.45), inset 0 0 40px rgba(255,255,255,.06);}
  h1{margin:0;font-size:20px;font-weight:900;letter-spacing:.4px}
  .sub{font-size:12px;color:var(--muted)}

  main{max-width:1120px;margin:28px auto;padding:0 20px;display:grid;gap:22px}
  .card{background:var(--panel);border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);overflow:hidden}
  .card .bar{height:3px;background:linear-gradient(90deg,#2b84ff,#69e3a2,#9e7bff,#2b84ff);
    filter:saturate(130%);opacity:.9;background-size:200% 100%;animation:flow 8s linear infinite}
  @keyframes flow{0%{background-position:0 0}100%{background-position:200% 0}}
  .pad{padding:20px}

  h2{margin:0 0 12px 0;font-size:16px;letter-spacing:.2px;font-weight:800;color:#cfe1ff}
  .grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
  label{font-size:12px;color:var(--muted);display:block;margin:6px 0}
  input[type="number"]{
    width:100%;padding:12px;border:1px solid var(--border);border-radius:12px;background:#0e1523;color:var(--text);
    outline:none;font-size:14px;transition:border .15s, box-shadow .15s}
  input[type="number"]:focus{border-color:#3168ff;box-shadow:0 0 0 5px rgba(49,104,255,.12)}

  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
  .chip{padding:8px 10px;border-radius:999px;border:1px solid var(--border);background:#0e1523;color:#c9d6f3;
    font-size:12px;cursor:pointer;user-select:none;transition:all .15s}
  .chip:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(0,0,0,.3)}
  .chip.active{border-color:#3b66a8;background:#12223c}

  .range{display:flex;align-items:center;gap:12px}
  input[type="range"]{-webkit-appearance:none;appearance:none;width:100%;height:12px;border-radius:999px;
    background:linear-gradient(90deg,#1a3a66,#2b84ff);outline:none;box-shadow:inset 0 0 0 1px #21304a}
  input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:20px;height:20px;border-radius:50%;
    background:#fff;border:3px solid var(--glow);box-shadow:0 0 0 6px rgba(43,132,255,.18),0 10px 28px rgba(43,132,255,.35);cursor:pointer}

  /* Botón discreto, futurista */
  .actions{display:flex;justify-content:flex-end;margin-top:10px}
  .btn-ghost{
    position:relative; padding:10px 14px; border-radius:999px; border:1px solid #2a3a55; background:transparent;
    color:#cfe1ff; font-weight:700; font-size:13px; letter-spacing:.25px; cursor:pointer; overflow:hidden;
    transition:transform .12s, border-color .2s, color .2s;
  }
  .btn-ghost::before{
    content:""; position:absolute; inset:0; background:radial-gradient(120% 120% at 50% 0%, rgba(43,132,255,.18), transparent 60%);
    opacity:0; transition:opacity .25s;
  }
  .btn-ghost:hover{border-color:#3d5b8e; color:#ffffff}
  .btn-ghost:hover::before{opacity:1}
  .btn-ghost:active{transform:translateY(1px)}
  .btn-ghost .dot{
    width:8px;height:8px;border-radius:50%;background:#2b84ff;margin-right:8px;display:inline-block;box-shadow:0 0 12px rgba(43,132,255,.9)
  }

  /* KPIs */
  .kpis{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-top:10px}
  .kpi{background:linear-gradient(180deg,rgba(20,28,44,.85),rgba(14,20,35,.85));
    border:1px solid var(--border);border-radius:14px;padding:14px}
  .k{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px}
  .v{font-size:20px;font-weight:900;margin-top:6px;font-family:ui-monospace,Menlo,Consolas,monospace}

  /* Tablas */
  table{width:100%;border-collapse:collapse;margin-top:14px;border-radius:14px;overflow:hidden}
  thead th{font-size:11px;color:#c5cee0;text-transform:uppercase;letter-spacing:.6px;background:#0f1726;border-bottom:1px solid var(--border);padding:12px;text-align:right}
  thead th:first-child{text-align:left}
  tbody td{padding:12px;border-bottom:1px solid var(--border);text-align:right;font-size:14px}
  tbody tr:last-child td{border-bottom:none}
  tbody td:first-child{text-align:left}
  .mono{font-family:ui-monospace,Menlo,Consolas,monospace}

  .pillbar{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .pill{padding:8px 12px;border-radius:999px;border:1px solid #2b3a56;background:#0d1422;font-size:12px;color:#d7e4ff;
    box-shadow:inset 0 0 20px rgba(255,255,255,.03), 0 6px 20px rgba(0,0,0,.35)}
  .accent{color:#bcd8ff}
  .muted{font-size:12px;color:var(--muted);margin-top:10px}
</style>
</head>
<body>
  <header>
    <div class="head">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>Poisson — Over/Under (línea libre) + BTTS</h1>
        <div class="sub">Diseño futurista · Botón discreto · .0 / .5 / .25 / .75</div>
      </div>
    </div>
  </header>

  <main>
    <!-- Inputs -->
    <section class="card">
      <div class="bar"></div>
      <div class="pad">
        <h2>Parámetros</h2>
        <div class="grid">
          <div>
            <label>GF Local (λ<sub>H</sub>)</label>
            <input id="gfH" type="number" step="0.01" min="0" value="1.40"/>
          </div>
          <div>
            <label>GF Visitante (λ<sub>A</sub>)</label>
            <input id="gfA" type="number" step="0.01" min="0" value="1.60"/>
          </div>
          <div>
            <label>Línea OU (escribe o elige un preset)</label>
            <input id="line" type="number" step="0.25" min="0" value="2.50"/>
            <div class="chips" id="presets">
              <div class="chip">0.5</div><div class="chip">1.5</div><div class="chip active">2.5</div>
              <div class="chip">3.0</div><div class="chip">3.5</div>
              <div class="chip">2.25</div><div class="chip">2.75</div>
            </div>
          </div>
          <div>
            <label>Ajuste rápido de línea</label>
            <div class="range">
              <input id="lineRange" type="range" min="0" max="6" step="0.25" value="2.5"/>
              <span id="lineLbl" class="mono accent">2.50</span>
            </div>
          </div>
        </div>

        <div class="actions">
          <button id="calcBtn" class="btn-ghost" title="Calcular">
            <span class="dot"></span>Calcular
          </button>
        </div>

        <div class="kpis">
          <div class="kpi"><div class="k">λ<sub>H</sub> (local)</div><div class="v" id="kLamH">—</div></div>
          <div class="kpi"><div class="k">λ<sub>A</sub> (visita)</div><div class="v" id="kLamA">—</div></div>
          <div class="kpi"><div class="k">λ<sub>T</sub> (total)</div><div class="v" id="kLamT">—</div></div>
        </div>
        <div class="muted">Modelo: X~Pois(λ<sub>H</sub>), Y~Pois(λ<sub>A</sub>), N=X+Y~Pois(λ<sub>T</sub>=λ<sub>H</sub>+λ<sub>A</sub>).</div>
      </div>
    </section>

    <!-- OU -->
    <section class="card">
      <div class="bar"></div>
      <div class="pad">
        <h2>Over/Under — Línea <span class="mono" id="lineHead">—</span></h2>
        <div class="pillbar" id="summary"></div>
        <table>
          <thead><tr><th>Resultado</th><th class="mono">Over</th><th class="mono">Under</th></tr></thead>
          <tbody id="tbodyOU"><tr><td colspan="3" style="text-align:center;color:#9aa7ba;padding:18px">Ingresa datos y pulsa <b>Calcular</b></td></tr></tbody>
        </table>
        <table style="margin-top:10px">
          <thead><tr><th>Métrica</th><th class="mono">Over</th><th class="mono">Under</th></tr></thead>
          <tbody id="tbodyOU2"></tbody>
        </table>
        <div class="muted">Líneas .25/.75 usan descomposición asiática: 0.5×(k.0) + 0.5×(k±0.5).</div>
      </div>
    </section>

    <!-- BTTS -->
    <section class="card">
      <div class="bar"></div>
      <div class="pad">
        <h2>BTTS</h2>
        <table>
          <thead><tr><th>Mercado</th><th class="mono">Prob.</th><th class="mono">Cuota justa</th></tr></thead>
          <tbody id="tbodyBTTS"><tr><td colspan="3" style="text-align:center;color:#9aa7ba;padding:18px">Pulsa <b>Calcular</b></td></tr></tbody>
        </table>
      </div>
    </section>
  </main>

<script>
(function(){
  const $=s=>document.querySelector(s);

  // Poisson utils
  const fact=[1];
  function factorial(n){for(let i=fact.length;i<=n;i++)fact[i]=fact[i-1]*i;return fact[n]}
  function logFactorial(n){if(n<100)return Math.log(factorial(n));const x=n;return x*Math.log(x)-x+0.5*Math.log(2*Math.PI*x)}
  function pmf(k,l){if(l<=0)return (k===0)?1:0;if(k<100){return Math.exp(-l)*Math.pow(l,k)/factorial(k)}return Math.exp(-l + k*Math.log(l) - logFactorial(k))}
  function cdf(k,l){let s=0;for(let i=0;i<=k;i++)s+=pmf(i,l);return s}
  function fmtP(p){return (100*p).toFixed(2)+'%'}
  function toOdds(p){return (p<=0)?Infinity:(1/p)}
  function fmtO(o){return (o===Infinity)?'—':o.toFixed(2)}
  function clamp(x,lo,hi){return Math.max(lo,Math.min(hi,x))}

  // OU components
  function compOver(lamT,Lc){
    const k=Math.floor(Lc+1e-9), isHalf=Math.abs(Lc-(k+0.5))<1e-9;
    const Fk=cdf(k,lamT), Fk_1=cdf(k-1,lamT), pk=Fk-Fk_1;
    return isHalf ? {win:1-Fk, push:0,   loss:Fk}
                  : {win:1-Fk, push:pk,  loss:Fk_1};
  }
  function asianOver(lamT,L){
    const k=Math.floor(L), frac=+(L-k).toFixed(2);
    if(frac===0 || frac===0.5) return compOver(lamT,L);
    if(frac===0.25){const a=compOver(lamT,k), b=compOver(lamT,k+0.5);
      return {win:0.5*(a.win+b.win), push:0.5*(a.push+b.push), loss:0.5*(a.loss+b.loss)}}
    if(frac===0.75){const a=compOver(lamT,k+0.5), b=compOver(lamT,k+1.0);
      return {win:0.5*(a.win+b.win), push:0.5*(a.push+b.push), loss:0.5*(a.loss+b.loss)}}
    const nearest=Math.abs(frac-0.5)<Math.abs(frac-0)?(k+0.5):k; return compOver(lamT,nearest);
  }
  function asianUnder(lamT,L){const o=asianOver(lamT,L); return {win:o.loss,push:o.push,loss:o.win}}

  function calc(){
    const lamH=Math.max(0,+$('#gfH').value||0);
    const lamA=Math.max(0,+$('#gfA').value||0);
    let L=+$('#line').value||0; L=clamp(L,0,15);
    const lamT=lamH+lamA;

    // KPIs
    $('#kLamH').textContent=lamH.toFixed(2);
    $('#kLamA').textContent=lamA.toFixed(2);
    $('#kLamT').textContent=lamT.toFixed(2);
    $('#lineHead').textContent=L.toFixed(2);
    $('#lineLbl').textContent=L.toFixed(2);

    // activar chip si coincide
    document.querySelectorAll('.chip').forEach(ch=>{
      ch.classList.toggle('active', Math.abs(parseFloat(ch.textContent)-L)<1e-9);
    });

    // OU
    const over=asianOver(lamT,L), under=asianUnder(lamT,L);
    const pCashOver=over.win+0.5*over.push;
    const pCashUnder=under.win+0.5*under.push;

    $('#summary').innerHTML=`
      <span class="pill">Over <b class="mono">${fmtP(pCashOver)}</b> · cuota ${fmtO(1/Math.max(1e-12,pCashOver))}</span>
      <span class="pill">Under <b class="mono">${fmtP(pCashUnder)}</b> · cuota ${fmtO(1/Math.max(1e-12,pCashUnder))}</span>
      <span class="pill">Push <b class="mono">${fmtP(over.push)}</b></span>
    `;
    $('#tbodyOU').innerHTML=`
      <tr><td>Win</td><td class="mono">${fmtP(over.win)}</td><td class="mono">${fmtP(under.win)}</td></tr>
      <tr><td>Push</td><td class="mono">${fmtP(over.push)}</td><td class="mono">${fmtP(under.push)}</td></tr>
      <tr><td>Loss</td><td class="mono">${fmtP(over.loss)}</td><td class="mono">${fmtP(under.loss)}</td></tr>
    `;
    $('#tbodyOU2').innerHTML=`
      <tr><td>Prob. de cobrar (win + 0.5·push)</td><td class="mono">${fmtP(pCashOver)}</td><td class="mono">${fmtP(pCashUnder)}</td></tr>
      <tr><td>Cuota justa aprox.</td><td class="mono">${fmtO(1/Math.max(1e-12,pCashOver))}</td><td class="mono">${fmtO(1/Math.max(1e-12,pCashUnder))}</td></tr>
    `;

    // BTTS
    const pBTTS=1-Math.exp(-lamH)-Math.exp(-lamA)+Math.exp(-(lamT)), pNo=1-pBTTS;
    $('#tbodyBTTS').innerHTML=`
      <tr><td>BTTS Sí</td><td class="mono">${fmtP(pBTTS)}</td><td class="mono">${fmtO(toOdds(pBTTS))}</td></tr>
      <tr><td>BTTS No</td><td class="mono">${fmtP(pNo)}</td><td class="mono">${fmtO(toOdds(pNo))}</td></tr>
    `;
  }

  // Botón discreto
  $('#calcBtn').addEventListener('click', calc);

  // Presets y slider solo sincronizan inputs; cálculo ocurre al pulsar el botón
  $('#presets').addEventListener('click', e=>{
    const chip=e.target.closest('.chip'); if(!chip) return;
    const v=parseFloat(chip.textContent); $('#line').value=v; $('#lineRange').value=v;
    document.querySelectorAll('.chip').forEach(c=>c.classList.toggle('active', c===chip));
  });
  $('#lineRange').addEventListener('input', e=>{
    const v=parseFloat(e.target.value); $('#line').value=v; $('#lineLbl').textContent=v.toFixed(2);
  });
  // También sync número->label
  $('#line').addEventListener('input', e=>{
    const v=parseFloat(e.target.value||0); $('#lineRange').value=v; $('#lineLbl').textContent=v.toFixed(2);
  });

  // Enter para calcular desde cualquier input
  ['gfH','gfA','line'].forEach(id=>{
    document.getElementById(id).addEventListener('keydown', (ev)=>{ if(ev.key==='Enter'){ calc(); }});
  });
})();
</script>
</body>
</html>