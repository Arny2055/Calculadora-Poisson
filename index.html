<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Poisson - Melbourne Victory Edition</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; color: #333; padding: 20px; }
        .container { max-width: 900px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { color: #001e54; text-align: center; border-bottom: 3px solid #001e54; padding-bottom: 10px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .input-group { background: #eef2f7; padding: 15px; border-radius: 8px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; color: #001e54; }
        input { width: 90%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        button { width: 100%; padding: 12px; background-color: #001e54; color: white; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; transition: 0.3s; }
        button:hover { background-color: #003399; }
        .results { margin-top: 30px; display: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        th { background-color: #001e54; color: white; }
        .highlight { font-weight: bold; color: #d9534f; }
        .section-title { background: #001e54; color: white; padding: 10px; margin-top: 20px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="container">
    <h1>Análisis Poisson: Melbourne Victory</h1>
    
    <div class="grid">
        <div class="input-group">
            <h3>Local (Home)</h3>
            <label>Promedio Goles a Favor:</label>
            <input type="number" id="homeAttack" step="0.01" value="0.67">
            <label>Promedio Goles en Contra:</label>
            <input type="number" id="homeDefense" step="0.01" value="1.00">
        </div>
        <div class="input-group">
            <h3>Visitante (Away)</h3>
            <label>Promedio Goles a Favor:</label>
            <input type="number" id="awayAttack" step="0.01" value="0.83">
            <label>Promedio Goles en Contra:</label>
            <input type="number" id="awayDefense" step="0.01" value="1.50">
        </div>
    </div>

    <div class="input-group" style="margin-bottom: 20px;">
        <label>Promedio Goles Liga (League AVG):</label>
        <input type="number" id="leagueAvg" step="0.01" value="1.26">
    </div>

    <button onclick="calculatePoisson()">Calcular Probabilidades Over/Under</button>

    <div id="results" class="results">
        <div class="section-title">Resultados Tiempo Completo (FT)</div>
        <table>
            <thead>
                <tr>
                    <th>Mercado</th>
                    <th>Probabilidad</th>
                    <th>Cuota Estimada</th>
                </tr>
            </thead>
            <tbody id="ft-body"></tbody>
        </table>

        <div class="section-title">Resultados Primera Mitad (HT)</div>
        <p><small>*Estimación basada en la distribución histórica del 43% de goles en 1ra mitad según tus datos.</small></p>
        <table>
            <thead>
                <tr>
                    <th>Mercado</th>
                    <th>Probabilidad</th>
                    <th>Cuota Estimada</th>
                </tr>
            </thead>
            <tbody id="ht-body"></tbody>
        </table>
    </div>
</div>

<script>
function factorial(n) {
    if (n === 0) return 1;
    let res = 1;
    for (let i = 2; i <= n; i++) res *= i;
    return res;
}

function poisson(k, lambda) {
    return (Math.pow(lambda, k) * Math.exp(-lambda)) / factorial(k);
}

function calculatePoisson() {
    const hAttack = parseFloat(document.getElementById('homeAttack').value);
    const hDefense = parseFloat(document.getElementById('homeDefense').value);
    const aAttack = parseFloat(document.getElementById('awayAttack').value);
    const aDefense = parseFloat(document.getElementById('awayDefense').value);
    const lAvg = parseFloat(document.getElementById('leagueAvg').value);

    // Cálculo de Lambdas (Expectativa de goles)
    const expHomeFT = (hAttack / lAvg) * (aDefense / lAvg) * lAvg;
    const expAwayFT = (aAttack / lAvg) * (hDefense / lAvg) * lAvg;
    const totalExpFT = expHomeFT + expAwayFT;

    // HT Lambdas (basado en tendencia de Melbourne V: 43% goles en 1st Half)
    const expHomeHT = expHomeFT * 0.43;
    const expAwayHT = expAwayFT * 0.43;
    const totalExpHT = expHomeHT + expAwayHT;

    displayResults(totalExpFT, 'ft-body');
    displayResults(totalExpHT, 'ht-body');

    document.getElementById('results').style.display = 'block';
}

function displayResults(lambda, elementId) {
    const body = document.getElementById(elementId);
    body.innerHTML = '';

    const probs = [];
    for (let i = 0; i <= 10; i++) {
        probs[i] = poisson(i, lambda);
    }

    const targets = [0.5, 1.5, 2.5, 3.5];
    
    targets.forEach(t => {
        let probUnder = 0;
        for (let i = 0; i < t; i++) {
            probUnder += probs[i];
        }
        let probOver = 1 - probUnder;

        // Agregar filas Over
        addRow(body, `Over ${t}`, probOver);
        // Agregar filas Under
        addRow(body, `Under ${t}`, probUnder);
    });
}

function addRow(table, label, prob) {
    const row = table.insertRow();
    const cell1 = row.insertCell(0);
    const cell2 = row.insertCell(1);
    const cell3 = row.insertCell(2);

    const percentage = (prob * 100).toFixed(2);
    const odds = (1 / prob).toFixed(2);

    cell1.innerHTML = label;
    cell2.innerHTML = percentage + '%';
    cell3.innerHTML = odds;
    
    if (prob > 0.6) cell2.className = 'highlight';
}
</script>

</body>
</html>
