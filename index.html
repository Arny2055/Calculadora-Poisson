<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de ROI y Registro de Apuestas (O/U & BTTS)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
            color: #333;
        }
        .container {
            max-width: 950px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            text-align: center;
            color: #0056b3;
            margin-bottom: 20px;
        }
        /* Layout Principal */
        .grid-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .section-box {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #f9f9f9;
        }
        /* Entradas de Datos */
        .match-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }
        .match-row label {
            width: 70px;
            font-weight: bold;
            flex-shrink: 0;
        }
        .match-row input[type="number"], .match-row select {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .match-row input[type="number"] {
            width: 80px;
        }
        /* Estilos de SELECT y Resultado (Colores) */
        .match-row select {
            width: 100%;
            transition: background-color 0.3s, color 0.3s;
            font-weight: bold;
        }
        .result-won { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
        .result-lost { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        .result-default { background-color: #fff; color: #333; }
        
        /* Botones */
        button {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.2s;
        }
        #calc-roi-btn { background-color: #007bff; color: white; }
        #calc-roi-btn:hover { background-color: #0056b3; }
        #save-match-btn { background-color: #28a745; color: white; margin-top: 0;}
        #save-match-btn:hover { background-color: #1e7e34; }

        /* Resultados y Valor Esperado */
        #results, #value-output {
            margin-top: 10px;
            padding: 15px;
            border-radius: 6px;
            background-color: #e2f0e3;
            border: 2px solid #28a745;
        }
        .result-item { font-size: 1.1em; margin-bottom: 5px; }
        .positive { color: #155724; font-weight: bold; }
        .negative { color: #721c24; font-weight: bold; }
        .zero { color: #6c757d; font-weight: bold; }
        .value-section h3 { margin-top: 0; color: #ffc107; }
        
        /* Historial de Partidos */
        .history-section {
            grid-column: 1 / span 2; /* Ocupa ambas columnas */
            margin-top: 20px;
            padding: 15px;
            background-color: #e6f7ff;
            border: 1px solid #99d6ff;
            border-radius: 6px;
        }
        .history-section h2 { color: #007bff; margin-bottom: 10px; }
        #match-history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.9em;
        }
        #match-history-table th, #match-history-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        #match-history-table th {
            background-color: #007bff;
            color: white;
            font-size: 0.95em;
        }
        #total-roi-results {
            text-align: center;
            font-size: 1.2em;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #ccc;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>üìä Calculadora de ROI y Registro de Apuestas</h1>

        <section>
            <h2>üìù Datos para C√°lculo de ROI Hist√≥rico (Fijo: Stake 1)</h2>
            <p>Usa esta secci√≥n solo para el an√°lisis r√°pido de un historial fijo de **5 partidos** (Stake 1 unitario).</p>
            <div class="grid-layout">
                <div class="section-box">
                    <h3 style="color: #d9534f;">üè† Equipo Local</h3>
                    <div id="local-matches"></div>
                </div>

                <div class="section-box">
                    <h3 style="color: #0275d8;">‚úàÔ∏è Equipo Visitante</h3>
                    <div id="visitor-matches"></div>
                </div>
            </div>
            <button id="calc-roi-btn" onclick="calculateROI()">Calcular ROI Hist√≥rico</button>

            <div id="results" style="display: none;">
                <h3>‚úÖ Resultados del ROI Hist√≥rico</h3>
                <div class="result-item" id="roi-local"></div>
                <div class="result-item" id="roi-visitor"></div>
                <hr>
                <div class="result-item" id="roi-combined"></div>
            </div>
        </section>
        
        <hr style="margin: 30px 0;">

        <section class="grid-layout">
            <div class="section-box value-section">
                <h3 style="color: #ffc107;">üí∞ An√°lisis de Valor (+EV)</h3>
                <p>Calcula el valor esperado de una cuota vs. tu probabilidad real.</p>
                <div class="match-row">
                    <label for="next-quota">Cuota:</label>
                    <input type="number" id="next-quota" step="0.01" min="1.01" placeholder="Ej: 2.10">
                </div>
                <div class="match-row">
                    <label for="next-prob">Prob. Real:</label>
                    <input type="number" id="next-prob" step="0.01" min="0.01" max="0.99" placeholder="Ej: 0.50 (50%)">
                </div>
                <button onclick="calculateValue()">Calcular Valor Esperado</button>
                <div id="value-output" style="display: none;"></div>
            </div>
            
            <div class="section-box">
                <h3 style="color: #28a745;">üíæ Registrar Apuesta Real</h3>
                <p>**Usa esta secci√≥n para registrar TODAS tus apuestas de O/U y BTTS**.</p>
                <div class="match-row">
                    <label for="reg-market">Mercado:</label>
                    <select id="reg-market">
                        <option value="OU">Over/Under</option>
                        <option value="BTTS">BTTS</option>
                    </select>
                </div>
                <div class="match-row">
                    <label for="reg-stake">Stake:</label>
                    <input type="number" id="reg-stake" step="0.01" min="0.01" placeholder="Inversi√≥n (‚Ç¨/\$)">
                </div>
                <div class="match-row">
                    <label for="reg-quota">Cuota:</label>
                    <input type="number" id="reg-quota" step="0.01" min="1.01" placeholder="Cuota Apostada">
                </div>
                <div class="match-row">
                    <label for="reg-result">Resultado:</label>
                    <select id="reg-result" onchange="applyResultStyle(this)" class="result-default">
                        <option value="" selected disabled>-- Selecciona --</option>
                        <option value="1">Ganado</option>
                        <option value="0">Perdido</option>
                    </select>
                </div>
                <button id="save-match-btn" onclick="saveMatchToHistory()">Guardar Apuesta</button>
            </div>
        </section>

        <section class="history-section">
            <h2>üìú Historial de Apuestas (Stake Variable)</h2>
            <div id="total-roi-results">
                </div>
            <table id="match-history-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Mercado</th>
                        <th>Stake (‚Ç¨/\$)</th>
                        <th>Cuota</th>
                        <th>Resultado</th>
                        <th>Ganancia Neta (‚Ç¨/\$)</th>
                        <th>ROI (%)</th>
                    </tr>
                </thead>
                <tbody id="match-history-body">
                    </tbody>
            </table>
        </section>
    </div>

    <script>
        const NUM_MATCHES = 5;
        const INVESTMENT_PER_MATCH = 1; 
        const TOTAL_INVESTMENT_HISTORIC = NUM_MATCHES * INVESTMENT_PER_MATCH;
        
        let matchHistory = []; // Array para almacenar todos los partidos registrados

        // --- Funciones de Utilidad y Estilos ---

        /** Aplica la clase CSS de color seg√∫n el resultado seleccionado. */
        function applyResultStyle(selectElement) {
            const value = selectElement.value;
            selectElement.classList.remove('result-won', 'result-lost', 'result-default');
            
            if (value === '1') {
                selectElement.classList.add('result-won');
            } else if (value === '0') {
                selectElement.classList.add('result-lost');
            } else {
                selectElement.classList.add('result-default');
            }
        }

        /** Genera los campos de entrada para los 5 partidos hist√≥ricos (Stake 1). */
        function generateInputs(teamId, prefix) {
            const container = document.getElementById(teamId);
            let html = '';
            for (let i = 1; i <= NUM_MATCHES; i++) {
                html += `
                    <div class="match-row">
                        <label>P. ${i}:</label>
                        <input type="number" id="${prefix}-quota-${i}" step="0.01" min="1.01" placeholder="Cuota" value="2.00" required>
                        <select id="${prefix}-result-${i}" onchange="applyResultStyle(this)" class="result-default">
                            <option value="" selected disabled>Res.</option>
                            <option value="1">Gan.</option>
                            <option value="0">Per.</option>
                        </select>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        // --- L√≥gica de ROI Hist√≥rico (Stake 1) ---
        // (Mantenido solo para la secci√≥n de an√°lisis r√°pido)

        function calculateNetProfit(prefix) {
            let totalReturn = 0;
            for (let i = 1; i <= NUM_MATCHES; i++) {
                const quotaInput = document.getElementById(`${prefix}-quota-${i}`);
                const resultSelect = document.getElementById(`${prefix}-result-${i}`);
                
                if (!quotaInput.value || isNaN(parseFloat(quotaInput.value)) || resultSelect.value === "") {
                    return null;
                }
                
                const quota = parseFloat(quotaInput.value);
                const isWon = parseInt(resultSelect.value);

                if (isWon === 1) {
                    totalReturn += quota; 
                } 
            }
            return totalReturn - TOTAL_INVESTMENT_HISTORIC; 
        }

        function calculateROI() {
            const netProfitLocal = calculateNetProfit('local');
            const netProfitVisitor = calculateNetProfit('visitor');

            if (netProfitLocal === null || netProfitVisitor === null) {
                document.getElementById('results').style.display = 'none';
                alert('üö® Completa todos los 5 partidos (Cuota y Resultado) en ambas secciones para el c√°lculo hist√≥rico.');
                return;
            }

            const roiLocal = (netProfitLocal / TOTAL_INVESTMENT_HISTORIC) * 100;
            const roiVisitor = (netProfitVisitor / TOTAL_INVESTMENT_HISTORIC) * 100;
            const totalNetProfit = netProfitLocal + netProfitVisitor;
            const totalCombinedInvestment = TOTAL_INVESTMENT_HISTORIC * 2; 
            const roiCombined = (totalNetProfit / totalCombinedInvestment) * 100;

            document.getElementById('roi-local').innerHTML = formatResult('üè† ROI Local', roiLocal);
            document.getElementById('roi-visitor').innerHTML = formatResult('‚úàÔ∏è ROI Visitante', roiVisitor);
            document.getElementById('roi-combined').innerHTML = formatResult('‚ú® ROI Combinado', roiCombined);
            document.getElementById('results').style.display = 'block';
        }

        // --- L√≥gica de Valor Esperado (+EV) ---

        function calculateValue() {
            const quotaInput = document.getElementById('next-quota').value;
            const probInput = document.getElementById('next-prob').value;

            if (!quotaInput || !probInput) {
                alert('üö® Completa la cuota y la probabilidad real estimada.');
                document.getElementById('value-output').style.display = 'none';
                return;
            }

            const quota = parseFloat(quotaInput);
            const prob = parseFloat(probInput);
            
            if (quota <= 1.0 || prob <= 0 || prob >= 1) {
                alert('üö® Aseg√∫rate de que la cuota sea > 1.0 y la probabilidad real est√© entre 0.01 y 0.99.');
                document.getElementById('value-output').style.display = 'none';
                return;
            }
            
            const ev = (quota * prob) - 1;
            const evPercent = ev * 100;

            let evMessage = `**EV = ${ev.toFixed(4)}**`;
            let className = 'zero';

            if (ev > 0) {
                evMessage += `. Hay **VALOR POSITIVO** (${evPercent.toFixed(2)}%). ¬°Buena apuesta!`;
                className = 'positive';
            } else if (ev < 0) {
                evMessage += `. Hay **VALOR NEGATIVO** (${evPercent.toFixed(2)}%). Evitar esta apuesta.`;
                className = 'negative';
            } else {
                evMessage += `. El valor es neutral (0%).`;
            }

            document.getElementById('value-output').innerHTML = `<span class="${className}">${evMessage}</span>`;
            document.getElementById('value-output').style.display = 'block';
        }

        // --- L√≥gica de Registro de Partidos (Mejorado con Stake y Mercado) ---

        /** Guarda un partido en el historial y actualiza la tabla. */
        function saveMatchToHistory() {
            const market = document.getElementById('reg-market').value;
            const stakeInput = document.getElementById('reg-stake').value;
            const quotaInput = document.getElementById('reg-quota').value;
            const resultSelect = document.getElementById('reg-result').value;

            if (!stakeInput || !quotaInput || resultSelect === "") {
                alert('üö® Completa el Stake, la Cuota y el Resultado para guardar la apuesta.');
                return;
            }

            const stake = parseFloat(stakeInput);
            const quota = parseFloat(quotaInput);
            const isWon = parseInt(resultSelect);
            
            if (stake <= 0 || quota <= 1.0) {
                alert('üö® El Stake debe ser mayor a 0 y la Cuota mayor a 1.0.');
                return;
            }

            // C√°lculos del partido guardado
            // Retorno Bruto = Cuota * Stake si Gana, o 0 si Pierde
            const grossReturn = isWon === 1 ? (quota * stake) : 0; 
            // Ganancia Neta = Retorno Bruto - Inversi√≥n (Stake)
            const netProfit = grossReturn - stake; 
            // ROI = (Ganancia Neta / Stake) * 100
            const roi = (netProfit / stake) * 100; 

            const match = {
                id: matchHistory.length + 1,
                market: market,
                stake: stake,
                quota: quota,
                result: isWon,
                netProfit: netProfit,
                roi: roi
            };

            matchHistory.push(match);
            updateHistoryTable();

            // Limpiar campos y dar feedback
            document.getElementById('reg-stake').value = '';
            document.getElementById('reg-quota').value = '';
            document.getElementById('reg-result').value = ''; 
            document.getElementById('reg-result').classList.add('result-default');
            document.getElementById('reg-result').classList.remove('result-won', 'result-lost');
            alert(`‚úÖ Apuesta #${match.id} (${market}) guardada con √©xito.`);
        }

        /** Calcula el ROI Total de todas las apuestas en el historial. */
        function calculateTotalROI() {
            if (matchHistory.length === 0) {
                document.getElementById('total-roi-results').innerHTML = 'A√∫n no hay apuestas registradas.';
                return;
            }

            let totalInvestment = 0;
            let totalNetProfit = 0;

            matchHistory.forEach(match => {
                totalInvestment += match.stake;
                totalNetProfit += match.netProfit;
            });

            const totalROI = (totalNetProfit / totalInvestment) * 100;

            const totalNetProfitFormatted = totalNetProfit.toFixed(2);
            const totalROIFormatted = totalROI.toFixed(2);

            // Determinar color de resultado
            const className = totalROI > 0 ? 'positive' : (totalROI < 0 ? 'negative' : 'zero');
            const sign = totalROI >= 0 ? '+' : '';

            document.getElementById('total-roi-results').innerHTML = `
                <p>Total de Apuestas: <strong>${matchHistory.length}</strong> | Inversi√≥n Total: <strong>${totalInvestment.toFixed(2)}</strong></p>
                <p>Ganancia Neta Total: <span class="${className}">${sign}${totalNetProfitFormatted}</span> | ROI General: <span class="${className}">${sign}${totalROIFormatted}%</span></p>
            `;
        }


        /** Actualiza la tabla de historial con los datos del array y el ROI Total. */
        function updateHistoryTable() {
            const tableBody = document.getElementById('match-history-body');
            tableBody.innerHTML = ''; 

            matchHistory.forEach(match => {
                const row = tableBody.insertRow();
                row.insertCell().textContent = match.id;
                row.insertCell().textContent = match.market;
                row.insertCell().textContent = match.stake.toFixed(2);
                row.insertCell().textContent = match.quota.toFixed(2);
                
                const resultCell = row.insertCell();
                resultCell.textContent = match.result === 1 ? 'Ganado' : 'Perdido';
                resultCell.classList.add(match.result === 1 ? 'positive' : 'negative');
                
                const profitCell = row.insertCell();
                profitCell.textContent = match.netProfit.toFixed(2);
                profitCell.classList.add(match.netProfit > 0 ? 'positive' : (match.netProfit < 0 ? 'negative' : 'zero'));

                const roiCell = row.insertCell();
                roiCell.textContent = `${match.roi.toFixed(2)}%`;
                roiCell.classList.add(match.roi > 0 ? 'positive' : (match.roi < 0 ? 'negative' : 'zero'));
            });

            calculateTotalROI(); // Recalcula y muestra el ROI general
        }

        /** Formatea el resultado de ROI con color seg√∫n sea positivo, negativo o cero. */
        function formatResult(label, roi) {
            const roundedRoi = roi.toFixed(2);
            let className;
            let sign = roi >= 0 ? '+' : '';

            if (roi > 0) {
                className = 'positive';
            } else if (roi < 0) {
                className = 'negative';
                sign = ''; 
            } else {
                className = 'zero';
            }
            return `${label}: <span class="${className}">${sign}${roundedRoi}%</span>`;
        }
        
        // Inicializar inputs al cargar la p√°gina
        window.onload = function() {
            generateInputs('local-matches', 'local');
            generateInputs('visitor-matches', 'visitor');
            calculateTotalROI(); // Inicializa el mensaje de ROI total
        };
    </script>

</body>
</html>
