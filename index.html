<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Estadísticas de Ligas y Equipos</title>
<style>
  body {font-family: Arial, sans-serif; background:#0b1220; color:#fff; padding:20px;}
  h1, h2 {color:#06b6d4;}
  select, input, button {padding:6px; margin:5px; border-radius:4px; border:1px solid #06b6d4;}
  table {border-collapse: collapse; width:100%; margin-top:10px;}
  th, td {border:1px solid #444; padding:6px; text-align:center;}
  th {background:#06b6d4; color:#fff;}
</style>
</head>
<body>
  <h1>Estadísticas últimos partidos</h1>
  <input type="file" id="fileInput" accept=".json"><br><br>
  
  <label>Selecciona Liga:</label>
  <select id="leagueSelect"></select>
  
  <br><br>
  <label>Equipo Local:</label>
  <select id="homeSelect"></select>
  
  <label>Equipo Visitante:</label>
  <select id="awaySelect"></select>
  
  <br><br>
  <button id="analyzeBtn">Analizar</button>
  
  <div class="section" id="homeStats"></div>
  <div class="section" id="awayStats"></div>
  
<script>
let allMatches = [];
let leagueTeams = [];

function parseResult(result) {
  let [home, away] = result.split("-").map(Number);
  if (home > away) return "1";
  if (home < away) return "2";
  return "X";
}

function calculateStats(matches, team, isHome=true) {
  let filtered = matches.filter(m => 
    isHome ? m.Match.startsWith(team) : m.Match.endsWith(team)
  ).slice(-10); // últimos 10

  let total = filtered.length;
  if (total === 0) return {total:0,matches:[]};

  let htGoals = filtered.filter(m => m["Result HT"] !== "0-0").length;
  let over25 = filtered.filter(m => {
    let [h,a] = m["Result FT"].split("-").map(Number);
    return (h+a) > 2.5;
  }).length;
  let wins = filtered.filter(m => parseResult(m["Result FT"]) === (isHome ? "1" : "2")).length;

  return {
    total,
    htGoalRate: ((htGoals/total)*100).toFixed(1)+"%",
    over25Rate: ((over25/total)*100).toFixed(1)+"%",
    winRate: ((wins/total)*100).toFixed(1)+"%",
    matches: filtered
  };
}

function renderStats(container, stats, title){
  if (stats.total === 0) {
    document.getElementById(container).innerHTML = `<h2>${title}</h2><p>No hay partidos disponibles</p>`;
    return;
  }
  let html = `<h2>${title}</h2>
  <p>Partidos analizados: ${stats.total}</p>
  <ul>
    <li>Gol HT: ${stats.htGoalRate}</li>
    <li>Over 2.5 FT: ${stats.over25Rate}</li>
    <li>Victorias: ${stats.winRate}</li>
  </ul>
  <table>
    <tr><th>Fecha</th><th>Partido</th><th>HT</th><th>FT</th></tr>
    ${stats.matches.map(m=>`<tr>
      <td>${m.Date}</td><td>${m.Match}</td>
      <td>${m["Result HT"]}</td><td>${m["Result FT"]}</td>
    </tr>`).join("")}
  </table>`;
  document.getElementById(container).innerHTML = html;
}

// Cargar JSON
document.getElementById("fileInput").addEventListener("change", function(e){
  let file = e.target.files[0];
  let reader = new FileReader();
  reader.onload = function(event){
    allMatches = JSON.parse(event.target.result);
    let leagues = [...new Set(allMatches.map(m=>m.League))];
    
    let leagueSelect = document.getElementById("leagueSelect");
    leagueSelect.innerHTML = "<option value=''>--Selecciona--</option>" +
      leagues.map(l=>`<option value="${l}">${l}</option>`).join("");
  }
  reader.readAsText(file);
});

// Al seleccionar liga, solo guardamos equipos, pero no llenamos selects
document.getElementById("leagueSelect").addEventListener("change", function(){
  let league = this.value;
  let leagueMatches = allMatches.filter(m=>m.League === league);
  leagueTeams = [...new Set(leagueMatches.flatMap(m=>m.Match.split(" - ")))];
  
  // Reseteamos selects para que el usuario elija manualmente
  document.getElementById("homeSelect").innerHTML = "<option value=''>--Selecciona equipo local--</option>" +
    leagueTeams.map(t=>`<option value="${t}">${t}</option>`).join("");
  document.getElementById("awaySelect").innerHTML = "<option value=''>--Selecciona equipo visitante--</option>" +
    leagueTeams.map(t=>`<option value="${t}">${t}</option>`).join("");
});

// Botón analizar
document.getElementById("analyzeBtn").addEventListener("click", function(){
  let league = document.getElementById("leagueSelect").value;
  let homeTeam = document.getElementById("homeSelect").value;
  let awayTeam = document.getElementById("awaySelect").value;
  
  if (!league || !homeTeam || !awayTeam) {
    alert("Debes seleccionar liga, equipo local y visitante.");
    return;
  }
  
  let leagueMatches = allMatches.filter(m=>m.League === league);
  
  let homeStats = calculateStats(leagueMatches, homeTeam, true);
  let awayStats = calculateStats(leagueMatches, awayTeam, false);
  
  renderStats("homeStats", homeStats, `Últimos 10 partidos de ${homeTeam} en casa`);
  renderStats("awayStats", awayStats, `Últimos 10 partidos de ${awayTeam} de visita`);
});
</script>
</body>
</html>