<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis de Motores Eléctricos | Ley de Ohm y Potencia</title>
    <style>
        /* Estilos Industriales (Manteniendo el formato profesional) */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 20px;
            background-color: #1c2630; /* Fondo Oscuro (Industrial) */
            color: #f0f0f0; 
        }
        .container { 
            max-width: 700px; 
            margin: auto; 
            background: #2b3947; /* Contenedor Principal */
            padding: 30px; 
            border-radius: 6px; 
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4); 
            border-top: 5px solid #ffaa00; /* Línea de color (Naranja/Ámbar para Motores) */
        }
        h1 { 
            color: #ffaa00; /* Color de acento para motores */
            text-align: center; 
            border-bottom: 2px solid #444;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        p { color: #ccc; }
        
        /* Estilos de Entrada de Datos */
        .input-group { 
            margin-bottom: 12px; 
            display: flex; 
            align-items: center; 
            background: #3a4753;
            padding: 8px 15px;
            border-radius: 4px;
        }
        .input-group label { 
            flex: 1; 
            margin-right: 15px; 
            font-weight: bold; 
            color: #fff;
        }
        .input-group input, .input-group select { 
            flex: 2; 
            padding: 10px; 
            border: 1px solid #ffaa00; 
            border-radius: 4px; 
            background: #1c2630;
            color: #f0f0f0;
            font-size: 16px;
        }
        .input-group select { appearance: none; }
        
        /* Estilo específico para los campos de unidad */
        .input-with-unit input { 
            flex: 1.5; 
            border-right: none;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        .input-with-unit select {
            flex: 0.5; 
            background-color: #ffaa00; 
            color: #1c2630; 
            font-weight: bold;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            text-align-last: center; 
        }

        /* Estilos del Botón, Resultados y Diagnóstico */
        button { 
            width: 100%;
            padding: 12px 20px; 
            background-color: #ffaa00; 
            color: #1c2630; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 18px;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.1s; 
            margin-top: 20px;
        }
        button:hover { background-color: #cc8800; }
        button:active { transform: scale(0.99); }
        .resultado, .diagnostico { 
            margin-top: 20px; 
            padding: 15px; 
            border-radius: 4px; 
            font-size: 1.1em;
        }
        .resultado { 
            border: 1px solid #ffaa00; 
            background-color: #3a4753; 
        }
        .resultado strong { color: #ffaa00; }
        .diagnostico { 
            font-weight: bold; 
            border-left: 5px solid;
            padding-left: 15px;
        }
        .alerta-normal { 
            background-color: #14492d; 
            color: #90ee90; 
            border-color: #3cb371; 
        }
        .alerta-alto { 
            background-color: #660000; 
            color: #ffcccc; 
            border-color: #cc0000; 
        }
        .alerta-bajo { 
            background-color: #664f00; 
            color: #ffdb80; 
            border-color: #ff9900; 
        }
        .alerta-error { 
            background-color: #4a148c; 
            color: #e1bee7; 
            border-color: #9c27b0; 
        }
        .sugerencia {
            display: block;
            margin-top: 10px;
            padding-top: 5px;
            border-top: 1px dashed #555;
            font-weight: normal;
            font-size: 0.9em;
            color: #ccc;
        }
        /* Nuevo estilo para la guía visual */
        #guia-visual {
            margin-top: 15px;
            padding: 10px;
            background-color: #4a148c; /* Morado para resaltar la instrucción */
            border-radius: 4px;
            text-align: center;
        }
        #guia-visual strong {
            color: #ffdb80;
            display: block;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>⚙️ Análisis de Fallas en Motores Eléctricos (V, I, R, P)</h1>
        <p>Compare el valor medido en el motor (Real) con el valor esperado (Nominal) para diagnosticar fallas de consumo o suministro.</p>

        <div class="input-group">
            <label for="metodo-calculo">Parámetro a Diagnosticar:</label>
            <select id="metodo-calculo">
                <option value="I-VR">Diagnosticar **I (Corriente)** con V y R. (I = V/R)</option>
                <option value="R-VI">Diagnosticar **R (Impedancia)** con V e I. (R = V/I)</option>
                <option value="V-IR">Diagnosticar **V (Voltaje)** con I y R. (V = I*R)</option>
                <option value="P-VI">Diagnosticar **P (Potencia)** con V e I. (P = V*I)</option>
                <option value="I-PV">Diagnosticar **I (Corriente)** con P y V. (I = P/V)</option>
                <option value="P-IR">Diagnosticar **P (Potencia)** con I y R. (P = I²*R)</option>
                <option value="R-PV">Diagnosticar **R (Impedancia)** con P y V. (R = V²/P)</option>
            </select>
        </div>

        <hr style="border-color: #444; margin: 20px 0;">

        <h3>Datos de Placa y Operación Nominal</h3>
        <div class="input-group" id="group-v-nominal">
            <label for="v-nominal">Voltaje Nominal (V) [V]:</label>
            <input type="number" id="v-nominal" placeholder="Ej: 440" value="440" title="Voltaje de placa del motor.">
        </div>
        <div class="input-group" id="group-i-nominal" style="display: none;">
            <label for="i-nominal">Corriente Nominal (I) [A]:</label>
            <input type="number" id="i-nominal" placeholder="Ej: 9.08" value="9.08" title="Corriente de plena carga (Full Load Amps - FLA).">
        </div>
        <div class="input-group" id="group-r-nominal" style="display: none;">
            <label for="r-nominal">Resistencia/Impedancia Nominal (R) [Ω]:</label>
            <input type="number" id="r-nominal" placeholder="Ej: 32" title="Impedancia calculada o Resistencia de bobinado.">
        </div>
        
        <div class="input-group" id="group-p-nominal" style="display: none;">
            <label for="p-nominal">Potencia Nominal (P):</label>
            <div class="input-with-unit" style="display: flex; flex: 2;">
                <input type="number" id="p-nominal" placeholder="Ej: 4.8" value="4.8" title="Potencia de placa (kW o W).">
                <select id="p-nominal-unit">
                    <option value="W">W</option>
                    <option value="kW" selected>kW</option>
                </select>
            </div>
        </div>
        <hr style="border-color: #444; margin: 20px 0;">
        <h3>Lectura en Sitio (Medición Real)</h3>
        
        <div id="guia-visual">
            <strong>Guía de Medición:</strong>
            <span id="imagen-medicion">Seleccione un parámetro para ver la guía visual.</span>
        </div>
        <div class="input-group">
            <label for="valor-real"><span id="label-real">Valor Real Medido</span>:</label>
            <input type="number" id="valor-real" placeholder="Valor leído con el multímetro/pinza" value="0.0" title="Valor real medido en el motor operativo.">
        </div>

        <button onclick="realizarDiagnostico()">✅ Analizar y Diagnosticar Falla del Motor</button>

        <hr style="border-color: #444; margin: 20px 0;">
        <h3>Resultados del Análisis del Motor</h3>
        <div class="resultado">
            <p><strong>Valor Calculado / Esperado (<span id="unidad-esperada">I</span>):</strong> <span id="resultado-esperado">---</span></p>
        </div>
        <div class="diagnostico" id="area-diagnostico">
            <p><strong>Estado del Motor:</strong> <span id="mensaje-diagnostico">Pendiente de Análisis</span></p>
            <span class="sugerencia" id="sugerencia-diagnostico">Seleccione un método de cálculo, ingrese los valores y presione "Analizar y Diagnosticar Falla del Motor".</span>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const selector = document.getElementById('metodo-calculo');
            selector.addEventListener('change', actualizarCampos);
            
            // Inicialización con el caso de ejemplo
            document.getElementById('metodo-calculo').value = 'I-PV';
            actualizarCampos(); 
        });

        // ====================================================================
        // LÓGICA DE INTERFAZ (JS)
        // ====================================================================

        function actualizarCampos() {
            const metodo = document.getElementById('metodo-calculo').value;
            const knowns = metodo.split('-')[1];
            const variableDiagnostico = metodo.split('-')[0];

            // Ocultar/Mostrar campos nominales
            document.getElementById('group-v-nominal').style.display = knowns.includes('V') ? 'flex' : 'none'; 
            document.getElementById('group-i-nominal').style.display = knowns.includes('I') ? 'flex' : 'none';
            document.getElementById('group-r-nominal').style.display = knowns.includes('R') ? 'flex' : 'none';
            document.getElementById('group-p-nominal').style.display = knowns.includes('P') ? 'flex' : 'none';

            // Ajustar etiquetas de unidad y unidades de medida
            let labelText, unitText, imagenTag;
            const pUnit = document.getElementById('p-nominal-unit').value;
            
            switch (variableDiagnostico) {
                case 'I': 
                    labelText = 'Corriente Real (I) [A]:'; 
                    unitText = 'I (Amperios)'; 
                    // Guía visual para I: Pinza rodeando un conductor.
                    imagenTag = '';
                    break;
                case 'R': 
                    labelText = 'Resistencia/Impedancia Real (R) [Ω]:'; 
                    unitText = 'R (Ohmios)'; 
                    // Guía visual para R: Puntas de multímetro en dos bobinados desconectados.
                    imagenTag = '';
                    break;
                case 'V': 
                    labelText = 'Voltaje Real (V) [V]:'; 
                    unitText = 'V (Voltios)'; 
                    // Guía visual para V: Puntas de multímetro entre dos fases o fase y neutro.
                    imagenTag = '';
                    break;
                case 'P': 
                    labelText = `Potencia Real (P) [${pUnit}]:`; 
                    unitText = `P (${pUnit})`; 
                    // Guía visual para P: Analizador de redes conectado a las tres fases y pinzas de corriente.
                    imagenTag = '';
                    break;
            }
            document.getElementById('label-real').textContent = labelText;
            document.getElementById('unidad-esperada').textContent = unitText;
            document.getElementById('imagen-medicion').innerHTML = imagenTag; // Actualiza la guía visual

            // Limpiar resultados
            document.getElementById('resultado-esperado').textContent = '---';
            document.getElementById('area-diagnostico').className = 'diagnostico';
            document.getElementById('mensaje-diagnostico').textContent = 'Pendiente de Análisis';
            document.getElementById('sugerencia-diagnostico').textContent = 'Ingrese los valores y presione "Analizar y Diagnosticar Falla del Motor".';
        }

        // ====================================================================
        // LÓGICA DE DIAGNÓSTICO
        // ====================================================================

        function realizarDiagnostico() {
            const metodo = document.getElementById('metodo-calculo').value;
            const variable = metodo.split('-')[0];

            let vNominal = parseFloat(document.getElementById('v-nominal').value) || 0;
            let iNominal = parseFloat(document.getElementById('i-nominal').value) || 0;
            let rNominal = parseFloat(document.getElementById('r-nominal').value) || 0;
            let pNominal = parseFloat(document.getElementById('p-nominal').value) || 0;
            const pNominalUnit = document.getElementById('p-nominal-unit').value;
            let valorReal = parseFloat(document.getElementById('valor-real').value) || 0;

            let valorEsperado;
            let mensaje = '';
            let sugerencia = '';
            let claseDiagnostico = 'alerta-normal'; 
            const tolerancia = 0.05; 
            const CERO_AMPS_UMBRAL = 0.5; // Umbral para considerar motor inactivo.
            
            const resultadoEsperadoElement = document.getElementById('resultado-esperado');
            const areaDiagnosticoElement = document.getElementById('area-diagnostico');
            const mensajeDiagnosticoElement = document.getElementById('mensaje-diagnostico');
            const sugerenciaDiagnosticoElement = document.getElementById('sugerencia-diagnostico');

            // CONVERSIÓN DE ENTRADA NOMINAL A WATTS
            let pNominalBase = pNominal;
            if (pNominalUnit === 'kW') {
                pNominalBase = pNominal * 1000;
            }
            
            // CONVERSIÓN DE ENTRADA REAL (Solo si se está midiendo Potencia)
            let valorRealBase = valorReal;
            if (variable === 'P') {
                const pRealUnit = document.getElementById('p-nominal-unit').value;
                if (pRealUnit === 'kW') {
                    valorRealBase = valorReal * 1000;
                }
            }


            // 1. Validar entradas REALES
            if (valorReal < 0) { 
                claseDiagnostico = 'alerta-error';
                mensaje = 'ERROR: Lectura Real No Válida.';
                sugerencia = 'El valor medido debe ser positivo o cero. Verifique el instrumento y la medición.';
                resultadoEsperadoElement.textContent = 'N/A';
                areaDiagnosticoElement.className = `diagnostico ${claseDiagnostico}`;
                mensajeDiagnosticoElement.textContent = mensaje;
                sugerenciaDiagnosticoElement.textContent = sugerencia;
                return;
            }

            // ⚡ COMPROBACIÓN CRÍTICA PARA MOTORES: CORRIENTE CERCANA A CERO (Solo aplica si I es la variable a diagnosticar)
            if (variable === 'I' && valorReal < CERO_AMPS_UMBRAL && iNominal > CERO_AMPS_UMBRAL) {
                claseDiagnostico = 'alerta-normal'; 
                mensaje = `ESTADO: Motor **INACTIVO** o **SIN CARGA** detectado.`;
                sugerencia = `La corriente real de ${valorReal} A es muy baja comparada con la nominal (${iNominal} A). Esto es normal si el motor está **apagado o girando en vacío extremo**. Si se supone que debe operar a plena carga, verifique el interruptor, control o acoplamiento mecánico.`;
                resultadoEsperadoElement.textContent = iNominal.toFixed(3); 
                areaDiagnosticoElement.className = `diagnostico ${claseDiagnostico}`;
                mensajeDiagnosticoElement.textContent = mensaje;
                sugerenciaDiagnosticoElement.textContent = sugerencia;
                return;
            }
            
            // 2. Cálculo del Valor Esperado y Validación de entradas NOMINALES
            try {
                // Cálculo del valor esperado
                if (metodo === 'I-VR') { valorEsperado = vNominal / rNominal; } 
                else if (metodo === 'R-VI') { valorEsperado = vNominal / iNominal; } 
                else if (metodo === 'V-IR') { valorEsperado = iNominal * rNominal; } 
                else if (metodo === 'P-VI') { valorEsperado = vNominal * iNominal; } 
                else if (metodo === 'I-PV') { valorEsperado = pNominalBase / vNominal; } 
                else if (metodo === 'P-IR') { valorEsperado = iNominal * iNominal * rNominal; } 
                else if (metodo === 'R-PV') { valorEsperado = (vNominal * vNominal) / pNominalBase; }

                // Validaciones para denominadores
                if (metodo === 'I-VR' && rNominal <= 0) throw new Error("R (Impedancia) Nominal debe ser > 0. ");
                if (metodo === 'R-VI' && iNominal <= 0) throw new Error("I (Corriente) Nominal debe ser > 0.");
                if (metodo === 'I-PV' && vNominal <= 0) throw new Error("V (Voltaje) Nominal debe ser > 0.");
                if (metodo === 'R-PV' && pNominalBase <= 0) throw new Error("P (Potencia) Nominal debe ser > 0.");
                
            } catch (e) {
                claseDiagnostico = 'alerta-error';
                mensaje = 'ERROR: Datos de Referencia Inválidos.';
                sugerencia = e.message + " Corrija las entradas nominales requeridas. **Nota: R en motores suele ser muy baja.**";
                resultadoEsperadoElement.textContent = 'N/A';
                areaDiagnosticoElement.className = `diagnostico ${claseDiagnostico}`;
                mensajeDiagnosticoElement.textContent = mensaje;
                sugerenciaDiagnosticoElement.textContent = sugerencia;
                return;
            }
            
            // 3. Diagnóstico (Comparación Real vs. Esperado)
            
            const valorComparacionReal = (variable === 'P') ? valorRealBase : valorReal;

            const diferencia = Math.abs(valorComparacionReal - valorEsperado);
            const porcentajeDiferencia = valorEsperado > 0 ? diferencia / valorEsperado : 1; 

            if (porcentajeDiferencia <= tolerancia) {
                mensaje = `OPERACIÓN NORMAL (Tolerancia ±${Math.round(tolerancia * 100)}%)`;
                sugerencia = 'El motor opera dentro de los parámetros eléctricos esperados. Busque fallas **mecánicas** (vibración, rodamientos, lubricación) o en el **sistema de control**.';
                claseDiagnostico = 'alerta-normal';
            } else if (valorComparacionReal > valorEsperado) {
                claseDiagnostico = 'alerta-alto';
                if (variable === 'I' || variable === 'P') {
                    mensaje = `ALARMA CRÍTICA: Corriente/Potencia Real MUY ALTA (Sobrecarga/Corto).`;
                    sugerencia = 'Causa Probable: **Sobrecarga Mecánica**, **Rotor Bloqueado** o **Falla de Aislamiento** (corto entre espiras/fases). La impedancia efectiva del motor es **baja (R↓)**. **Acción**: Desenergizar, verificar aislamiento y carga mecánica.';
                } else if (variable === 'R' || variable === 'V') {
                    mensaje = `PRECAUCIÓN: Resistencia/Voltaje Real MUY ALTO.`;
                    sugerencia = 'Causa Probable: Si es V, **Sobretensión de Fuente**. Si es R (Impedancia), puede ser un error de medición o una **falla interna** que aumenta la reactancia. **Acción**: Verificar la regulación de voltaje o realizar pruebas de resistencia de bobinado en frío.';
                }
            } else { // valorReal < valorEsperado
                claseDiagnostico = 'alerta-bajo';
                if (variable === 'I' || variable === 'P') {
                    mensaje = `PRECAUCIÓN: Corriente/Potencia Real MUY BAJA (Subconsumo/Falla de Carga).`;
                    sugerencia = 'Causa Probable: **Carga Desacoplada**, **Motor Inactivo** o **Bajo Voltaje**. La impedancia efectiva del motor es **alta (R↑)**. **Acción**: Revisar cableado, fusibles y contactos.';
                } else if (variable === 'R' || variable === 'V') {
                    mensaje = `ALARMA CRÍTICA: Resistencia/Voltaje Real MUY BAJO.`;
                    sugerencia = 'Causa Probable: Si es V, **Caída de Tensión** excesiva (cableado/fuente débil). Si es R, **Cortocircuito severo** o bobinado en mal estado (R↓). **Acción**: Si es V, revisar línea. Si es R, desenergizar y probar bobinados.';
                }
            }

            // 4. Mostrar Resultados
            
            let valorEsperadoFinal = valorEsperado;
            if (variable === 'P' && pNominalUnit === 'kW') {
                valorEsperadoFinal = valorEsperado / 1000;
            }

            resultadoEsperadoElement.textContent = valorEsperadoFinal.toFixed(3);
            areaDiagnosticoElement.className = `diagnostico ${claseDiagnostico}`;
            mensajeDiagnosticoElement.textContent = mensaje;
            sugerenciaDiagnosticoElement.textContent = sugerencia;
            
            document.getElementById('unidad-esperada').textContent = (variable === 'P') ? `P (${pNominalUnit})` : document.getElementById('unidad-esperada').textContent;
        }
    </script> 
</body>
</html>
