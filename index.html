<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de ROI y Simulaci贸n de Bankroll ($1 Stake)</title>
    <style>
        /* Estilos generales */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f7f6;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-top: 5px solid #007bff;
        }
        h1 {
            color: #007bff;
            text-align: center;
            border-bottom: 2px solid #ccc;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .info-box {
            background-color: #e9f7ef;
            color: #155724;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-weight: bold;
        }
        input[type="file"] {
            display: block;
            margin: 15px 0;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            width: 100%;
            box-sizing: border-box;
        }
        button {
            padding: 12px 25px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-top: 15px;
            font-size: 1.1em;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }

        /* Secci贸n de Resultados */
        .results-section {
            margin-top: 30px;
            border-top: 2px dashed #007bff;
            padding-top: 20px;
        }
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            font-size: 1.1em;
        }
        .metric-label {
            font-weight: bold;
            color: #555;
        }
        .metric-value {
            font-weight: bold;
            color: #333;
        }
        .final-saldo {
            font-size: 1.5em;
            padding-top: 15px;
            color: #007bff;
        }
        .positive { color: #28a745 !important; }
        .negative { color: #dc3545 !important; }

    </style>
</head>
<body>

    <div class="container">
        <h1> Simulador de ROI con Stake Fijo</h1>
        
        <div class="info-box">
            Este simulador trabaja con par谩metros fijos:
            <br>
            * **Bankroll Inicial:** **$100.00**
            * **Stake Fijo por Apuesta:** **$1.00**
        </div>
        
        <label for="historicalFile">Cargar Archivo de **Historial de Apuestas** (JSON)</label>
        <input type="file" id="historicalFile" accept=".json">

        <button onclick="simulateROI()">Calcular Rendimiento Simulado</button>

        <div id="results" class="results-section" style="display: none;">
            <h2> Resultados de la Simulaci贸n</h2>
            
            <div class="metric">
                <span class="metric-label">N煤mero Total de Apuestas:</span>
                <span id="totalBets" class="metric-value">0</span>
            </div>

            <div class="metric">
                <span class="metric-label">Inversi贸n Total (Stake):</span>
                <span id="totalInvestment" class="metric-value"></span>
            </div>

            <div class="metric">
                <span class="metric-label">Ganancia/P茅rdida Neta:</span>
                <span id="netProfit" class="metric-value"></span>
            </div>

            <div class="metric final-saldo">
                <span class="metric-label">SALDO FINAL DEL BANKROLL (Iniciando con $100):</span>
                <span id="finalBalance" class="metric-value"></span>
            </div>

            <div class="metric final-saldo">
                <span class="metric-label">ROI (Retorno de la Inversi贸n):</span>
                <span id="finalROI" class="metric-value"></span>
            </div>
            
        </div>
    </div>

    <script>
        // --- CONSTANTES DE LA SIMULACIN ---
        const INITIAL_BANKROLL = 100.00;
        const FIXED_STAKE = 1.00;

        let historicalMatches = []; 
        
        // --- Funciones de Carga ---

        document.getElementById('historicalFile').addEventListener('change', (e) => loadFile(e), false);

        function loadFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader(); 
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    // Asegurarse de que el historial es un array
                    historicalMatches = Array.isArray(data) ? data : (data ? [data] : []);
                    console.log(`${historicalMatches.length} partidos de historial cargados.`);
                    // Ocultar resultados si se carga un nuevo archivo
                    document.getElementById('results').style.display = 'none';
                    
                } catch (error) {
                    alert(`Error al leer o parsear el archivo. Verifique el formato JSON: ` + error.message);
                    console.error('Error:', error);
                    historicalMatches = [];
                }
            };
            reader.readAsText(file);
        }

        /**
         * Calcula la ganancia/p茅rdida de una sola apuesta.
         * Devuelve la ganancia neta.
         */
        function calculateNetProfit(match) {
            const odd = parseFloat(match.Odd);
            const result = match.Result; 
            const stake = FIXED_STAKE;

            if (isNaN(odd) || odd <= 1 || !result) {
                // Si faltan datos, asumimos que no hubo apuesta o es inv谩lida (Ganancia 0)
                return 0; 
            }
            
            if (result === 'Winning') {
                // Ganancia = Stake * (Odd - 1)
                return stake * (odd - 1); 
            } else if (result === 'Losing') {
                // P茅rdida = -Stake
                return -stake; 
            } else {
                // 'Void' o 'Pending' o cualquier otro, no afecta el bankroll en la simulaci贸n
                return 0;
            }
        }
        
        /**
         * Funci贸n principal de simulaci贸n y c谩lculo de ROI.
         */
        function simulateROI() {
            if (historicalMatches.length === 0) {
                alert("Por favor, cargue un archivo de Historial de Apuestas v谩lido.");
                return;
            }

            const totalBets = historicalMatches.length;
            let totalInvestment = 0;
            let netProfit = 0;
            let currentBalance = INITIAL_BANKROLL;
            
            // 1. Recorrer el historial y simular el resultado
            historicalMatches.forEach(match => {
                const profit = calculateNetProfit(match);
                
                // Si la apuesta fue 'Winning' o 'Losing' (es decir, profit !== 0)
                if (profit !== 0) {
                    totalInvestment += FIXED_STAKE;
                } 

                netProfit += profit;
                currentBalance += profit;
            });
            
            // 2. Calcular el ROI
            let roi = 0;
            if (totalInvestment > 0) {
                roi = (netProfit / totalInvestment) * 100;
            }


            // 3. Mostrar Resultados
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'block';

            document.getElementById('totalBets').textContent = totalBets;
            document.getElementById('totalInvestment').textContent = `$${totalInvestment.toFixed(2)}`;

            const netProfitElement = document.getElementById('netProfit');
            netProfitElement.textContent = `$${netProfit.toFixed(2)}`;
            netProfitElement.className = netProfit >= 0 ? 'metric-value positive' : 'metric-value negative';

            const finalBalanceElement = document.getElementById('finalBalance');
            finalBalanceElement.textContent = `$${currentBalance.toFixed(2)}`;
            finalBalanceElement.className = currentBalance >= INITIAL_BANKROLL ? 'metric-value positive' : 'metric-value negative';

            const finalROIElement = document.getElementById('finalROI');
            finalROIElement.textContent = `${roi.toFixed(2)}%`;
            finalROIElement.className = roi >= 0 ? 'metric-value positive' : 'metric-value negative';
        }

    </script>

</body>
</html>