<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calculadora Kelly Fraccional Mejorada</title>
<style>
  :root{
    --bg:#0f1115; --card:#171923; --muted:#9aa4b2; --text:#e6e8ee; --accent:#5b9cff;
    --good:#2ecc71; --bad:#ff5b6e; --ring:rgba(91,156,255,.35);
  }
  *{box-sizing:border-box}
  body{margin:0; background:#0e1014; color:var(--text);
    font:16px/1.4 system-ui,Segoe UI,Roboto,Inter,sans-serif;
    display:grid; place-items:start center; min-height:100vh; padding:24px}
  .wrap{width:100%; max-width:960px}
  h1{margin:0 0 10px}
  p.lead{color:var(--muted); margin:0 0 20px}
  .grid{display:grid; grid-template-columns:repeat(12,1fr); gap:16px}
  .card{background:var(--card); border:1px solid #222638; border-radius:14px; padding:18px}
  .span-6{grid-column:span 6} .span-12{grid-column:span 12}
  @media(max-width:820px){.span-6{grid-column:span 12}}
  label{display:block; font-weight:600; margin-bottom:8px}
  input[type="number"]{
    width:100%; background:#0f1320; color:var(--text); border:1px solid #283047;
    border-radius:10px; padding:10px; outline:none
  }
  input[type="number"]:focus{border-color:var(--accent); box-shadow:0 0 0 4px var(--ring)}
  .hint{color:var(--muted); font-size:12px; margin-top:4px}
  .kpi{display:grid; grid-template-columns:repeat(3,1fr); gap:12px}
  .item{background:#101423; border:1px solid #222638; border-radius:10px; padding:12px}
  .label{color:var(--muted); font-size:12px}
  .value{font-size:18px; font-weight:700; margin-top:4px}
  .value.good{color:var(--good)} .value.bad{color:var(--bad)}
  .summary{margin-top:10px; font-size:14px}
  table{width:100%; border-collapse:collapse; margin-top:12px}
  th,td{padding:6px 8px; border:1px solid #2c3145; font-size:13px; text-align:center}
  th{background:#1a1f2e}
  .small{font-size:12px; color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <h1>Calculadora Kelly Fraccional</h1>
  <p class="lead">Por defecto bankroll = 100, fracci√≥n = 25%. Incluye historial y stake m√°ximo del 10% del bankroll.</p>

  <div class="grid">
    <!-- Entradas -->
    <div class="card span-6">
      <label>Bankroll</label>
      <input id="bankroll" type="number" value="100" step="0.01" min="1"/>
      <label style="margin-top:10px">Probabilidad estimada (%)</label>
      <input id="prob" type="number" placeholder="Ej. 55" step="0.01" min="0" max="100"/>
      <label style="margin-top:10px">Cuota decimal</label>
      <input id="odds" type="number" placeholder="Ej. 1.91" step="0.01" min="1.01"/>
      <label style="margin-top:10px">Fracci√≥n de Kelly (%)</label>
      <input id="fraction" type="number" value="25" step="1" min="1" max="100"/>
      <div class="hint">Se aplicar√° adem√°s un l√≠mite del 10% del bankroll.</div>
    </div>

    <!-- Resultados -->
    <div class="card span-6">
      <div class="kpi">
        <div class="item">
          <div class="label">Kelly 100%</div>
          <div id="k100" class="value">‚Äî</div>
        </div>
        <div class="item">
          <div class="label">Kelly 50%</div>
          <div id="k50" class="value">‚Äî</div>
        </div>
        <div class="item">
          <div class="label">Kelly 25%</div>
          <div id="k25" class="value">‚Äî</div>
        </div>
      </div>
      <div style="margin-top:14px">
        <div><strong>Apuesta recomendada:</strong> <span id="stake" class="value">‚Äî</span></div>
        <div class="small">Se aplica fracci√≥n elegida y cap de 10% bankroll</div>
        <div id="edge" class="summary"></div>
      </div>
    </div>

    <!-- Historial -->
    <div class="card span-12">
      <h3>Historial de c√°lculos</h3>
      <table id="historyTable">
        <thead>
          <tr>
            <th>Fecha</th><th>Prob (%)</th><th>Cuota</th><th>Frac. Kelly</th><th>Stake</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <button onclick="clearHistory()">üóë Limpiar historial</button>
    </div>
  </div>
</div>

<script>
(function(){
  const $ = id => document.getElementById(id);
  const bankroll = $("bankroll"), prob = $("prob"), odds = $("odds"), fraction = $("fraction");
  const stakeOut = $("stake"), k100=$("k100"), k50=$("k50"), k25=$("k25"), edge=$("edge");
  const tableBody = $("historyTable").querySelector("tbody");

  [bankroll, prob, odds, fraction].forEach(el => el.addEventListener("input", compute));

  function compute(){
    const BR = parseFloat(bankroll.value)||0;
    const p = (parseFloat(prob.value)||0)/100;
    const o = parseFloat(odds.value)||0;
    const frac = (parseFloat(fraction.value)||0)/100;
    if(BR<=0 || p<=0 || o<=1){ return; }

    const b = o-1, q=1-p;
    let fStar = (b*p - q)/b; if(!isFinite(fStar)||fStar<=0) fStar=0;

    const stake100 = fStar*BR;
    const stake50 = 0.5*stake100;
    const stake25 = 0.25*stake100;

    const stakeFrac = frac*stake100;
    const cap = 0.10*BR;
    const finalStake = Math.min(stakeFrac, cap);

    k100.textContent = stake100.toFixed(2);
    k50.textContent = stake50.toFixed(2);
    k25.textContent = stake25.toFixed(2);

    stakeOut.textContent = finalStake.toFixed(2);

    const edgeVal = p - 1/o;
    edge.textContent = `Edge vs cuota: ${(edgeVal*100).toFixed(2)}%`;

    saveToHistory(p*100,o,frac*100,finalStake);
    renderHistory();
  }

  function saveToHistory(prob,odds,fraction,stake){
    let hist = JSON.parse(localStorage.getItem("kellyHist")||"[]");
    hist.unshift({
      date: new Date().toLocaleString(),
      prob: prob.toFixed(2),
      odds: odds.toFixed(2),
      fraction: fraction.toFixed(0),
      stake: stake.toFixed(2)
    });
    if(hist.length>20) hist.pop(); // max 20 registros
    localStorage.setItem("kellyHist", JSON.stringify(hist));
  }

  function renderHistory(){
    let hist = JSON.parse(localStorage.getItem("kellyHist")||"[]");
    tableBody.innerHTML="";
    hist.forEach(h=>{
      let tr=document.createElement("tr");
      tr.innerHTML=`<td>${h.date}</td><td>${h.prob}</td><td>${h.odds}</td><td>${h.fraction}%</td><td>${h.stake}</td>`;
      tableBody.appendChild(tr);
    });
  }

  window.clearHistory = function(){
    localStorage.removeItem("kellyHist");
    renderHistory();
  }

  renderHistory();
})();
</script>
</body>
</html>