<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Estratega Maestro - ROI por Horarios</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #3b82f6; --success: #10b981; --danger: #ef4444; --gold: #fbbf24; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 1200px; margin: auto; }
        textarea { width: 100%; height: 100px; background: #334155; color: white; border: 1px solid #475569; border-radius: 8px; padding: 10px; font-size: 11px; margin-bottom: 10px; }
        .btn { background: var(--accent); color: white; border: none; padding: 15px; cursor: pointer; border-radius: 6px; font-weight: bold; width: 100%; font-size: 16px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; border-top: 4px solid var(--accent); }
        .time-slot { display: flex; justify-content: space-between; padding: 10px; margin: 5px 0; border-radius: 8px; background: rgba(255,255,255,0.05); border-left: 4px solid #475569; }
        .roi-pos { color: var(--success); font-weight: bold; }
        .roi-neg { color: var(--danger); font-weight: bold; }
        .hour-label { font-size: 12px; color: #94a3b8; }
        .export-btn { background: #10b981; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="card" style="margin-bottom:20px; border-top: 4px solid var(--gold);">
        <h2>üïí Analizador de Franjas Horarias y Plan Semanal</h2>
        <p>Identifica a qu√© hora del d√≠a tus predicciones son m√°s precisas.</p>
    </div>

    <textarea id="dataInput" placeholder="Pega tus datos aqu√≠..."></textarea>
    <button class="btn" onclick="processAll()">GENERAR ESTRATEGIA HORARIA Y SEMANAL</button>

    <div id="results" style="display:none;">
        <div class="grid">
            <div class="card">
                <h3>‚è∞ Rentabilidad por Horario</h3>
                <div id="hourStats"></div>
            </div>
            <div class="card">
                <h3>üìÖ Rentabilidad por D√≠a</h3>
                <div id="dayStats"></div>
            </div>
            <div class="card">
                <h3>‚≠ê Equipos Top ROI</h3>
                <div id="teamStats"></div>
            </div>
        </div>
        
        <button class="btn export-btn" onclick="exportStrategy()">DESCARGAR PLAN ESTRAT√âGICO (.txt)</button>
    </div>
</div>

<script>
function processAll() {
    const input = document.getElementById('dataInput').value.trim();
    const lines = input.split('\n');
    const headers = lines[0].split('\t').map(h => h.trim().toLowerCase());

    const find = (keys) => headers.findIndex(h => keys.some(k => h.includes(k)));
    const idx = { date: find(['date', 'fecha']), match: find(['match']), result: headers.lastIndexOf('result'), odd: find(['odd']) };

    let stats = { hours: {}, days: {}, teams: {} };

    lines.slice(1).forEach(line => {
        const col = line.split('\t').map(c => c.trim());
        if (col.length < 5) return;

        const isWin = col.some((c, i) => i >= idx.result && c.toLowerCase() === 'winning');
        const odd = parseFloat(col[idx.odd]?.replace(',','.')) || 1.0;
        const [hT, aT] = col[idx.match] ? col[idx.match].split(' - ') : ['?', '?'];
        const dateStr = col[idx.date] || "";

        // Extraer Hora (Formato esperado: HH:mm)
        const timeMatch = dateStr.match(/(\d{2}):(\d{2})/);
        const hour = timeMatch ? parseInt(timeMatch[1]) : -1;
        
        let slot = "Sin Hora";
        if(hour >= 5 && hour < 12) slot = "Ma√±ana (05-12h)";
        else if(hour >= 12 && hour < 17) slot = "Mediod√≠a (12-17h)";
        else if(hour >= 17 && hour < 21) slot = "Tarde (17-21h)";
        else if(hour >= 21 || (hour >= 0 && hour < 5)) slot = "Noche (21-05h)";

        // Extraer D√≠a
        let dName = "Otro";
        if(dateStr.toLowerCase().includes('lun')) dName = "Lunes";
        else if(dateStr.toLowerCase().includes('mar')) dName = "Martes";
        else if(dateStr.toLowerCase().includes('mi√©')) dName = "Mi√©rcoles";
        else if(dateStr.toLowerCase().includes('jue')) dName = "Jueves";
        else if(dateStr.toLowerCase().includes('vie')) dName = "Viernes";
        else if(dateStr.toLowerCase().includes('s√°b')) dName = "S√°bado";
        else if(dateStr.toLowerCase().includes('dom')) dName = "Domingo";

        const ret = isWin ? odd : 0;

        // Guardar Stats
        [stats.hours, stats.days].forEach((obj, i) => {
            const key = i === 0 ? slot : dName;
            if(!obj[key]) obj[key] = {s:0, r:0};
            obj[key].s++; obj[key].r += ret;
        });

        [hT, aT].forEach(t => {
            if(!t) return;
            if(!stats.teams[t]) stats.teams[t] = {s:0, r:0};
            stats.teams[t].s++; stats.teams[t].r += ret;
        });
    });

    render(stats);
}

function render(s) {
    document.getElementById('results').style.display = 'block';

    const createList = (obj) => Object.entries(obj)
        .sort((a,b) => (b[1].r/b[1].s) - (a[1].r/a[1].s))
        .map(([name, d]) => {
            const roi = ((d.r/d.s-1)*100).toFixed(1);
            return `<div class="time-slot"><span>${name}</span><span class="${roi>=0?'roi-pos':'roi-neg'}">${roi}% ROI</span></div>`;
        }).join('');

    document.getElementById('hourStats').innerHTML = createList(s.hours);
    document.getElementById('dayStats').innerHTML = createList(s.days);
    
    document.getElementById('teamStats').innerHTML = Object.entries(s.teams)
        .filter(e => e[1].s > 1)
        .sort((a,b) => (b[1].r/b[1].s) - (a[1].r/a[1].s))
        .slice(0, 8)
        .map(([n, d]) => `<div class="time-slot"><span>${n}</span><span class="roi-pos">${((d.r/d.s-1)*100).toFixed(0)}%</span></div>`)
        .join('');
}

function exportStrategy() {
    const content = document.getElementById('results').innerText;
    const blob = new Blob([content], {type: "text/plain"});
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "mi_estrategia_betting.txt";
    link.click();
}
</script>
</body>
</html>
