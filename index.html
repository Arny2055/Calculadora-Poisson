<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pronosticador de Fútbol - Análisis Cuantitativo y Cualitativo</title>
<style>
  :root {
    --bg: #0a162c;
    --card: #112240;
    --accent: #3dd598;
    --text-light: #d7e3fc;
    --text-muted: #8a9bb8;
    --radius: 12px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    min-height: 100vh;
    background: linear-gradient(135deg, #0a162c 0%, #071024 100%);
    color: var(--text-light);
    display: flex;
    justify-content: center;
    padding: 20px;
  }
  .container {
    max-width: 900px;
    background: var(--card);
    border-radius: var(--radius);
    padding: 24px 32px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.8);
  }
  h1 {
    margin-top: 0;
    margin-bottom: 16px;
    font-weight: 700;
    color: var(--accent);
    text-align: center;
  }
  form {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
    gap: 20px;
    margin-bottom: 20px;
  }
  label {
    display: block;
    font-size: 14px;
    margin-bottom: 6px;
    color: var(--text-muted);
  }
  input[type=number], select {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: none;
    background-color: #182c4f;
    color: var(--text-light);
    font-size: 14px;
  }
  select {
    cursor: pointer;
  }
  button {
    grid-column: 1/-1;
    background: var(--accent);
    border: none;
    padding: 12px;
    border-radius: var(--radius);
    font-weight: 700;
    font-size: 16px;
    cursor: pointer;
    color: #02130d;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #33cfa5;
  }
  .result {
    background: #152d59;
    border-radius: var(--radius);
    padding: 20px;
  }
  .result h2 {
    margin-top: 0;
    color: var(--accent);
    margin-bottom: 12px;
  }
  .probabilities {
    display: flex;
    justify-content: space-around;
    margin-bottom: 20px;
  }
  .probability-box {
    background: #0f2246;
    border-radius: var(--radius);
    padding: 12px 18px;
    width: 30%;
    text-align: center;
  }
  .probability-box h3 {
    margin: 0;
    font-size: 18px;
  }
  .probability-box p {
    margin: 4px 0 0 0;
    font-size: 13px;
    color: var(--text-muted);
  }
  .summary {
    background: #0f2246;
    padding: 14px 18px;
    border-radius: var(--radius);
    font-size: 14px;
    line-height: 1.4;
    color: var(--text-light);
  }
  .error {
    background: #a64444;
    padding: 10px;
    border-radius: var(--radius);
    margin-bottom: 12px;
    color: #ffe1e1;
    font-weight: 600;
    text-align: center;
  }
  @media (max-width: 600px){
    .probabilities {
      flex-direction: column;
      gap: 12px;
    }
    .probability-box {
      width: 100%;
    }
  }
</style>
</head>
<body>

<div class="container" role="main" aria-label="Pronosticador de partido de fútbol con análisis cuantitativo y cualitativo">
  <h1>Pronosticador de Fútbol</h1>
  <form id="forecastForm" novalidate>
    <div>
      <label for="golesFavor">Goles a favor (temporada)</label>
      <input type="number" id="golesFavor" min="0" max="200" step="1" value="25" required />
    </div>
    <div>
      <label for="golesContra">Goles en contra (temporada)</label>
      <input type="number" id="golesContra" min="0" max="200" step="1" value="15" required />
    </div>
    <div>
      <label for="partidosJugados">Partidos jugados</label>
      <input type="number" id="partidosJugados" min="1" max="100" step="1" value="10" required />
    </div>
    <div>
      <label for="posesion">Posesión promedio (%)</label>
      <input type="number" id="posesion" min="0" max="100" step="1" value="55" required />
    </div>
    <div>
      <label for="tirosPuerta">Tiros a puerta promedio</label>
      <input type="number" id="tirosPuerta" min="0" max="30" step="1" value="8" required />
    </div>
    <div>
      <label for="racha">Racha reciente (últimos 5 partidos)</label>
      <select id="racha" required>
        <option value="2">Muy buena</option>
        <option value="1">Buena</option>
        <option value="0" selected>Neutral</option>
        <option value="-1">Mala</option>
        <option value="-2">Muy mala</option>
      </select>
    </div>
    <div>
      <label for="xg">Promedio goles esperados (xG)</label>
      <input type="number" id="xg" min="0" max="10" step="0.1" value="1.8" required />
    </div>
    <div>
      <label for="lesionados">Número de lesionados clave</label>
      <input type="number" id="lesionados" min="0" max="11" step="1" value="1" required />
    </div>
    <div>
      <label for="importancia">Importancia del partido</label>
      <select id="importancia" required>
        <option value="1.2">Alta</option>
        <option value="1.0" selected>Media</option>
        <option value="0.8">Baja</option>
      </select>
    </div>
    <div>
      <label for="localia">Localía</label>
      <select id="localia" required>
        <option value="1.15" selected>Sí</option>
        <option value="0.85">No</option>
      </select>
    </div>
    <div>
      <label for="clima">Estado del clima</label>
      <select id="clima" required>
        <option value="1">Bueno</option>
        <option value="0.9">Lluvia</option>
        <option value="0.85">Frío</option>
      </select>
    </div>
    <div>
      <label for="moral">Moral del equipo</label>
      <select id="moral" required>
        <option value="1.15">Alta</option>
        <option value="1.0" selected>Media</option>
        <option value="0.85">Baja</option>
      </select>
    </div>

    <button type="submit">Calcular pronóstico</button>
  </form>

  <div id="error" class="error" style="display:none" role="alert"></div>

  <section id="resultado" class="result" aria-live="polite" style="display:none">
    <h2>Resultado del Pronóstico</h2>
    <div class="probabilities">
      <div class="probability-box" aria-label="Probabilidad de victoria local">
        <h3 id="probLocal">—</h3>
        <p>Probabilidad Victoria Local</p>
      </div>
      <div class="probability-box" aria-label="Probabilidad de empate">
        <h3 id="probEmpate">—</h3>
        <p>Probabilidad Empate</p>
      </div>
      <div class="probability-box" aria-label="Probabilidad de victoria visitante">
        <h3 id="probVisitante">—</h3>
        <p>Probabilidad Victoria Visitante</p>
      </div>
    </div>
    <div class="summary" id="comentarios"></div>
  </section>
</div>

<script>
  // Funciones auxiliares
  function validarNumero(input, min, max) {
    const val = Number(input.value);
    return !(isNaN(val) || val < min || val > max);
  }

  function formatearPorcentaje(n) {
    return (n * 100).toFixed(1) + '%';
  }

  // Modelo básico Poisson + ajustes cualitativos
  function calcularPronostico(data) {
    /*
    data = {
      golesFavor,
      golesContra,
      partidosJugados,
      posesion,
      tirosPuerta,
      racha,
      xg,
      lesionados,
      importancia,
      localia,
      clima,
      moral
    }
    */

    // Cálculo base lambda (goles esperados) ponderando xG y promedio goles
    let mediaGoles = (data.golesFavor / data.partidosJugados + data.xg) / 2;

    // Ajustes cualitativos combinados (multiplicadores)
    const factorLesionados = 1 - (data.lesionados * 0.04); // -4% por lesionado
    const factorImportancia = data.importancia; // 1.2 / 1.0 / 0.8
    const factorLocalia = data.localia; // 1.15 / 0.85
    const factorClima = data.clima; // 1 / 0.9 / 0.85
    const factorMoral = data.moral; // 1.15 / 1.0 / 0.85
    const factorRacha = 1 + (data.racha * 0.04); // ±4% por nivel racha

    // Producto total
    let factorTotal = factorLesionados * factorImportancia * factorLocalia * factorClima * factorMoral * factorRacha;

    // Ajuste final lambda (limitado)
    let lambda = mediaGoles * factorTotal;
    if(lambda < 0.1) lambda = 0.1;

    // Probabilidades estimadas 1X2 simplificadas:
    // Usamos un modelo sencillo donde:
    // Probabilidad local = lambda / (lambda + 1)
    // Probabilidad visitante = 1 / (lambda + 1)
    // Probabilidad empate = 1 - suma anterior

    let probLocal = lambda / (lambda + 1);
    let probVisitante = 1 / (lambda + 1);
    let probEmpate = 1 - (probLocal + probVisitante);

    // Normalizar en caso de errores
    if(probEmpate < 0) probEmpate = 0;
    const suma = probLocal + probEmpate + probVisitante;
    probLocal /= suma;
    probEmpate /= suma;
    probVisitante /= suma;

    return {
      probLocal,
      probEmpate,
      probVisitante,
      lambda,
      factores: {
        factorLesionados,
        factorImportancia,
        factorLocalia,
        factorClima,
        factorMoral,
        factorRacha,
      }
    };
  }

  // Generar comentarios cualitativos según factores
  function generarComentarios(factores, data) {
    let comentarios = [];

    if(data.lesionados > 0){
      comentarios.push(`Hay ${data.lesionados} jugador(es) clave lesionado(s), lo que reduce la probabilidad de victoria.`);
    } else {
      comentarios.push("No hay jugadores clave lesionados, equipo completo.");
    }

    if(data.localia > 1){
      comentarios.push("Juegan en casa, lo que les da ventaja.");
    } else {
      comentarios.push("Juegan como visitante, lo que puede ser un reto.");
    }

    if(data.importancia > 1){
      comentarios.push("El partido es de alta importancia, se espera mayor concentración.");
    } else if(data.importancia < 1){
      comentarios.push("El partido tiene baja importancia, posiblemente menos intensidad.");
    } else {
      comentarios.push("El partido tiene importancia media.");
    }

    if(data.moral > 1){
      comentarios.push("El equipo tiene alta moral, lo que puede mejorar el rendimiento.");
    } else if(data.moral < 1){
      comentarios.push("La moral del equipo es baja, podrían jugar con menos confianza.");
    } else {
      comentarios.push("La moral del equipo es estable.");
    }

    if(data.racha > 0){
      comentarios.push("El equipo viene en buena racha.");
    } else if(data.racha < 0){
      comentarios.push("El equipo viene en mala racha.");
    } else {
      comentarios.push("El equipo tiene racha neutral.");
    }

    if(data.clima < 1){
      comentarios.push("El clima adverso puede afectar el rendimiento.");
    } else {
      comentarios.push("El clima es favorable para el juego.");
    }

    return comentarios.join(' ');
  }

  // Manejo del formulario
  const form = document.getElementById('forecastForm');
  const errorBox = document.getElementById('error');
  const resultadoBox = document.getElementById('resultado');
  const probLocalElem = document.getElementById('probLocal');
  const probEmpateElem = document.getElementById('probEmpate');
  const probVisitanteElem = document.getElementById('probVisitante');
  const comentariosElem = document.getElementById('comentarios');

  form.addEventListener('submit', e => {
    e.preventDefault();
    errorBox.style.display = 'none';
    resultadoBox.style.display = 'none';

    // Validación
    const inputs = form.querySelectorAll('input, select');
    for(let input of inputs){
      if(!input.checkValidity()){
        errorBox.textContent = `Por favor ingresa un valor válido en "${input.previousElementSibling.textContent}"`;
        errorBox.style.display = 'block';
        input.focus();
        return;
      }
    }

    // Leer datos
    const data = {
      golesFavor: Number(form.golesFavor.value),
      golesContra: Number(form.golesContra.value),
      partidosJugados: Number(form.partidosJugados.value),
      posesion: Number(form.posesion.value),
      tirosPuerta: Number(form.tirosPuerta.value),
      racha: Number(form.racha.value),
      xg: Number(form.xg.value),
      lesionados: Number(form.lesionados.value),
      importancia: Number(form.importancia.value),
      localia: Number(form.localia.value),
      clima: Number(form.clima.value),
      moral: Number(form.moral.value)
    };

    // Calcular pronóstico
    const res = calcularPronostico(data);

    // Mostrar resultados
    probLocalElem.textContent = formatearPorcentaje(res.probLocal);
    probEmpateElem.textContent = formatearPorcentaje(res.probEmpate);
    probVisitanteElem.textContent = formatearPorcentaje(res.probVisitante);

    comentariosElem.textContent = generarComentarios(res.factores, data);

    resultadoBox.style.display = 'block';
    resultadoBox.focus();
  });
</script>

</body>
</html>