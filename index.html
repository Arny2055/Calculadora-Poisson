<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Betting Intelligence Pro - Analizador de ROI</title>
    <style>
        :root {
            --bg: #0f172a; --card: #1e293b; --text: #f8fafc;
            --accent: #3b82f6; --success: #10b981; --danger: #ef4444; --gold: #fbbf24;
        }
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; line-height: 1.5; }
        .container { max-width: 1400px; margin: auto; }
        
        /* Header & Input */
        .header { text-align: center; padding: 20px; background: var(--card); border-radius: 15px; margin-bottom: 20px; border-bottom: 4px solid var(--accent); }
        textarea { width: 100%; height: 120px; background: #334155; color: white; border: 1px solid #475569; border-radius: 8px; padding: 12px; font-family: monospace; font-size: 11px; box-sizing: border-box; }
        .btn-main { background: var(--accent); color: white; border: none; padding: 18px; cursor: pointer; border-radius: 8px; font-weight: bold; width: 100%; font-size: 16px; margin: 15px 0; transition: 0.3s; }
        .btn-main:hover { background: #2563eb; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4); }

        /* Dashboard Grid */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
        .card { background: var(--card); border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        h2, h3 { margin-top: 0; color: var(--gold); font-size: 18px; text-transform: uppercase; letter-spacing: 1px; }

        /* Tables & Lists */
        .row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #334155; font-size: 14px; align-items: center; }
        .roi-tag { font-weight: bold; padding: 4px 8px; border-radius: 5px; min-width: 60px; text-align: center; }
        .pos { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .neg { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        
        /* Specific Sections */
        .league-section { margin-bottom: 40px; border-top: 2px solid #334155; padding-top: 20px; }
        .league-title { font-size: 22px; color: var(--text); margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .badge { background: var(--accent); font-size: 12px; padding: 3px 10px; border-radius: 20px; }

        .summary-box { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: #1e3a8a; padding: 15px; border-radius: 10px; text-align: center; }
        .stat-num { font-size: 24px; font-weight: bold; display: block; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>üìä Betting Intelligence Hub</h1>
        <p>Analizador de Valor, ROI por Micro-Rangos y Patrones Temporales</p>
    </div>

    <textarea id="dataInput" placeholder="Pega tus datos aqu√≠ (incluyendo la fila de encabezados)..."></textarea>
    <button class="btn-main" onclick="runGlobalAnalysis()">EJECUTAR AN√ÅLISIS DE RENTABILIDAD MAESTRO</button>

    <div id="dashboard" style="display:none;">
        <div class="summary-box">
            <div class="stat-card">
                <span class="stat-num" id="totalRoi">0%</span>
                <span style="font-size:12px;">ROI GLOBAL</span>
            </div>
            <div class="stat-card" style="background: #312e81;">
                <span class="stat-num" id="winRate">0%</span>
                <span style="font-size:12px;">% ACIERTO</span>
            </div>
            <div class="stat-card" style="background: #4c1d95;">
                <span class="stat-num" id="bankrollReq">0 u.</span>
                <span style="font-size:12px;">BANKROLL SEGURO</span>
            </div>
            <div class="stat-card" style="background: #831843;">
                <span class="stat-num" id="maxDrawdown">0</span>
                <span style="font-size:12px;">PEOR RACHA</span>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h3>üéØ ROI por Rango de Cuotas (0.10)</h3>
                <div id="oddsContainer"></div>
            </div>
            <div class="card">
                <h3>üïí Patrones de Tiempo Globales</h3>
                <div id="timeStats"></div>
            </div>
        </div>

        <h2 style="margin-top:40px; border-bottom: 2px solid var(--gold); padding-bottom: 10px;">üî¨ Desglose Detallado por Liga</h2>
        <div id="leagueBreakdown"></div>
    </div>
</div>

<script>
function runGlobalAnalysis() {
    const input = document.getElementById('dataInput').value.trim();
    if (!input) return;

    const lines = input.split('\n');
    const headers = lines[0].split('\t').map(h => h.trim().toLowerCase());
    const find = (keys) => headers.findIndex(h => keys.some(k => h.includes(k)));

    const idx = {
        league: find(['league', 'liga']),
        date: find(['date', 'fecha']),
        match: find(['match']),
        result: headers.lastIndexOf('result'),
        odd: find(['odd'])
    };

    let global = { s:0, r:0, w:0, streaks: {curr:0, max:0}, odds:{}, leagues:{} };
    let currentLossStreak = 0;

    lines.slice(1).forEach(line => {
        const col = line.split('\t').map(c => c.trim());
        if (col.length < 5) return;

        const isWin = col.some((c, i) => i >= idx.result && c.toLowerCase() === 'winning');
        const odd = parseFloat(col[idx.odd]?.replace(',','.')) || 0;
        const league = col[idx.league] || "Otras";
        const dateStr = col[idx.date] || "";
        
        // --- C√°lculo Global y Rachas ---
        global.s++;
        if(isWin) {
            global.r += odd; global.w++;
            global.streaks.max = Math.max(global.streaks.max, currentLossStreak);
            currentLossStreak = 0;
        } else {
            currentLossStreak++;
        }

        // --- Micro-Rangos de Cuotas (0.10) ---
        if(odd > 0) {
            const floor = (Math.floor(odd * 10) / 10).toFixed(2);
            const range = `${floor} - ${(parseFloat(floor)+0.10).toFixed(2)}`;
            if(!global.odds[range]) global.odds[range] = {s:0, r:0, w:0};
            global.odds[range].s++; global.odds[range].r += (isWin ? odd : 0);
            if(isWin) global.odds[range].w++;
        }

        // --- Estructura por Liga ---
        if(!global.leagues[league]) global.leagues[league] = { s:0, r:0, days:{}, hours:{} };
        const L = global.leagues[league];
        L.s++; L.r += (isWin ? odd : 0);

        // D√≠a y Hora
        let day = "N/A", hourSlot = "N/A";
        const d = dateStr.toLowerCase();
        if(d.includes('lun')) day="Lunes"; else if(d.includes('mar')) day="Martes"; 
        else if(d.includes('mi√©')) day="Mi√©rcoles"; else if(d.includes('jue')) day="Jueves";
        else if(d.includes('vie')) day="Viernes"; else if(d.includes('s√°b')) day="S√°bado";
        else if(d.includes('dom')) day="Domingo";

        const timeMatch = dateStr.match(/(\d{2}):(\d{2})/);
        const hh = timeMatch ? parseInt(timeMatch[1]) : -1;
        if(hh >= 5 && hh < 13) hourSlot="Ma√±ana"; else if(hh >= 13 && hh < 18) hourSlot="Tarde";
        else if(hh >= 18 && hh < 22) hourSlot="Noche"; else if(hh >= 22 || (hh >= 0 && hh < 5)) hourSlot="Madrugada";

        if(!L.days[day]) L.days[day] = {s:0, r:0}; L.days[day].s++; L.days[day].r += (isWin ? odd : 0);
        if(!L.hours[hourSlot]) L.hours[hourSlot] = {s:0, r:0}; L.hours[hourSlot].s++; L.hours[hourSlot].r += (isWin ? odd : 0);
    });

    renderDashboard(global);
}

function renderDashboard(g) {
    document.getElementById('dashboard').style.display = 'block';
    
    // Resumen Superior
    const roiVal = ((g.r/g.s - 1)*100).toFixed(1);
    document.getElementById('totalRoi').innerText = roiVal + "%";
    document.getElementById('totalRoi').style.color = roiVal >= 0 ? 'var(--success)' : 'var(--danger)';
    document.getElementById('winRate').innerText = (g.w/g.s*100).toFixed(1) + "%";
    document.getElementById('maxDrawdown').innerText = g.streaks.max;
    document.getElementById('bankrollReq').innerText = (g.streaks.max * 3 + 5) + " u.";

    // Tabla de Cuotas
    const oddsHtml = Object.entries(g.odds).sort((a,b) => parseFloat(a[0]) - parseFloat(b[0])).map(([range, d]) => {
        const roi = ((d.r/d.s - 1)*100).toFixed(1);
        return `<div class="row"><span>Cuota ${range}</span><span class="roi-tag ${roi>=0?'pos':'neg'}">${roi}%</span></div>`;
    }).join('');
    document.getElementById('oddsContainer').innerHTML = oddsHtml;

    // Desglose Ligas
    const leagueContainer = document.getElementById('leagueBreakdown');
    leagueContainer.innerHTML = "";
    Object.entries(g.leagues).sort((a,b) => b[1].s - a[1].s).forEach(([name, data]) => {
        const lRoi = ((data.r/data.s - 1)*100).toFixed(1);
        const div = document.createElement('div');
        div.className = "league-section";
        div.innerHTML = `
            <div class="league-title">${name} <span class="badge">ROI: ${lRoi}%</span></div>
            <div class="grid">
                <div class="card" style="background: rgba(255,255,255,0.02)">
                    <h3>Mejores D√≠as</h3>
                    ${Object.entries(data.days).sort((a,b) => (b[1].r/b[1].s)-(a[1].r/a[1].s)).map(([d,s]) => {
                        const r = ((s.r/s.s-1)*100).toFixed(0);
                        return `<div class="row"><span>${d}</span><span class="${r>=0?'roi-pos':'roi-neg'}">${r}% ROI</span></div>`;
                    }).join('')}
                </div>
                <div class="card" style="background: rgba(255,255,255,0.02)">
                    <h3>Mejores Horas</h3>
                    ${Object.entries(data.hours).sort((a,b) => (b[1].r/b[1].s)-(a[1].r/a[1].s)).map(([h,s]) => {
                        const r = ((s.r/s.s-1)*100).toFixed(0);
                        return `<div class="row"><span>${h}</span><span class="${r>=0?'roi-pos':'roi-neg'}">${r}% ROI</span></div>`;
                    }).join('')}
                </div>
            </div>
        `;
        leagueContainer.appendChild(div);
    });
}
</script>
</body>
</html>
