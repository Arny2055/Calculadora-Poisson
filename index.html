<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gesti√≥n de Riesgo y Simulador de Rachas</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #3b82f6; --success: #10b981; --danger: #ef4444; --gold: #fbbf24; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 1100px; margin: auto; }
        textarea { width: 100%; height: 80px; background: #334155; color: white; border: 1px solid #475569; border-radius: 8px; padding: 10px; margin-bottom: 10px; }
        .btn { background: var(--accent); color: white; border: none; padding: 15px; cursor: pointer; border-radius: 6px; font-weight: bold; width: 100%; font-size: 16px; margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; border-bottom: 4px solid #334155; }
        .stat-val { font-size: 24px; font-weight: bold; display: block; margin-top: 5px; }
        .danger-val { color: var(--danger); }
        .success-val { color: var(--success); }
        .advice-box { background: rgba(59, 130, 246, 0.1); border: 1px dashed var(--accent); padding: 15px; border-radius: 8px; margin-top: 20px; font-size: 14px; }
    </style>
</head>
<body>

<div class="container">
    <h1>üõ°Ô∏è Simulador de Rachas y Gesti√≥n de Riesgo</h1>
    <textarea id="dataInput" placeholder="Pega tus datos aqu√≠..."></textarea>
    <button class="btn" onclick="runRiskAnalysis()">ANALIZAR MI RESISTENCIA AL RIESGO</button>

    <div id="results" style="display:none;">
        <div class="grid">
            <div class="card">
                <h3>üìâ Peor Racha (Consecutiva)</h3>
                <span id="maxLossStreak" class="stat-val danger-val">0</span>
                <p style="font-size:12px; color:#94a3b8;">Partidos seguidos perdiendo.</p>
            </div>
            <div class="card">
                <h3>üìà Mejor Racha (Consecutiva)</h3>
                <span id="maxWinStreak" class="stat-val success-val">0</span>
                <p style="font-size:12px; color:#94a3b8;">Partidos seguidos ganando.</p>
            </div>
            <div class="card" style="border-bottom-color: var(--gold);">
                <h3>üí∞ Bankroll Recomendado</h3>
                <span id="bankReq" class="stat-val" style="color: var(--gold);">0 uds.</span>
                <p style="font-size:12px; color:#94a3b8;">Caja m√≠nima para no quebrar.</p>
            </div>
        </div>

        <div class="advice-box" id="riskAdvice"></div>
    </div>
</div>

<script>
function runRiskAnalysis() {
    const input = document.getElementById('dataInput').value.trim();
    if (!input) return;

    const lines = input.split('\n');
    const headers = lines[0].split('\t').map(h => h.trim().toLowerCase());
    const idxResult = headers.lastIndexOf('result');

    let currentWinStreak = 0;
    let currentLossStreak = 0;
    let maxWin = 0;
    let maxLoss = 0;
    let wins = 0;
    let total = 0;

    lines.slice(1).forEach(line => {
        const col = line.split('\t').map(c => c.trim());
        if (col.length < 5) return;

        const isWin = col.some((c, i) => i >= idxResult && c.toLowerCase() === 'winning');
        total++;

        if (isWin) {
            wins++;
            currentWinStreak++;
            maxLoss = Math.max(maxLoss, currentLossStreak);
            currentLossStreak = 0;
        } else {
            currentLossStreak++;
            maxWin = Math.max(maxWin, currentWinStreak);
            currentWinStreak = 0;
        }
    });
    // Final check for last rows
    maxWin = Math.max(maxWin, currentWinStreak);
    maxLoss = Math.max(maxLoss, currentLossStreak);

    displayRisk(maxWin, maxLoss, wins, total);
}

function displayRisk(mw, ml, w, t) {
    document.getElementById('results').style.display = 'block';
    document.getElementById('maxWinStreak').innerText = mw + " Partidos";
    document.getElementById('maxLossStreak').innerText = ml + " Partidos";
    
    // C√°lculo de Bankroll: 
    // Usamos una f√≥rmula de seguridad: (Peor racha x 3) + margen de varianza
    // Esto asegura que incluso repitiendo tu peor racha 2 veces seguidas, sigas vivo.
    const suggestedBank = (ml * 3) + 5;
    document.getElementById('bankReq').innerText = suggestedBank + " Unidades";

    const winRate = (w/t*100).toFixed(1);
    document.getElementById('riskAdvice').innerHTML = `
        <strong>üí° CONSEJO DE GESTI√ìN:</strong><br>
        Tu tasa de acierto es del <b>${winRate}%</b>. Estad√≠sticamente, con una peor racha de <b>${ml}</b> fallos, 
        cada apuesta no deber√≠a superar el <b>${(100/suggestedBank).toFixed(1)}%</b> de tu capital total. 
        Si tu capital son 1000‚Ç¨, tu apuesta m√°xima (Stake 1) deber√≠a ser de <b>${(1000/suggestedBank).toFixed(0)}‚Ç¨</b>.
    `;
}
</script>
</body>
</html>
