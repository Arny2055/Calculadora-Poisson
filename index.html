<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pronosticador Pro - Home vs Away</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #0f172a; color: #f8fafc; padding: 20px; display: flex; justify-content: center; }
        .container { background: #1e293b; padding: 25px; border-radius: 20px; width: 100%; max-width: 600px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); }
        h1 { text-align: center; color: #38bdf8; font-size: 24px; margin-bottom: 20px; }
        textarea { width: 100%; height: 120px; background: #0f172a; border: 1px solid #334155; border-radius: 12px; color: #cbd5e1; padding: 12px; box-sizing: border-box; font-size: 13px; resize: none; }
        .btns-group { display: flex; gap: 10px; margin-top: 15px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 14px; }
        .btn-analyze { background: #38bdf8; color: #0f172a; }
        .btn-analyze:hover { background: #0ea5e9; }
        .btn-download { background: #10b981; color: white; display: none; }
        .btn-download:hover { background: #059669; }

        /* Estilo de la Tarjeta de Resultado */
        #prediction-card { margin-top: 25px; display: none; background: linear-gradient(135deg, #1e293b 0%, #334155 100%); padding: 25px; border-radius: 15px; border: 1px solid #475569; position: relative; }
        .match-header { display: flex; justify-content: space-between; align-items: center; text-align: center; margin-bottom: 20px; }
        .team-info { flex: 1; }
        .team-name { font-size: 1.4em; font-weight: 800; color: #f8fafc; min-height: 50px; display: flex; align-items: center; justify-content: center; line-height: 1.2; }
        .score-big { font-size: 64px; font-weight: 900; color: #38bdf8; text-shadow: 0 4px 10px rgba(56, 189, 248, 0.3); }
        .vs-circle { background: #475569; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; margin: 0 15px; }
        .badge-prediction { background: rgba(56, 189, 248, 0.1); border: 1px solid #38bdf8; color: #38bdf8; padding: 10px; border-radius: 8px; text-align: center; font-weight: bold; font-size: 1.1em; }
        .market-tip { text-align: center; margin-top: 15px; color: #94a3b8; font-style: italic; }
        .footer-brand { text-align: center; font-size: 10px; margin-top: 20px; opacity: 0.5; letter-spacing: 2px; }
    </style>
</head>
<body>

<div class="container">
    <h1>⚽ Pronóstico de Partido</h1>
    <textarea id="dataInput" placeholder="Pega los datos aquí (Home vs Away Stats)..."></textarea>
    
    <div class="btns-group">
        <button class="btn-analyze" onclick="analyzeData()">ANALIZAR DATOS</button>
        <button id="downloadBtn" class="btn-download" onclick="downloadImage()">DESCARGAR PNG</button>
    </div>

    <div id="prediction-card">
        <div class="match-header">
            <div class="team-info">
                <div class="team-name" id="hName">LOCAL</div>
                <div class="score-big" id="hScore">0</div>
            </div>
            <div class="vs-circle">VS</div>
            <div class="team-info">
                <div class="team-name" id="aName">VISITANTE</div>
                <div class="score-big" id="aScore">0</div>
            </div>
        </div>
        
        <div class="badge-prediction" id="winnerLabel">CARGANDO...</div>
        <div class="market-tip" id="marketLabel">Sugerencia: Analizando mercado...</div>
        
        <div class="footer-brand">GENERADO POR AI SPORTS ANALYTICS</div>
    </div>
</div>

<script>
function analyzeData() {
    const input = document.getElementById('dataInput').value.trim();
    if (!input) return alert("Pega los datos de la tabla primero.");

    const lines = input.split('\n').map(l => l.trim()).filter(l => l !== "");

    // --- EXTRACCIÓN MEJORADA DE NOMBRES ---
    // Buscamos la primera línea que no sea el título "Home vs Away"
    let homeName = "Local";
    let awayName = "Visitante";
    
    if (lines[0].includes("Home vs Away")) {
        homeName = lines[1] || "Local";
        awayName = lines[2] || "Visitante";
    } else {
        homeName = lines[0] || "Local";
        awayName = lines[1] || "Visitante";
    }

    // Limpiar nombres si tienen basura del pegado
    homeName = homeName.split('\t')[0].replace("(home matches)", "").trim();
    awayName = awayName.split('\t')[awayName.split('\t').length-1].replace("(away matches)", "").trim();

    // --- FUNCIÓN DE BÚSQUEDA DE VALORES ---
    const getStats = (key) => {
        const row = lines.find(l => l.toLowerCase().includes(key.toLowerCase()));
        if (!row) return [1.0, 1.0];
        
        // Buscamos los números en la línea o la siguiente
        let combinedText = row + " " + (lines[lines.indexOf(row) + 1] || "");
        let numbers = combinedText.match(/(\d+(\.\d+)?)/g);
        
        if (numbers && numbers.length >= 2) {
            return [parseFloat(numbers[numbers.length-2]), parseFloat(numbers[numbers.length-1])];
        }
        return [1.0, 1.0];
    };

    const gf = getStats("Goals For");
    const ga = getStats("Goals Against");
    const cs = getStats("Clean sheets");

    // Algoritmo
    let expH = (gf[0] + ga[1]) / 2;
    let expA = (gf[1] + ga[0]) / 2;
    
    // Ajuste por defensa
    expH -= (cs[1] / 100);
    expA -= (cs[0] / 100);

    const resH = Math.max(0, Math.round(expH + 0.2)); // Pequeña ventaja local
    const resA = Math.max(0, Math.round(expA));

    // Renderizar
    document.getElementById('hName').innerText = homeName.toUpperCase();
    document.getElementById('aName').innerText = awayName.toUpperCase();
    document.getElementById('hScore').innerText = resH;
    document.getElementById('aScore').innerText = resA;

    // Etiquetas
    let status = "EMPATE TÉCNICO";
    if (resH > resA) status = `VICTORIA ${homeName.toUpperCase()}`;
    if (resA > resH) status = `VICTORIA ${awayName.toUpperCase()}`;
    
    document.getElementById('winnerLabel').innerText = status;
    document.getElementById('marketLabel').innerText = (resH + resA >= 2.5) ? "Sugerencia: Over 2.5 Goles" : "Sugerencia: Under 2.5 Goles";

    // Mostrar resultados
    document.getElementById('prediction-card').style.display = 'block';
    document.getElementById('downloadBtn').style.display = 'block';
}

function downloadImage() {
    const card = document.getElementById('prediction-card');
    html2canvas(card, { backgroundColor: '#1e293b', scale: 2 }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'pronostico_partido.png';
        link.href = canvas.toDataURL();
        link.click();
    });
}
</script>

</body>
</html>
