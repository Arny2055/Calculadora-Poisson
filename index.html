<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Analizador de Goles HT - Selector Autom√°tico</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #3b82f6; --success: #10b981; --danger: #ef4444; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 1100px; margin: auto; }
        textarea { width: 100%; height: 120px; background: #334155; color: white; border: 1px solid #475569; border-radius: 8px; padding: 12px; margin-bottom: 10px; font-size: 12px; }
        .btn { background: var(--accent); color: white; border: none; padding: 14px; cursor: pointer; border-radius: 6px; font-weight: bold; width: 100%; font-size: 16px; margin-bottom: 20px; }
        .btn:hover { background: #2563eb; }
        .error { background: #450a0a; color: #fecaca; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #991b1b; display: none; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; border-bottom: 4px solid var(--accent); }
        .card h3 { margin-top: 0; font-size: 14px; color: #94a3b8; text-transform: uppercase; }
        .item { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #334155; font-size: 14px; }
        .val { font-weight: bold; color: var(--success); }
        .summary { background: #064e3b; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 6px solid var(--success); }
    </style>
</head>
<body>

<div class="container">
    <h1>üöÄ Analizador Autom√°tico de Patrones</h1>
    <div id="errorBox" class="error"></div>
    
    <textarea id="dataInput" placeholder="Pega aqu√≠ toda la informaci√≥n, incluyendo los encabezados..."></textarea>
    <button class="btn" onclick="analyze()">ANALIZAR DATOS</button>

    <div id="results" style="display:none;">
        <div id="bestInsight" class="summary"></div>
        
        <div class="grid">
            <div class="card">
                <h3>üåç Mejores Ligas</h3>
                <div id="resLigas"></div>
            </div>
            <div class="card">
                <h3>üìà Rentabilidad por Cuota</h3>
                <div id="resCuotas"></div>
            </div>
            <div class="card">
                <h3>‚ö° Ataques Peligrosos</h3>
                <div id="resAtaques"></div>
            </div>
        </div>
    </div>
</div>

<script>
function analyze() {
    const errorBox = document.getElementById('errorBox');
    errorBox.style.display = 'none';
    errorBox.innerHTML = '';

    const input = document.getElementById('dataInput').value.trim();
    if (!input) return;

    const lines = input.split('\n');
    const headerLine = lines[0].toLowerCase();
    
    // Detector de separador (Tabulador o Coma)
    const sep = headerLine.includes('\t') ? '\t' : (headerLine.includes(';') ? ';' : ',');
    const headers = headerLine.split(sep).map(h => h.trim());

    // BUSCADOR FLEXIBLE DE COLUMNAS (Clave para que no falle)
    const findCol = (keywords) => headers.findIndex(h => keywords.some(k => h.includes(k)));

    const idx = {
        league: findCol(['league', 'liga']),
        match: findCol(['match', 'partido']),
        result: headers.findIndex(h => h === 'result' || (h.includes('result') && !h.includes('notification') && !h.includes('ht'))),
        odd: findCol(['live odd', 'odd live', 'outcome live']),
        daHome: findCol(['home dangerous attacks at notification']),
        daAway: findCol(['away dangerous attacks at notification'])
    };

    // Validar columnas esenciales
    if (idx.league === -1 || idx.result === -1) {
        errorBox.style.display = 'block';
        errorBox.innerHTML = `‚ö†Ô∏è No detectamos las columnas. Aseg√∫rate de copiar los encabezados. <br> Buscando: "League", "Result". Detectado: ${headers.slice(0,3).join(', ')}...`;
        return;
    }

    let stats = { ligas: {}, cuotas: {baja:{w:0,t:0}, alta:{w:0,t:0}}, ataques: {fuerte:{w:0,t:0}, debil:{w:0,t:0}} };

    lines.slice(1).forEach(line => {
        const col = line.split(sep);
        if (col.length < headers.length) return;

        const isWin = col[idx.result] && col[idx.result].toLowerCase().includes('winning');
        const liga = col[idx.league] || 'Otros';
        const cuota = parseFloat(col[idx.odd] ? col[idx.odd].replace(',', '.') : 0);
        const daTotales = (parseInt(col[idx.daHome]) || 0) + (parseInt(col[idx.daAway]) || 0);

        // Ligas
        if (!stats.ligas[liga]) stats.ligas[liga] = {w:0, t:0};
        stats.ligas[liga].t++; if(isWin) stats.ligas[liga].w++;

        // Cuotas
        if (cuota > 0) {
            const cat = cuota >= 1.30 ? 'alta' : 'baja';
            stats.cuotas[cat].t++; if(isWin) stats.cuotas[cat].w++;
        }

        // Ataques
        const catAtq = daTotales >= 3 ? 'fuerte' : 'debil';
        stats.ataques[catAtq].t++; if(isWin) stats.ataques[catAtq].w++;
    });

    render(stats);
}

function render(s) {
    document.getElementById('results').style.display = 'block';
    
    // Ligas
    const sortedLigas = Object.entries(s.ligas).sort((a,b) => (b[1].w/b[1].t) - (a[1].w/a[1].t)).slice(0,5);
    document.getElementById('resLigas').innerHTML = sortedLigas.map(([n, v]) => 
        `<div class="item"><span>${n}</span><span class="val">${(v.w/v.t*100).toFixed(0)}%</span></div>`).join('');

    // Cuotas
    document.getElementById('resCuotas').innerHTML = `
        <div class="item"><span>1.10 - 1.29</span><span class="val">${(s.cuotas.baja.w/s.cuotas.baja.t*100 || 0).toFixed(1)}%</span></div>
        <div class="item"><span>1.30 o m√°s</span><span class="val">${(s.cuotas.alta.w/s.cuotas.alta.t*100 || 0).toFixed(1)}%</span></div>
    `;

    // Ataques
    document.getElementById('resAtaques').innerHTML = `
        <div class="item"><span>‚â• 3 Atq. Peligrosos</span><span class="val">${(s.ataques.fuerte.w/s.ataques.fuerte.t*100 || 0).toFixed(1)}%</span></div>
        <div class="item"><span>< 3 Atq. Peligrosos</span><span class="val">${(s.ataques.debil.w/s.ataques.debil.t*100 || 0).toFixed(1)}%</span></div>
    `;

    const mejorLiga = sortedLigas[0];
    document.getElementById('bestInsight').innerHTML = `
        <strong>üéØ PATR√ìN DE ORO:</strong> En la liga <b>${mejorLiga[0]}</b> tienes un <b>${(mejorLiga[1].w/mejorLiga[1].t*100).toFixed(0)}%</b> de acierto. 
        ${s.ataques.fuerte.w/s.ataques.fuerte.t > 0.8 ? "<br>üî• <b>Dato Clave:</b> Cuando hay presi√≥n (+3 ataques), el acierto es masivo." : ""}
    `;
}
</script>
</body>
</html>
