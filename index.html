<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Planificador de Valor Semanal - Betting AI</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #3b82f6; --success: #10b981; --danger: #ef4444; --gold: #fbbf24; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 1200px; margin: auto; }
        textarea { width: 100%; height: 100px; background: #334155; color: white; border: 1px solid #475569; border-radius: 8px; padding: 10px; font-size: 11px; margin-bottom: 10px; }
        .btn { background: var(--accent); color: white; border: none; padding: 15px; cursor: pointer; border-radius: 6px; font-weight: bold; width: 100%; font-size: 16px; transition: 0.3s; }
        .btn:hover { background: #2563eb; transform: scale(1.01); }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; border-top: 4px solid var(--accent); }
        .plan-box { background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%); padding: 25px; border-radius: 15px; margin-bottom: 25px; border: 1px solid var(--accent); }
        .day-badge { background: var(--accent); color: white; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; text-transform: uppercase; }
        .roi-tag { font-weight: bold; color: var(--success); }
        .team-line { border-bottom: 1px solid #334155; padding: 10px 0; display: flex; justify-content: space-between; align-items: center; }
        h2, h3 { margin-top: 0; }
    </style>
</head>
<body>

<div class="container">
    <div class="plan-box">
        <h2>üóìÔ∏è Tu Plan de Apuesta Semanal</h2>
        <p id="planIntro">Pega tus datos para generar la estrategia basada en ROI real.</p>
        <div id="weeklyPlanGrid" class="grid" style="margin-top:20px;"></div>
    </div>

    <textarea id="dataInput" placeholder="Pega aqu√≠ tu historial completo (incluyendo encabezados)..."></textarea>
    <button class="btn" onclick="generateStrategy()">GENERAR PLAN SEMANAL DE VALOR</button>

    <div id="detailedStats" class="grid" style="display:none; margin-top:20px;">
        <div class="card">
            <h3>üìà ROI por D√≠a de la Semana</h3>
            <div id="daysRoi"></div>
        </div>
        <div class="card">
            <h3>üî• Equipos "Mina de Oro"</h3>
            <div id="goldTeams"></div>
        </div>
    </div>
</div>

<script>
function generateStrategy() {
    const input = document.getElementById('dataInput').value.trim();
    const lines = input.split('\n');
    const headers = lines[0].split('\t').map(h => h.trim().toLowerCase());

    const find = (keys) => headers.findIndex(h => keys.some(k => h.includes(k)));
    const idx = { date: find(['date', 'fecha']), match: find(['match']), result: headers.lastIndexOf('result'), odd: find(['odd']) };

    let stats = { days: {}, teams: {} };

    lines.slice(1).forEach(line => {
        const col = line.split('\t').map(c => c.trim());
        if (col.length < 5) return;

        const isWin = col.some((c, i) => i >= idx.result && c.toLowerCase() === 'winning');
        const odd = parseFloat(col[idx.odd]?.replace(',','.')) || 1.0;
        const [hT, aT] = col[idx.match] ? col[idx.match].split(' - ') : ['?', '?'];
        
        let dName = "Otro";
        const dateStr = col[idx.date]?.toLowerCase() || "";
        if(dateStr.includes('lun')) dName = "Lunes";
        else if(dateStr.includes('mar')) dName = "Martes";
        else if(dateStr.includes('mi√©')) dName = "Mi√©rcoles";
        else if(dateStr.includes('jue')) dName = "Jueves";
        else if(dateStr.includes('vie')) dName = "Viernes";
        else if(dateStr.includes('s√°b')) dName = "S√°bado";
        else if(dateStr.includes('dom')) dName = "Domingo";

        const ret = isWin ? odd : 0;

        if(!stats.days[dName]) stats.days[dName] = {s:0, r:0};
        stats.days[dName].s += 1; stats.days[dName].r += ret;

        [hT, aT].forEach(t => {
            if(!t) return;
            if(!stats.teams[t]) stats.teams[t] = {s:0, r:0, lastDay: dName};
            stats.teams[t].s += 1; stats.teams[t].r += ret;
            stats.teams[t].lastDay = dName;
        });
    });

    renderAll(stats);
}

function renderAll(s) {
    document.getElementById('detailedStats').style.display = 'grid';
    const planGrid = document.getElementById('weeklyPlanGrid');
    planGrid.innerHTML = "";

    // 1. Filtrar los 10 mejores equipos por ROI (m√≠nimo 2 partidos)
    const bestTeams = Object.entries(s.teams)
        .map(([name, d]) => ({ name, roi: ((d.r/d.s-1)*100), day: d.lastDay, games: d.s }))
        .filter(t => t.games > 1 && t.roi > 0)
        .sort((a,b) => b.roi - a.roi);

    // 2. Agrupar equipos por su d√≠a m√°s frecuente de juego
    const days = ["Lunes", "Martes", "Mi√©rcoles", "Jueves", "Viernes", "S√°bado", "Domingo"];
    
    days.forEach(day => {
        const teamsForDay = bestTeams.filter(t => t.day === day);
        const dayData = s.days[day] || {s:0, r:0};
        const dayRoi = dayData.s > 0 ? ((dayData.r/dayData.s-1)*100).toFixed(1) : "0";

        if(teamsForDay.length > 0 || dayRoi > 0) {
            const card = document.createElement('div');
            card.className = "card";
            card.style.borderTop = dayRoi > 0 ? "4px solid var(--success)" : "4px solid var(--danger)";
            card.innerHTML = `
                <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                    <span class="day-badge">${day}</span>
                    <span class="roi-tag">${dayRoi}% ROI</span>
                </div>
                ${teamsForDay.map(t => `
                    <div class="team-line">
                        <span style="font-size:13px;">${t.name}</span>
                        <span class="roi-tag" style="font-size:11px;">+${t.roi.toFixed(0)}%</span>
                    </div>
                `).join('')}
            `;
            planGrid.appendChild(card);
        }
    });

    // 3. Stats Detalladas (D√≠as)
    document.getElementById('daysRoi').innerHTML = Object.entries(s.days).map(([n, d]) => `
        <div class="team-line"><span>${n}</span><span class="${(d.r/d.s-1)>=0?'roi-pos':'roi-neg'}">${((d.r/d.s-1)*100).toFixed(1)}%</span></div>
    `).join('');

    document.getElementById('goldTeams').innerHTML = bestTeams.slice(0, 10).map(t => `
        <div class="team-line"><span>${t.name}</span><span class="roi-pos">${t.roi.toFixed(1)}% ROI</span></div>
    `).join('');
}
</script>

</body>
</html>
