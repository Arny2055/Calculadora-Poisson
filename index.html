<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Calculadora de ROI por Equipo (JSON)</title>
<style>
    body { font-family: Arial, sans-serif; background:#f7f7f7; padding:20px; }
    h2 { margin-top:30px; }
    .card {
        background:white; padding:20px; border-radius:10px;
        box-shadow:0 2px 10px rgba(0,0,0,0.1); margin-bottom:25px;
    }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th, td { border:1px solid #ddd; padding:8px; text-align:center; }
    th { background:#333; color:white; }
    #teamROI tbody tr:nth-child(even) { background:#eee; }
    input[type="file"] { margin-top:10px; }
    .success { color:green; font-weight:bold; }
    .fail { color:red; font-weight:bold; }
</style>
</head>
<body>

<h1>ðŸ“Š Calculadora de ROI por Equipo (JSON)</h1>

<div class="card">
    <h3>Subir Archivo(s) JSON</h3>
    <input type="file" id="fileInput" accept=".json" multiple>
</div>

<div class="card">
    <h2>Resultados por Partido</h2>
    <table id="matchTable">
        <thead>
            <tr>
                <th>Fecha</th>
                <th>Liga</th>
                <th>Partido</th>
                <th>Pick</th>
                <th>Odd</th>
                <th>Resultado</th>
                <th>Ganancia</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<div class="card">
    <h2>ROI por Equipo</h2>
    <table id="teamROI">
        <thead>
            <tr>
                <th>Equipo</th>
                <th>Partidos</th>
                <th>Ganadas</th>
                <th>ROI %</th>
                <th>Beneficio</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
// --- CONFIG ---
const STAKE = 1;      // 1 unidad por apuesta
const INITIAL_BANK = 100;

document.getElementById("fileInput").addEventListener("change", handleFiles);

function handleFiles(event) {
    const files = event.target.files;
    [...files].forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
            try {
                const jsonString = e.target.result;

                // Puede venir como JSON individual o lista separada por comas
                let data = JSON.parse("[" + jsonString.replace(/,\s*$/, "") + "]");

                processMatches(data);
            } catch(err) {
                alert("Error leyendo el archivo JSON: " + err);
            }
        };
        reader.readAsText(file);
    });
}

let teamStats = {}; // ROI por equipo

function processMatches(matches) {
    const tableBody = document.querySelector("#matchTable tbody");

    matches.forEach(m => {
        const { Match, Desired Outcome, Odd, Result, League, Date } = m;

        let gain = 0;
        let statusText = "-";

        if (Result === "Winning") {
            gain = (Odd - 1) * STAKE;
            statusText = "Ganado";
        } else if (Result === "Losing") {
            gain = -STAKE;
            statusText = "Perdido";
        }

        // insert row into table
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${Date}</td>
            <td>${League}</td>
            <td>${Match}</td>
            <td>${Desired Outcome}</td>
            <td>${Odd}</td>
            <td class="${statusText === 'Ganado' ? 'success' : statusText === 'Perdido' ? 'fail' : ''}">${statusText}</td>
            <td>${gain.toFixed(2)}</td>
        `;
        tableBody.appendChild(row);

        // ROI por equipo (solo historial)
        if (Result === "Winning" || Result === "Losing") {
            updateTeamROI(Match, gain);
        }
    });

    renderTeamROI();
}

function updateTeamROI(matchName, gain) {
    const [home, away] = matchName.split(" - ");

    [home, away].forEach(team => {
        if (!teamStats[team]) {
            teamStats[team] = { matches: 0, win: 0, profit: 0 };
        }
        teamStats[team].matches++;
        if (gain > 0) teamStats[team].win++;
        teamStats[team].profit += gain;
    });
}

function renderTeamROI() {
    const tbody = document.querySelector("#teamROI tbody");
    tbody.innerHTML = "";

    for (const team in teamStats) {
        const t = teamStats[team];
        const roi = (t.profit / (t.matches * STAKE)) * 100;

        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${team}</td>
            <td>${t.matches}</td>
            <td>${t.win}</td>
            <td>${roi.toFixed(2)} %</td>
            <td>${t.profit.toFixed(2)}</td>
        `;
        tbody.appendChild(row);
    }
}
</script>

</body>
</html>