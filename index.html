<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Analizador Pro - Patrones de Goles HT</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f172a; color: #f8fafc; padding: 20px; }
        .container { max-width: 1200px; margin: auto; background: #1e293b; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
        textarea { width: 100%; height: 150px; background: #334155; color: white; border: 1px solid #475569; border-radius: 8px; padding: 12px; margin-bottom: 15px; }
        button { background: #3b82f6; color: white; border: none; padding: 12px 24px; cursor: pointer; border-radius: 6px; font-weight: bold; width: 100%; font-size: 16px; }
        button:hover { background: #2563eb; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 20px; }
        .card { background: #334155; padding: 20px; border-radius: 10px; border-top: 4px solid #3b82f6; }
        .card h3 { margin: 0; font-size: 13px; text-transform: uppercase; color: #94a3b8; }
        .card p { margin: 8px 0 0; font-size: 28px; font-weight: bold; }
        .pattern-engine { margin-top: 30px; background: #064e3b; border: 1px solid #10b981; padding: 20px; border-radius: 10px; }
        .pattern-engine h2 { color: #34d399; margin-top: 0; }
        .insight-item { background: rgba(255,255,255,0.1); padding: 10px; margin: 8px 0; border-radius: 5px; border-left: 4px solid #10b981; }
        .highlight { color: #fbbf24; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>üî¨ Buscador de Patrones HT</h1>
    <p>Pega tus datos desde Excel o la web aqu√≠:</p>
    <textarea id="dataInput" placeholder="Pega las filas con encabezados aqu√≠..."></textarea>
    <button onclick="analyzeData()">EJECUTAR AN√ÅLISIS DE PATRONES</button>

    <div id="results" style="display:none;">
        <div class="grid">
            <div class="card"><h3>Acierto General</h3><p id="statWinRate">0%</p></div>
            <div class="card"><h3>ROI</h3><p id="statROI">0%</p></div>
            <div class="card"><h3>Cuota Promedio</h3><p id="statAvgOdd">0</p></div>
        </div>

        <div class="pattern-engine">
            <h2>üí° Patrones Identificados para Maximizar Acierto</h2>
            <div id="patternList">Analizando correlaciones...</div>
        </div>

        <div id="chartStats" style="margin-top:20px; height: 400px;"></div>
    </div>
</div>

<script>
function analyzeData() {
    const text = document.getElementById('dataInput').value.trim();
    if (!text) return;

    const lines = text.split('\n');
    const headers = lines[0].split('\t').map(h => h.trim());
    const data = lines.slice(1).map(l => l.split('\t'));

    // √çndices din√°micos
    const idx = {
        result: headers.indexOf("Result"),
        oddLive: headers.indexOf("Desired Outcome Live Odd"),
        daHome: headers.indexOf("Home Dangerous Attacks at Notification"),
        daAway: headers.indexOf("Away Dangerous Attacks at Notification"),
        shotsHome: headers.indexOf("Home OnGoal Shots at Notification"),
        min: headers.indexOf("Notification Minute")
    };

    let stats = { wins: 0, total: 0, profit: 0, sumOdds: 0 };
    let matches = [];

    data.forEach(row => {
        if (row.length < 5) return;
        const isWin = row[idx.result] === "Winning";
        const odd = parseFloat(row[idx.oddLive].replace(',', '.')) || 0;
        const da = (parseInt(row[idx.daHome]) || 0) + (parseInt(row[idx.daAway]) || 0);
        const shots = (parseInt(row[idx.shotsHome]) || 0);

        stats.total++;
        if (isWin) {
            stats.wins++;
            if (odd > 0) {
                stats.profit += (odd - 1);
                stats.sumOdds += odd;
            }
        } else {
            stats.profit -= 1;
        }

        matches.push({ isWin, odd, da, shots });
    });

    // Mostrar resultados b√°sicos
    document.getElementById('results').style.display = 'block';
    const wr = (stats.wins / stats.total * 100).toFixed(1);
    document.getElementById('statWinRate').innerText = wr + "%";
    document.getElementById('statROI').innerText = (stats.profit / stats.total * 100).toFixed(1) + "%";
    document.getElementById('statAvgOdd').innerText = (stats.sumOdds / stats.wins || 0).toFixed(2);

    // L√ìGICA DE B√öSQUEDA DE PATRONES
    findBestPatterns(matches, wr);
    plotGraphs(matches);
}

function findBestPatterns(matches, baseWR) {
    const list = document.getElementById('patternList');
    list.innerHTML = "";
    
    let insights = [];

    // 1. Patr√≥n de Ataques Peligrosos (DA)
    for(let threshold = 1; threshold <= 5; threshold++) {
        const filtered = matches.filter(m => m.da >= threshold);
        if(filtered.length > 2) {
            const fWR = (filtered.filter(m => m.isWin).length / filtered.length * 100).toFixed(1);
            if(fWR > baseWR) {
                insights.push(`Filtro DA: Si hay <span class="highlight">‚â• ${threshold} Ataques Peligrosos</span> totales, el acierto sube al <span class="highlight">${fWR}%</span> (${filtered.length} partidos).`);
            }
        }
    }

    // 2. Patr√≥n de Cuotas (Rango de valor)
    const valueOdds = matches.filter(m => m.odd >= 1.35);
    if(valueOdds.length > 2) {
        const vWR = (valueOdds.filter(m => m.isWin).length / valueOdds.length * 100).toFixed(1);
        insights.push(`Filtro Cuota: Entrar con <span class="highlight">Cuota ‚â• 1.35</span> tiene un acierto del <span class="highlight">${vWR}%</span>.`);
    }

    // 3. Patr√≥n de Remates
    const withShots = matches.filter(m => m.shots >= 1);
    if(withShots.length > 2) {
        const sWR = (withShots.filter(m => m.isWin).length / withShots.length * 100).toFixed(1);
        insights.push(`Filtro Shots: Con al menos <span class="highlight">1 remate a puerta</span> del local, el acierto es del <span class="highlight">${sWR}%</span>.`);
    }

    insights.forEach(i => {
        const div = document.createElement('div');
        div.className = "insight-item";
        div.innerHTML = i;
        list.appendChild(div);
    });
}

function plotGraphs(matches) {
    const trace = {
        x: matches.map(m => m.da),
        y: matches.map(m => m.odd),
        mode: 'markers',
        marker: {
            color: matches.map(m => m.isWin ? '#10b981' : '#ef4444'),
            size: 12
        },
        type: 'scatter'
    };
    const layout = {
        title: 'Correlaci√≥n: Ataques vs Cuotas (Verde = Acierto)',
        paper_bgcolor: '#1e293b',
        plot_bgcolor: '#1e293b',
        font: { color: '#fff' },
        xaxis: { title: 'Total Ataques Peligrosos' },
        yaxis: { title: 'Cuota Live' }
    };
    Plotly.newPlot('chartStats', [trace], layout);
}
</script>
</body>
</html>
