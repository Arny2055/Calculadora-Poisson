<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Estadísticas Over/Under</title>
<style>
  :root {
    --bg:#0a0f1c;
    --card:#121826;
    --text:#e5e7eb;
    --accent:#3b82f6;
    --green:#10b981;
    --orange:#f59e0b;
    --red:#ef4444;
  }
  body {
    font-family: "Segoe UI", Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    margin: 0;
    padding: 20px;
  }
  h1 {color: var(--accent); text-align:center;}
  .card {
    background: var(--card);
    border-radius: 12px;
    padding: 16px;
    margin-top: 20px;
    border: 3px solid transparent; /* Contorno dinámico */
    transition: border 0.3s;
  }
  label {display:block; margin:10px 0 5px;}
  select, input, button {
    width: 100%;
    padding: 10px;
    margin-bottom: 12px;
    border-radius: 8px;
    border: 1px solid var(--accent);
    font-size: 16px;
    background: #1f2937;
    color: var(--text);
  }
  button {
    background: var(--accent);
    color: #fff;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
  }
  button:hover {background:#2563eb;}
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    font-size: 15px;
    border-radius: 8px;
    overflow: hidden;
  }
  th, td {
    padding: 10px;
    text-align: center;
  }
  th {
    background: var(--accent);
    color: #fff;
  }
  td {background:#1f2937; color:#fff;}
  .green {color: var(--green); font-weight:bold;}
  .orange {color: var(--orange); font-weight:bold;}
  .red {color: var(--red); font-weight:bold;}
  .valueBox {
    margin-top:15px;
    padding:10px;
    border-radius:8px;
    text-align:center;
    font-weight:bold;
  }
  .value {background: var(--green); color:#fff;}
  .novalue {background: var(--red); color:#fff;}
</style>
</head>
<body>
  <h1>Estadísticas Over/Under</h1>

  <div class="card">
    <input type="file" id="fileInput" accept=".json"><br>
    
    <label>Selecciona Liga:</label>
    <select id="leagueSelect"></select>
    
    <label>Equipo Local:</label>
    <select id="homeSelect"></select>
    
    <label>Equipo Visitante:</label>
    <select id="awaySelect"></select>
    
    <label>Odd Over 2.5:</label>
    <input type="number" id="oddOver" step="0.01" placeholder="Ej: 1.90">
    
    <label>Odd Under 2.5:</label>
    <input type="number" id="oddUnder" step="0.01" placeholder="Ej: 2.00">
    
    <button id="analyzeBtn">Analizar</button>
  </div>
  
  <div id="results" class="card"></div>
  
<script>
let allMatches = [];

function getClass(p){
  if (p >= 70) return "green";
  if (p >= 50) return "orange";
  return "red";
}

function calcOver(matches, team, isHome, line){
  let filtered = matches.filter(m => 
    isHome ? m.Match.startsWith(team) : m.Match.endsWith(team)
  ).slice(-10);

  if (filtered.length === 0) return 0;
  let count = filtered.filter(m=>{
    let [h,a] = m["Result FT"].split("-").map(Number);
    return (h+a) > line;
  }).length;
  return Math.round((count/filtered.length)*100);
}

function analyze(leagueMatches, homeTeam, awayTeam){
  let overs = [0.5,1.5,2.5,3.5];
  let rows = overs.map(line=>{
    let home = calcOver(leagueMatches, homeTeam, true, line);
    let away = calcOver(leagueMatches, awayTeam, false, line);
    let avg = Math.round((home+away)/2);

    return `<tr>
      <td>Over ${line}</td>
      <td class="${getClass(home)}">${home}%</td>
      <td class="${getClass(away)}">${away}%</td>
      <td class="${getClass(avg)}">${avg}%</td>
    </tr>`;
  }).join("");

  return `<table>
    <tr><th></th><th>Home</th><th>Away</th><th>Match</th></tr>
    ${rows}
  </table>`;
}

function valueCheck(prob, odd){
  let implied = 100/odd;
  return prob > implied ? `<div class="valueBox value">VALUE</div>` : `<div class="valueBox novalue">NO VALUE</div>`;
}

// Cargar JSON
document.getElementById("fileInput").addEventListener("change", function(e){
  let file = e.target.files[0];
  let reader = new FileReader();
  reader.onload = function(event){
    allMatches = JSON.parse(event.target.result);
    let leagues = [...new Set(allMatches.map(m=>m.League))];
    
    let leagueSelect = document.getElementById("leagueSelect");
    leagueSelect.innerHTML = "<option value=''>--Selecciona--</option>" +
      leagues.map(l=>`<option value="${l}">${l}</option>`).join("");
  }
  reader.readAsText(file);
});

// Al seleccionar liga, llenar equipos
document.getElementById("leagueSelect").addEventListener("change", function(){
  let league = this.value;
  let leagueMatches = allMatches.filter(m=>m.League === league);
  let teams = [...new Set(leagueMatches.flatMap(m=>m.Match.split(" - ")))];
  
  document.getElementById("homeSelect").innerHTML = teams.map(t=>`<option value="${t}">${t}</option>`).join("");
  document.getElementById("awaySelect").innerHTML = teams.map(t=>`<option value="${t}">${t}</option>`).join("");
});

// Botón analizar
document.getElementById("analyzeBtn").addEventListener("click", function(){
  let league = document.getElementById("leagueSelect").value;
  let homeTeam = document.getElementById("homeSelect").value;
  let awayTeam = document.getElementById("awaySelect").value;
  let oddOver = parseFloat(document.getElementById("oddOver").value);
  let oddUnder = parseFloat(document.getElementById("oddUnder").value);

  if (!league || !homeTeam || !awayTeam) {
    alert("Debes seleccionar liga y equipos.");
    return;
  }
  
  let leagueMatches = allMatches.filter(m=>m.League === league);
  let table = analyze(leagueMatches, homeTeam, awayTeam);

  // cálculo específico para Over 2.5
  let homeOver25 = calcOver(leagueMatches, homeTeam, true, 2.5);
  let awayOver25 = calcOver(leagueMatches, awayTeam, false, 2.5);
  let matchOver25 = Math.round((homeOver25+awayOver25)/2);

  let valueOdds = "";
  if (oddOver && oddUnder){
    valueOdds = `
      <h3>Over 2.5</h3>
      <p>Odd Over: ${oddOver}</p>
      ${valueCheck(matchOver25, oddOver)}
      <p>Odd Under: ${oddUnder}</p>
      ${valueCheck(100-matchOver25, oddUnder)}
    `;
  }

  let resultsCard = document.getElementById("results");
  resultsCard.innerHTML = `
    <h2>${homeTeam} (Home) vs ${awayTeam} (Away)</h2>
    ${table}
    ${valueOdds}
  `;

  // Contorno dinámico según probabilidad Over 2.5
  if (matchOver25 >= 70) resultsCard.style.borderColor = "var(--green)";
  else if (matchOver25 >= 50) resultsCard.style.borderColor = "var(--orange)";
  else resultsCard.style.borderColor = "var(--red)";
});
</script>
</body>
</html>