<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Station Master v11 - Surprise Level & Logic</title>
    <style>
        :root {
            --primary: #0f172a; --accent: #6366f1; --surprise: #8b5cf6;
            --live: #ef4444; --success: #22c55e; --bg: #f1f5f9;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 1450px; margin: auto; }
        
        .header { background: var(--primary); color: white; padding: 20px; border-radius: 15px; text-align: center; margin-bottom: 20px; border-bottom: 5px solid var(--surprise); }
        
        /* PANEL DE SORPRESA */
        .surprise-meter { background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; border: 2px solid var(--surprise); }
        .surprise-box { text-align: center; padding: 15px; border-radius: 10px; background: #f5f3ff; }
        .surprise-box h4 { margin: 0; font-size: 0.8rem; color: var(--surprise); text-transform: uppercase; }
        .surprise-val { font-size: 1.8rem; font-weight: 800; color: var(--primary); margin: 5px 0; }
        
        /* ESCENARIOS LIVE */
        .live-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .escenario { background: white; border-radius: 12px; padding: 20px; border-left: 6px solid var(--live); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .condicion { background: #fef2f2; padding: 8px; border-radius: 6px; font-weight: bold; margin: 10px 0; font-size: 0.85rem; }

        textarea { width: 100%; height: 100px; border-radius: 10px; padding: 10px; border: 2px solid #cbd5e1; font-family: monospace; font-size: 11px; }
        .btn-calc { width: 100%; padding: 20px; background: var(--accent); color: white; border: none; border-radius: 12px; font-size: 1.3rem; font-weight: 800; cursor: pointer; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>STATION MASTER v11.0: SURPRISE INDEX</h1>
        <p>C치lculo de "Nivel de Sorpresa" SoccerSTATS + Escenarios de Sentido Com칰n</p>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
        <textarea id="dL" placeholder="DATOS LOCAL (Newcastle)"></textarea>
        <textarea id="dV" placeholder="DATOS VISITANTE (Macarthur)"></textarea>
    </div>
    <button class="btn-calc" onclick="procesar()">CALCULAR NIVEL DE SORPRESA Y LIVE</button>

    <div id="dashboard" style="display:none;">
        
        <h3 style="color: var(--surprise);">游댌 칈NDICE DE SORPRESA (OSL)</h3>
        <div class="surprise-meter">
            <div class="surprise-box">
                <h4>Si Gana ${document.getElementById('dL').value.match(/flag\s*\n\s*(.*)/)?.[1] || 'Local'}</h4>
                <div id="osl-l" class="surprise-val">--</div>
                <small id="txt-l"></small>
            </div>
            <div class="surprise-box">
                <h4>Si hay EMPATE</h4>
                <div id="osl-x" class="surprise-val">--</div>
                <small id="txt-x"></small>
            </div>
            <div class="surprise-box">
                <h4>Si Gana ${document.getElementById('dV').value.match(/flag\s*\n\s*(.*)/)?.[1] || 'Visitante'}</h4>
                <div id="osl-v" class="surprise-val">--</div>
                <small id="txt-v"></small>
            </div>
        </div>

        <h3 style="color: var(--live);">游뛀 ESCENARIOS DE SENTIDO COM칔N (LIVE)</h3>
        <div class="live-grid" id="live-scenarios"></div>
    </div>
</div>

<script>
function get(t, r, p=false) { const m = t.match(r); return m ? (p ? parseFloat(m[1])/100 : parseFloat(m[1])) : 0; }

function calcOSL(ppgL, ppgV, resL, resV) {
    let diffL = Math.abs(ppgL - resL);
    let diffV = Math.abs(ppgV - resV);
    let avg = (diffL + diffV) / 2;
    return ((avg / 3) * 100).toFixed(1);
}

function procesar() {
    const l = document.getElementById('dL').value;
    const v = document.getElementById('dV').value;
    if(!l || !v) return;

    const D = {
        ln: l.match(/flag\s*\n\s*(.*)/)?.[1] || "Local",
        vn: v.match(/flag\s*\n\s*(.*)/)?.[1] || "Visitante",
        l_ppg: get(l, /PPG \(Home\):\s*([\d.]+)/),
        v_ppg: get(v, /PPG \(Away\):\s*([\d.]+)/),
        v_7590: get(v, /76-90\s*GF\s*\d+\s*GA\s*(\d+)/),
        v_eq: get(v, /Equalizing rate\s*(\d+)%/, true)
    };

    document.getElementById('dashboard').style.display = 'block';

    // C츼LCULO OSL (SoccerSTATS Formula)
    const oslL = calcOSL(D.l_ppg, D.v_ppg, 3, 0); // Gana local
    const oslX = calcOSL(D.l_ppg, D.v_ppg, 1, 1); // Empate
    const oslV = calcOSL(D.l_ppg, D.v_ppg, 0, 3); // Gana visita

    document.getElementById('osl-l').innerText = oslL;
    document.getElementById('osl-x').innerText = oslX;
    document.getElementById('osl-v').innerText = oslV;

    const interpretar = (val) => val < 15 ? "Esperado" : val < 30 ? "Normal" : "SORPRESA";
    document.getElementById('txt-l').innerText = interpretar(oslL);
    document.getElementById('txt-x').innerText = interpretar(oslX);
    document.getElementById('txt-v').innerText = interpretar(oslV);

    // ESCENARIOS LIVE CON OSL
    let htmlEsc = `
        <div class="escenario">
            <h4>EL "GOLPE" DEL VISITANTE</h4>
            <div class="condicion">Si ${D.vn} marca primero (0-1).</div>
            <p>OSL de Victoria Visitante: <b>${oslV}</b>. Si este n칰mero es >25, el sentido com칰n dice que ${D.ln} aumentar치 su presi칩n exponencialmente para evitar un resultado "Muy Sorprendente".</p>
            <p><b>Acci칩n:</b> Entrar a <b>H치ndicap Asi치tico +0.5 Local</b>.</p>
        </div>
        <div class="escenario">
            <h4>EL EMPATE RESISTENTE</h4>
            <div class="condicion">Si el partido va 0-0 min 70.</div>
            <p>OSL del Empate: <b>${oslX}</b>. Si el OSL es bajo, los equipos est치n c칩modos. Si es alto, uno de los dos va a arriesgar todo al final.</p>
            <p><b>Acci칩n:</b> Mirar si ${D.vn} se cansa (GA 75-90: ${D.v_7590}). Si s칤, apostar a <b>Gol Local Final</b>.</p>
        </div>
    `;
    document.getElementById('live-scenarios').innerHTML = htmlEsc;
}
</script>
</body>
</html>
