<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Analizador Pro - Sistema Integral</title>
    <style>
        :root { 
            --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #3b82f6; 
            --success: #10b981; --gold: #fbbf24; --danger: #ef4444; --border: #334155; 
            --input-bg: #0f172a;
        }
        
        * { box-sizing: border-box; font-family: -apple-system, system-ui, sans-serif; transition: all 0.2s ease; }
        
        body { 
            background: var(--bg); color: var(--text); margin: 0; padding: 15px; 
            line-height: 1.5; overflow-x: hidden;
        }

        .container { max-width: 500px; margin: auto; }
        
        /* CABECERA */
        .header { 
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 25px; padding-bottom: 10px; border-bottom: 1px solid var(--border);
        }
        .header h2 { margin: 0; font-size: 18px; letter-spacing: -0.5px; color: var(--accent); }
        .btn-nav { 
            background: var(--card); border: 1px solid var(--border); color: var(--text); 
            padding: 10px 18px; border-radius: 10px; text-decoration: none; 
            font-size: 11px; font-weight: 800; text-transform: uppercase;
        }

        /* FILTROS DE MANIPULACIÓN */
        .quality-filters { 
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); 
            border: 1px solid var(--accent); border-radius: 20px; 
            padding: 20px; margin-bottom: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }
        .filter-title { 
            font-size: 10px; font-weight: 900; color: var(--accent); 
            text-transform: uppercase; margin-bottom: 15px; display: block; 
            letter-spacing: 1px; text-align: center;
        }
        .filter-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .f-group { display: flex; flex-direction: column; gap: 8px; }
        .f-group label { font-size: 9px; font-weight: 800; color: #94a3b8; text-transform: uppercase; }
        .f-group input { 
            background: rgba(15, 23, 42, 0.7); border: 1px solid var(--border); 
            color: var(--gold); padding: 12px; border-radius: 12px; 
            font-weight: 800; text-align: center; font-size: 15px;
        }

        /* CAJA DE PEGADO DE INFORMACIÓN (RESTAURADA) */
        .import-section { margin-bottom: 25px; }
        textarea { 
            width: 100%; height: 100px; background: var(--card); 
            border: 2px dashed var(--border); border-radius: 15px; 
            color: #94a3b8; padding: 15px; font-size: 12px; resize: none; outline: none;
        }
        textarea:focus { border-color: var(--accent); color: white; }

        /* TARJETA PRINCIPAL */
        .card { 
            background: var(--card); border-radius: 20px; padding: 25px; 
            border: 1px solid var(--border); margin-bottom: 25px; 
        }
        .input-main-group { margin-bottom: 20px; }
        label { 
            display: block; font-size: 10px; font-weight: 800; 
            color: #64748b; margin-bottom: 8px; text-transform: uppercase; 
        }
        input { 
            width: 100%; background: var(--input-bg); border: 1px solid var(--border); 
            color: white; padding: 14px; border-radius: 12px; font-size: 15px; outline: none; 
        }

        .result-box { 
            background: #0f172a; border-radius: 15px; padding: 20px; 
            text-align: center; margin: 20px 0; border: 1px solid var(--border);
        }
        .res-val { font-size: 32px; font-weight: 900; color: var(--success); display: block; }
        .res-label { font-size: 9px; text-transform: uppercase; color: #475569; font-weight: 800; }

        /* BOTÓN Y MENSAJES */
        .btn-main { 
            width: 100%; background: var(--accent); color: white; border: none; 
            padding: 18px; border-radius: 15px; font-size: 14px; font-weight: 900; 
            cursor: pointer; text-transform: uppercase; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        .btn-main:disabled { background: #1e293b; color: #475569; cursor: not-allowed; box-shadow: none; }
        
        #msg-error { 
            color: var(--danger); font-size: 11px; text-align: center; 
            margin-top: 15px; font-weight: 700; padding: 10px;
            border-radius: 8px; background: rgba(239, 68, 68, 0.1); display: none; 
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>Analizador Estratégico</h2>
        <a href="estrategia.html" class="btn-nav">Portafolio</a>
    </div>

    <div class="import-section">
        <label>Pegar Datos de la Liga / Fuente</label>
        <textarea id="rawInput" placeholder="Pega aquí la información para auto-rellenar o analizar manualmente..." oninput="processRawData()"></textarea>
    </div>

    <div class="quality-filters">
        <span class="filter-title">⚙️ Parámetros de Calidad Mínima</span>
        <div class="filter-grid">
            <div class="f-group">
                <label>Muestra Mínima</label>
                <input type="number" id="minGames" value="10" oninput="calculate()">
            </div>
            <div class="f-group">
                <label>ROI Mínimo %</label>
                <input type="number" id="minRoi" value="5" oninput="calculate()">
            </div>
        </div>
    </div>

    <div class="card">
        <div class="input-main-group">
            <label>Nombre del Equipo / Mercado</label>
            <input type="text" id="equipo" placeholder="Ej: Man City - Gana">
        </div>

        <div class="filter-grid">
            <div class="f-group">
                <label>Partidos Analizados</label>
                <input type="number" id="partidos" value="10" oninput="calculate()">
            </div>
            <div class="f-group">
                <label>Aciertos (Wins)</label>
                <input type="number" id="wins" value="7" oninput="calculate()">
            </div>
        </div>
        <br>
        
        <div class="input-main-group">
            <label>Cuota Promedio Estimada</label>
            <input type="number" id="cuota" value="1.80" step="0.01" oninput="calculate()">
        </div>

        <div class="result-box">
            <span id="roiVal" class="res-val">0.0%</span>
            <span class="res-label">Expectativa de ROI</span>
        </div>

        <button id="saveBtn" class="btn-main" onclick="saveData()">Añadir al Portafolio</button>
        <div id="msg-error"></div>
    </div>
</div>

<script>
// RESTAURACIÓN: Función para procesar datos pegados
function processRawData() {
    const input = document.getElementById('rawInput').value;
    // Ejemplo de lógica simple: busca números en el texto pegado
    // Esto se puede personalizar según el formato que suelas pegar
    const numbers = input.match(/\d+(\.\d+)?/g);
    if (numbers && numbers.length >= 2) {
        // Asume que los primeros dos números podrían ser partidos y wins
        if (!document.getElementById('partidos').modified) {
            document.getElementById('partidos').value = numbers[0];
        }
        if (!document.getElementById('wins').modified) {
            document.getElementById('wins').value = numbers[1] || 0;
        }
        calculate();
    }
}

// Marcamos como modificado si el usuario escribe manualmente
document.getElementById('partidos').onkeydown = function() { this.modified = true; };
document.getElementById('wins').onkeydown = function() { this.modified = true; };

function calculate() {
    const p = parseFloat(document.getElementById('partidos').value) || 0;
    const w = parseFloat(document.getElementById('wins').value) || 0;
    const c = parseFloat(document.getElementById('cuota').value) || 0;
    const minP = parseFloat(document.getElementById('minGames').value) || 0;
    const minR = parseFloat(document.getElementById('minRoi').value) || 0;

    if (p > 0) {
        const prob = (w / p);
        const roi = ((prob * c) - 1) * 100;
        const roiEl = document.getElementById('roiVal');
        
        roiEl.innerText = (roi > 0 ? '+' : '') + roi.toFixed(1) + "%";
        roiEl.style.color = roi >= minR ? 'var(--success)' : (roi > 0 ? 'var(--gold)' : 'var(--danger)');

        const saveBtn = document.getElementById('saveBtn');
        const errorMsg = document.getElementById('msg-error');

        if (p >= minP && roi >= minR) {
            saveBtn.disabled = false;
            errorMsg.style.display = 'none';
        } else {
            saveBtn.disabled = true;
            errorMsg.style.display = 'block';
            let msg = [];
            if (p < minP) msg.push(`faltan ${minP - p} part.`);
            if (roi < minR) msg.push(`ROI < ${minR}%`);
            errorMsg.innerText = "Requisitos no alcanzados: " + msg.join(" y ");
        }
        return { roi: roi.toFixed(1), prob: (prob * 100).toFixed(1), valid: (p >= minP && roi >= minR) };
    }
}

function saveData() {
    const equipo = document.getElementById('equipo').value || "Estrategia Nueva";
    const p = document.getElementById('partidos').value;
    const w = document.getElementById('wins').value;
    const c = document.getElementById('cuota').value;
    const res = calculate();

    if (!res || !res.valid) return;

    const nuevaEstrategia = {
        equipo: equipo, partidos: p, wins: w, cuota: c,
        roi: res.roi, prob: res.prob,
        unidades: (res.roi / 10).toFixed(2),
        fecha: new Date().toLocaleDateString()
    };

    let store = JSON.parse(localStorage.getItem('bettingStrategy') || "[]");
    store.push(nuevaEstrategia);
    localStorage.setItem('bettingStrategy', JSON.stringify(store));

    const btn = document.getElementById('saveBtn');
    btn.innerText = "¡GUARDADO!";
    btn.style.background = "var(--success)";
    
    setTimeout(() => { window.location.href = "estrategia.html"; }, 700);
}

// Persistencia de filtros
window.onload = () => {
    const savedP = localStorage.getItem('cfg_minP');
    const savedR = localStorage.getItem('cfg_minR');
    if (savedP) document.getElementById('minGames').value = savedP;
    if (savedR) document.getElementById('minRoi').value = savedR;
    calculate();
};

document.getElementById('minGames').onchange = (e) => localStorage.setItem('cfg_minP', e.target.value);
document.getElementById('minRoi').onchange = (e) => localStorage.setItem('cfg_minR', e.target.value);
</script>
</body>
</html>
