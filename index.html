<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Analizador de Valor: DÃ­as y Equipos</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #3b82f6; --success: #10b981; --danger: #ef4444; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 1200px; margin: auto; }
        textarea { width: 100%; height: 100px; background: #334155; color: white; border: 1px solid #475569; border-radius: 8px; padding: 10px; font-size: 11px; }
        .btn { background: var(--accent); color: white; border: none; padding: 15px; cursor: pointer; border-radius: 6px; font-weight: bold; width: 100%; margin: 15px 0; font-size: 16px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; border-bottom: 4px solid #334155; }
        .day-row { display: flex; justify-content: space-between; padding: 10px; margin: 5px 0; border-radius: 6px; background: rgba(255,255,255,0.03); }
        .roi-pos { color: var(--success); font-weight: bold; }
        .roi-neg { color: var(--danger); font-weight: bold; }
        .highlight-box { background: #1e3a8a; padding: 20px; border-radius: 12px; margin-bottom: 20px; border-left: 6px solid var(--accent); }
        h3 { margin-top: 0; font-size: 14px; color: #94a3b8; text-transform: uppercase; }
    </style>
</head>
<body>

<div class="container">
    <h1>ðŸ“ˆ Analizador de Rentabilidad Temporal y EstratÃ©gica</h1>
    <textarea id="dataInput" placeholder="Pega tus datos aquÃ­..."></textarea>
    <button class="btn" onclick="analyzeProfit()">CALCULAR PATRONES DE RENTABILIDAD</button>

    <div id="results" style="display:none;">
        <div class="highlight-box">
            <h2 id="bestDayMsg" style="margin:0;"></h2>
            <p id="totalProfitMsg" style="margin:10px 0 0 0;"></p>
        </div>

        <div class="grid">
            <div class="card">
                <h3>ðŸ“… Rentabilidad por DÃ­a</h3>
                <div id="daysList"></div>
            </div>
            <div class="card">
                <h3>ðŸ’Ž Equipos con Mayor Valor (ROI)</h3>
                <div id="teamsList"></div>
            </div>
            <div class="card">
                <h3>ðŸ“Š Filtro PreMatch (ROI)</h3>
                <div id="filterList"></div>
            </div>
        </div>
    </div>
</div>

<script>
function analyzeProfit() {
    const input = document.getElementById('dataInput').value.trim();
    const lines = input.split('\n');
    const headers = lines[0].split('\t').map(h => h.trim().toLowerCase());

    const find = (keys) => headers.findIndex(h => keys.some(k => h.includes(k)));

    const idx = {
        date: find(['date', 'fecha']),
        match: find(['match']),
        result: headers.lastIndexOf('result'),
        odd: find(['odd']),
        o1: find(['odd 1 prematch']),
        o2: find(['odd 2 prematch'])
    };

    const dayNames = ["Domingo", "Lunes", "Martes", "MiÃ©rcoles", "Jueves", "Viernes", "SÃ¡bado"];
    let stats = { 
        days: {}, 
        teams: {}, 
        filters: { fav: {s:0, r:0}, under: {s:0, r:0} },
        globalS: 0, globalR: 0
    };

    lines.slice(1).forEach(line => {
        const col = line.split('\t').map(c => c.trim());
        if (col.length < 5) return;

        const isWin = col.some((c, i) => i >= idx.result && c.toLowerCase() === 'winning');
        const odd = parseFloat(col[idx.odd]?.replace(',','.')) || 1.0;
        const [hT, aT] = col[idx.match] ? col[idx.match].split(' - ') : ['?', '?'];
        const o1 = parseFloat(col[idx.o1]?.replace(',','.')) || 0;
        const o2 = parseFloat(col[idx.o2]?.replace(',','.')) || 0;

        // Procesar Fecha para obtener DÃ­a
        let dayName = "Desconocido";
        if(col[idx.date]) {
            const rawDate = col[idx.date].toLowerCase();
            if(rawDate.includes('lun')) dayName = "Lunes";
            else if(rawDate.includes('mar')) dayName = "Martes";
            else if(rawDate.includes('miÃ©')) dayName = "MiÃ©rcoles";
            else if(rawDate.includes('jue')) dayName = "Jueves";
            else if(rawDate.includes('vie')) dayName = "Viernes";
            else if(rawDate.includes('sÃ¡b')) dayName = "SÃ¡bado";
            else if(rawDate.includes('dom')) dayName = "Domingo";
        }

        const stake = 1;
        const ret = isWin ? odd : 0;

        stats.globalS += stake;
        stats.globalR += ret;

        // Stats DÃ­as
        if(!stats.days[dayName]) stats.days[dayName] = {s:0, r:0};
        stats.days[dayName].s += stake; stats.days[dayName].r += ret;

        // Stats Equipos
        [hT, aT].forEach(t => {
            if(!t) return;
            if(!stats.teams[t]) stats.teams[t] = {s:0, r:0, t:0, w:0};
            stats.teams[t].s += stake; stats.teams[t].r += ret;
            stats.teams[t].t++; if(isWin) stats.teams[t].w++;
        });

        // Stats Filtros
        if(o1 > 0 && o2 > 0) {
            const f = (o1 < o2) ? 'fav' : 'under';
            stats.filters[f].s += stake; stats.filters[f].r += ret;
        }
    });

    render(stats);
}

function render(s) {
    document.getElementById('results').style.display = 'block';
    
    // Render DÃ­as
    const daysHtml = Object.entries(s.days).map(([name, data]) => {
        const roi = ((data.r / data.s - 1) * 100).toFixed(1);
        return `<div class="day-row"><span>${name}</span><span class="${roi >= 0 ? 'roi-pos' : 'roi-neg'}">${roi}% ROI</span></div>`;
    }).join('');
    document.getElementById('daysList').innerHTML = daysHtml;

    // Render Equipos (Top 8 ROI)
    const topTeams = Object.entries(s.teams)
        .map(([n, d]) => ({n, roi: ((d.r/d.s-1)*100)}))
        .sort((a,b) => b.roi - a.roi)
        .slice(0, 8)
        .map(t => `<div class="day-row"><span>${t.n}</span><span class="roi-pos">${t.roi.toFixed(1)}%</span></div>`)
        .join('');
    document.getElementById('teamsList').innerHTML = topTeams;

    // Resumen Superior
    const bestDay = Object.entries(s.days).sort((a,b) => (b[1].r/b[1].s) - (a[1].r/a[1].s))[0];
    document.getElementById('bestDayMsg').innerText = `DÃ­a mÃ¡s rentable: ${bestDay[0]}`;
    document.getElementById('totalProfitMsg').innerText = `Tu ROI global es de ${((s.globalR/s.globalS - 1)*100).toFixed(2)}% tras ${s.globalS} apuestas analizadas.`;
}
</script>
</body>
</html>
