<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BetAGS - Pro Control & Analytics</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --fondo: #050d0a;
            --card-bg: #101d18;
            --texto-blanco: #e0e7e4;
            --texto-amarillo: #ffdf1b;
            --accent-green: #00ff88;
            --input-bg: #000000;
            --border: #243a33;
            --delete: #ff4d4d;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--fondo);
            color: var(--texto-blanco);
            margin: 0;
            padding: 0;
        }

        /* --- NAVEGACIÓN --- */
        .nav-tabs {
            display: flex;
            background: var(--card-bg);
            border-bottom: 2px solid var(--texto-amarillo);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .tab-link {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            color: var(--text-dim);
            transition: 0.3s;
            text-transform: uppercase;
            font-size: 0.8rem;
        }

        .tab-link.active {
            color: var(--texto-amarillo);
            background: rgba(255, 223, 27, 0.1);
        }

        .container {
            padding: 20px;
            max-width: 1000px;
            margin: auto;
        }

        .screen { display: none; }
        .active-screen { display: block; }

        /* --- CALCULADORAS --- */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
        }

        .card h2 {
            margin-top: 0;
            color: var(--texto-amarillo);
            font-size: 1rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        label { display: block; font-size: 0.7rem; color: #888; margin-bottom: 4px; }
        input {
            width: 100%; padding: 10px; background: var(--input-bg);
            border: 1px solid var(--border); color: white; border-radius: 6px;
            box-sizing: border-box; font-weight: bold;
        }

        .results-box {
            background: rgba(0,0,0,0.3);
            padding: 15px; border-radius: 8px; text-align: center; margin-top: 10px;
        }

        .recommendation {
            font-weight: 900; padding: 10px; border-radius: 4px;
            font-size: 0.8rem; display: block; margin-bottom: 10px;
        }

        .status-bet { background: #1b5e20; color: var(--accent-green); border: 1px solid var(--accent-green); }
        .status-no { background: #222; color: #777; border: 1px solid #444; }
        .status-danger { background: #4a0000; color: #ff8a80; border: 1px solid #ff4d4d; }

        .btn-register {
            width: 100%; padding: 12px; background: var(--accent-green);
            color: #000; border: none; border-radius: 6px; font-weight: bold;
            cursor: pointer; margin-top: 10px; display: none;
        }

        .btn-clear {
            background: none; border: none; color: var(--delete);
            font-size: 0.7rem; cursor: pointer; text-decoration: underline; margin-top: 10px;
        }

        /* --- CONTROL / HISTORIAL --- */
        .stats-grid {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px;
        }
        .stat-box {
            background: var(--card-bg); padding: 15px; border-radius: 10px;
            text-align: center; border: 1px solid var(--border);
        }
        .stat-val { font-size: 1.2rem; font-weight: 900; display: block; }

        .history-item {
            background: var(--card-bg); padding: 15px; border-radius: 10px;
            margin-bottom: 10px; border-left: 5px solid #444; position: relative;
        }
        .history-item.win { border-left-color: var(--accent-green); }
        .history-item.loss { border-left-color: var(--delete); }

        .actions { display: flex; gap: 10px; margin-top: 10px; }
        .btn-win { background: var(--accent-green); border: none; padding: 5px 15px; border-radius: 4px; font-weight: bold; cursor: pointer; }
        .btn-loss { background: var(--delete); border: none; padding: 5px 15px; border-radius: 4px; color: white; font-weight: bold; cursor: pointer; }
        .btn-del { background: #222; border: 1px solid var(--border); color: var(--delete); padding: 5px 10px; border-radius: 4px; cursor: pointer; }

    </style>
</head>
<body>

    <div class="nav-tabs">
        <div class="tab-link active" onclick="nav('calc-screen', this)"><i class="fa-solid fa-calculator"></i> Calculadoras</div>
        <div class="tab-link" onclick="nav('control-screen', this)"><i class="fa-solid fa-book"></i> Control de Apuestas</div>
    </div>

    <div class="container">
        
        <div id="calc-screen" class="screen active-screen">
            <div class="grid" id="calculadoras-container">
                </div>
        </div>

        <div id="control-screen" class="screen">
            <div class="stats-grid">
                <div class="stat-box">
                    <span style="font-size:0.6rem; color:#888;">PROFIT TOTAL</span>
                    <span id="stat-profit" class="stat-val">0.00 $</span>
                </div>
                <div class="stat-box">
                    <span style="font-size:0.6rem; color:#888;">WIN RATE</span>
                    <span id="stat-wr" class="stat-val">0%</span>
                </div>
                <div class="stat-box">
                    <span style="font-size:0.6rem; color:#888;">YIELD</span>
                    <span id="stat-yield" class="stat-val">0%</span>
                </div>
            </div>

            <div id="history-list">
                </div>
            
            <button onclick="clearAllHistory()" style="width:100%; background:none; color:var(--delete); border:1px solid var(--delete); padding:10px; border-radius:6px; margin-top:20px; cursor:pointer;">BORRAR TODO EL HISTORIAL</button>
        </div>

    </div>

    <script>
        const mercados = [
            { id: 'Over', title: 'OVER (Más Goles)' },
            { id: 'Under', title: 'UNDER (Menos Goles)' },
            { id: 'Yes', title: 'BTTS: SÍ (Ambos Anotan)' },
            { id: 'No', title: 'BTTS: NO (No Anotan Ambos)' }
        ];

        let apuestas = JSON.parse(localStorage.getItem('betags_history')) || [];

        // Generar UI de calculadoras
        function renderCalculators() {
            const container = document.getElementById('calculadoras-container');
            container.innerHTML = mercados.map(m => `
                <div class="card">
                    <h2>${m.title}</h2>
                    <div class="input-group">
                        <div>
                            <label>Cuota Mercado</label>
                            <input type="number" id="odds_${m.id}" step="0.01" oninput="runCalc('${m.id}')">
                        </div>
                        <div>
                            <label>Cuota Contraria</label>
                            <input type="number" id="contra_${m.id}" step="0.01" oninput="runCalc('${m.id}')">
                        </div>
                    </div>
                    <div>
                        <label>Tu Probabilidad Real %</label>
                        <input type="number" id="prob_${m.id}" step="0.1" oninput="runCalc('${m.id}')">
                    </div>
                    <div class="results-box">
                        <span id="rec_${m.id}" class="recommendation status-no">ESPERANDO DATOS</span>
                        <div style="display:flex; justify-content:space-between; font-size:0.8rem;">
                            <span>Edge: <b id="edge_${m.id}">0.00%</b></span>
                            <span>Overround: <b id="ovr_${m.id}">0.00%</b></span>
                        </div>
                        <div style="margin-top:10px;">
                            <label>Stake para registro ($)</label>
                            <input type="number" id="stake_${m.id}" value="100">
                        </div>
                        <button id="btn_${m.id}" class="btn-register" onclick="registerBet('${m.id}')">REGISTRAR EN CONTROL</button>
                    </div>
                    <button class="btn-clear" onclick="clearCalc('${m.id}')">Limpiar</button>
                </div>
            `).join('');
        }

        function runCalc(id) {
            const odds = parseFloat(document.getElementById(`odds_${id}`).value);
            const contra = parseFloat(document.getElementById(`contra_${id}`).value);
            const prob = parseFloat(document.getElementById(`prob_${id}`).value);
            
            const recEl = document.getElementById(`rec_${id}`);
            const edgeEl = document.getElementById(`edge_${id}`);
            const ovrEl = document.getElementById(`ovr_${id}`);
            const btnReg = document.getElementById(`btn_${id}`);

            if (odds > 1 && contra > 1 && prob > 0) {
                const overround = ((1/odds) + (1/contra) - 1) * 100;
                const edge = ((odds * (prob / 100)) - 1) * 100;

                ovrEl.innerText = overround.toFixed(2) + "%";
                edgeEl.innerText = edge.toFixed(2) + "%";

                // REGLAS
                const ruleEdge = (edge >= 3 && edge <= 15);
                const ruleOvr = (overround <= 8);
                const ruleVs = (edge > overround);

                if (ruleEdge && ruleOvr && ruleVs) {
                    recEl.innerText = "✓ APUESTA RENTABLE";
                    recEl.className = "recommendation status-bet";
                    btnReg.style.display = "block";
                    edgeEl.style.color = "var(--accent-green)";
                } else if (edge > 0) {
                    recEl.innerText = "⚠ FUERA DE RANGO SEGURO";
                    recEl.className = "recommendation status-danger";
                    btnReg.style.display = "block";
                    edgeEl.style.color = "var(--texto-amarillo)";
                } else {
                    recEl.innerText = "✗ SIN VALOR";
                    recEl.className = "recommendation status-no";
                    btnReg.style.display = "none";
                    edgeEl.style.color = "var(--delete)";
                }
            }
        }

        function registerBet(id) {
            const odds = parseFloat(document.getElementById(`odds_${id}`).value);
            const edge = document.getElementById(`edge_${id}`).innerText;
            const prob = document.getElementById(`prob_${id}`).value;
            const stake = parseFloat(document.getElementById(`stake_${id}`).value) || 0;
            const mercadoName = mercados.find(m => m.id === id).title;

            const nuevaApuesta = {
                id: Date.now(),
                mercado: mercadoName,
                cuota: odds,
                edge: edge,
                prob: prob,
                stake: stake,
                status: 'pending',
                fecha: new Date().toLocaleDateString()
            };

            apuestas.unshift(nuevaApuesta);
            localStorage.setItem('betags_history', JSON.stringify(apuestas));
            alert("¡Apuesta registrada en el Control!");
            loadHistory();
        }

        function loadHistory() {
            const list = document.getElementById('history-list');
            let profit = 0, inversion = 0, ganadas = 0, terminadas = 0;

            list.innerHTML = apuestas.map(a => {
                let statusClass = a.status;
                if (a.status === 'win') {
                    profit += (a.cuota - 1) * a.stake;
                    inversion += a.stake;
                    ganadas++;
                    terminadas++;
                } else if (a.status === 'loss') {
                    profit -= a.stake;
                    inversion += a.stake;
                    terminadas++;
                }

                return `
                    <div class="history-item ${a.status}">
                        <div style="display:flex; justify-content:space-between;">
                            <b>${a.mercado}</b>
                            <small>${a.fecha}</small>
                        </div>
                        <div style="font-size:0.75rem; color:#aaa; margin:5px 0;">
                            Cuota: ${a.cuota} | Stake: ${a.stake}$ | Edge: ${a.edge}
                        </div>
                        <div class="actions">
                            ${a.status === 'pending' ? `
                                <button class="btn-win" onclick="updateStatus(${a.id}, 'win')">GANADA</button>
                                <button class="btn-loss" onclick="updateStatus(${a.id}, 'loss')">PERDIDA</button>
                            ` : `<b style="text-transform:uppercase; color:${a.status==='win'?'var(--accent-green)':'var(--delete)'}">${a.status}</b>`}
                            <button class="btn-del" onclick="deleteBet(${a.id})"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>
                `;
            }).join('');

            // Actualizar Stats
            document.getElementById('stat-profit').innerText = profit.toFixed(2) + " $";
            document.getElementById('stat-profit').style.color = profit >= 0 ? "var(--accent-green)" : "var(--delete)";
            document.getElementById('stat-wr').innerText = terminadas > 0 ? ((ganadas/terminadas)*100).toFixed(1) + "%" : "0%";
            document.getElementById('stat-yield').innerText = inversion > 0 ? ((profit/inversion)*100).toFixed(1) + "%" : "0%";
        }

        function updateStatus(id, status) {
            const index = apuestas.findIndex(a => a.id === id);
            apuestas[index].status = status;
            localStorage.setItem('betags_history', JSON.stringify(apuestas));
            loadHistory();
        }

        function deleteBet(id) {
            if(confirm("¿Eliminar registro?")) {
                apuestas = apuestas.filter(a => a.id !== id);
                localStorage.setItem('betags_history', JSON.stringify(apuestas));
                loadHistory();
            }
        }

        function clearAllHistory() {
            if(confirm("¿ESTÁS SEGURO? Se borrarán todas las estadísticas.")) {
                apuestas = [];
                localStorage.removeItem('betags_history');
                loadHistory();
            }
        }

        function clearCalc(id) {
            document.getElementById(`odds_${id}`).value = "";
            document.getElementById(`contra_${id}`).value = "";
            document.getElementById(`prob_${id}`).value = "";
            document.getElementById(`rec_${id}`).innerText = "ESPERANDO DATOS";
            document.getElementById(`rec_${id}`).className = "recommendation status-no";
            document.getElementById(`edge_${id}`).innerText = "0.00%";
            document.getElementById(`ovr_${id}`).innerText = "0.00%";
            document.getElementById(`btn_${id}`).style.display = "none";
        }

        function nav(screenId, el) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
            document.querySelectorAll('.tab-link').forEach(t => t.classList.remove('active'));
            document.getElementById(screenId).classList.add('active-screen');
            el.classList.add('active');
        }

        // Inicializar
        renderCalculators();
        loadHistory();
    </script>
</body>
</html>
