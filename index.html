<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calculadora Kelly Fraccional</title>
<style>
  :root{
    --bg:#0f1115; --card:#171923; --muted:#9aa4b2; --text:#e6e8ee; --accent:#5b9cff; --good:#2ecc71; --bad:#ff5b6e;
    --ring:rgba(91,156,255,.35);
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:linear-gradient(180deg,#0e1014, #0b0d12 60%);
    color:var(--text); font: 16px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
    display:grid; place-items:start center; min-height:100vh; padding:24px;
  }
  .wrap{width:100%; max-width:920px}
  h1{font-size:clamp(22px,3vw,28px); margin:0 0 12px}
  p.lead{color:var(--muted); margin:0 0 20px}
  .grid{display:grid; grid-template-columns:repeat(12,1fr); gap:16px}
  .card{background:var(--card); border:1px solid #222638; border-radius:14px; padding:18px}
  .span-6{grid-column:span 6}
  .span-12{grid-column:span 12}
  @media (max-width:820px){ .span-6{grid-column:span 12} }
  label{display:block; font-weight:600; margin-bottom:8px}
  .row{display:flex; gap:10px; align-items:center}
  input[type="number"], input[type="text"], input[type="range"]{
    width:100%; background:#0f1320; color:var(--text); border:1px solid #283047; border-radius:10px;
    padding:12px 12px; outline:none; transition:.2s border,.2s box-shadow;
  }
  input[type="number"]:focus, input[type="text"]:focus{
    border-color:var(--accent); box-shadow:0 0 0 6px var(--ring);
  }
  .hint{color:var(--muted); font-size:12px; margin-top:6px}
  .kpi{
    display:grid; grid-template-columns:repeat(4,1fr); gap:12px; margin-top:8px
  }
  .kpi .item{
    background:#101423; border:1px solid #222638; border-radius:12px; padding:12px
  }
  .kpi .label{color:var(--muted); font-size:12px}
  .kpi .value{font-size:20px; font-weight:700; margin-top:4px}
  .value.good{color:var(--good)} .value.bad{color:var(--bad)}
  .foot{color:#7e8796; font-size:12px; margin-top:10px}
  .pill{
    display:inline-block; border:1px dashed #2a3350; color:#c7d0e0; padding:6px 10px; border-radius:999px; font-size:12px
  }
  .inline{display:flex; gap:10px; align-items:center}
  .unit{opacity:.7}
  .btn{
    display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:10px; border:1px solid #283047;
    background:#0f1320; color:var(--text); cursor:pointer; user-select:none
  }
  .btn:hover{border-color:#3a4566}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Calculadora de Kelly Fraccional</h1>
    <p class="lead">Ingresa tu probabilidad estimada y la cuota decimal. El cálculo usa <span class="pill">25% de Kelly</span> y <span class="pill">bankroll = 100</span> por defecto.</p>

    <div class="grid">
      <!-- Entradas -->
      <div class="card span-6">
        <label for="bankroll">Bankroll</label>
        <input id="bankroll" type="number" step="0.01" min="0" value="100" />
        <div class="hint">Total disponible para apostar.</div>

        <div style="height:12px"></div>

        <label for="prob">Probabilidad estimada de acierto (en %)</label>
        <input id="prob" type="number" step="0.01" min="0" max="100" placeholder="Ej. 55" />
        <div class="hint">Tu estimación subjetiva. Ej.: 55 significa 0.55.</div>

        <div style="height:12px"></div>

        <label for="odds">Cuota decimal (Europa)</label>
        <input id="odds" type="number" step="0.001" min="1.01" placeholder="Ej. 1.91" />
        <div class="hint">Formato decimal: 1.50, 1.91, 2.20, etc.</div>

        <div style="height:12px"></div>

        <label for="fraction">Fracción de Kelly</label>
        <div class="inline">
          <input id="fraction" type="range" min="5" max="100" value="25" />
          <input id="fractionText" type="number" min="5" max="100" value="25" style="width:110px" />
          <span class="unit">%</span>
          <button id="set25" class="btn" title="Usar 25% de Kelly por defecto">25%</button>
          <button id="set50" class="btn" title="Usar 50% de Kelly">50%</button>
        </div>
        <div class="hint">Controla la agresividad. 25% reduce varianza.</div>
      </div>

      <!-- Resultados -->
      <div class="card span-6">
        <div class="kpi">
          <div class="item">
            <div class="label">Kelly completo (f*)</div>
            <div id="k_full" class="value">—</div>
            <div class="foot">Porcentaje del bankroll</div>
          </div>
          <div class="item">
            <div class="label">Apuesta (fracc.)</div>
            <div id="stake" class="value">—</div>
            <div class="foot">Unidades monetarias</div>
          </div>
          <div class="item">
            <div class="label">EV por 1 unidad</div>
            <div id="ev" class="value">—</div>
            <div class="foot">Esperanza de valor</div>
          </div>
          <div class="item">
            <div class="label">Edge vs cuota</div>
            <div id="edge" class="value">—</div>
            <div class="foot">p − 1/odds</div>
          </div>
        </div>

        <div style="height:10px"></div>
        <div class="hint">Fórmula: para cuotas decimales, <strong>b = odds − 1</strong>, <strong>f* = (b·p − (1−p)) / b</strong>. Si f* ≤ 0 ⇒ no apostar.</div>
      </div>

      <!-- Resumen -->
      <div class="card span-12">
        <div class="row">
          <div class="span-12">
            <div class="inline" style="flex-wrap:wrap; gap:14px">
              <div><strong>Resumen:</strong> <span id="summary">Introduce datos para ver el resultado.</span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <p class="foot">Consejo: si el edge es pequeño o incierto, usa una fracción menor (ej. 10–25%) para reducir el riesgo de ruina.</p>
  </div>

<script>
(function(){
  const $ = (id) => document.getElementById(id);

  const bankroll = $("bankroll");
  const prob = $("prob");
  const odds = $("odds");
  const fraction = $("fraction");
  const fractionText = $("fractionText");
  const kFull = $("k_full");
  const stake = $("stake");
  const ev = $("ev");
  const edge = $("edge");
  const summary = $("summary");
  $("set25").addEventListener("click", ()=>{ fraction.value=25; fractionText.value=25; compute(); });
  $("set50").addEventListener("click", ()=>{ fraction.value=50; fractionText.value=50; compute(); });

  // Mantener sincronizados slider y número
  fraction.addEventListener("input", ()=>{ fractionText.value = fraction.value; compute(); });
  fractionText.addEventListener("input", ()=>{
    let v = Number(fractionText.value || 0);
    if (v < 5) v = 5; if (v > 100) v = 100;
    fractionText.value = v; fraction.value = v; compute();
  });

  [bankroll, prob, odds].forEach(el => el.addEventListener("input", compute));

  // Valores por defecto solicitados
  bankroll.value = 100;        // bankroll 100
  fraction.value = 25;         // 25% Kelly
  fractionText.value = 25;

  function fmtPct(x){
    if (!isFinite(x)) return "—";
    return (x*100).toFixed(2) + "%";
  }
  function fmtNum(x){
    if (!isFinite(x)) return "—";
    return Number(x).toFixed(2);
  }

  function compute(){
    const BR = parseFloat(bankroll.value);
    const p = clamp(parseFloat(prob.value)/100, 0, 1);
    const o = parseFloat(odds.value);
    const frac = parseFloat(fraction.value)/100;

    if (!isFinite(BR) || BR < 0 || !isFinite(p) || !isFinite(o) || o<=1){
      kFull.textContent = "—";
      stake.textContent = "—";
      ev.textContent = "—";
      edge.textContent = "—";
      summary.textContent = "Completa probabilidad y cuota para calcular.";
      return;
    }

    // Variables Kelly
    const b = o - 1;
    const q = 1 - p;

    // Kelly completo (f*) = (b*p - q) / b
    let fStar = (b*p - q) / b;

    // Edge contra la cuota (p - 1/o)
    const edgeVal = p - (1/o);

    // Esperanza de valor por 1 unidad apostada: EV = p*(o-1) - (1-p)
    const evPer1 = p*b - q;

    // Si f* <= 0 (o negativo), stake = 0
    if (!isFinite(fStar) || fStar <= 0) fStar = 0;

    const stakeKelly = fStar * BR;             // Kelly completo en dinero
    const stakeFrac  = frac * stakeKelly;      // Fracción de Kelly solicitada

    // Pintar
    kFull.textContent = fmtPct(fStar);
    stake.textContent = fmtNum(stakeFrac);

    ev.textContent = (evPer1 >= 0 ? "+" : "") + fmtNum(evPer1);
    ev.className = "value " + (evPer1 >= 0 ? "good" : "bad");

    edge.textContent = (edgeVal >= 0 ? "+" : "") + fmtPct(edgeVal);
    edge.className = "value " + (edgeVal >= 0 ? "good" : "bad");

    const implied = 1/o;
    const lines = [];
    lines.push(`Con p = ${(p*100).toFixed(2)}% y cuota ${o.toFixed(3)} (prob. implícita ${(implied*100).toFixed(2)}%),`);
    if (fStar === 0){
      lines.push(`Kelly sugiere no apostar (f* ≤ 0).`);
    } else {
      lines.push(`Kelly completo sugiere apostar ${fmtPct(fStar)} del bankroll (${fmtNum(stakeKelly)}).`);
      lines.push(`Con ${Math.round(frac*100)}% de Kelly, apuesta recomendada: ${fmtNum(stakeFrac)}.`);
    }
    summary.textContent = lines.join(" ");
  }

  function clamp(x, a, b){ return Math.min(Math.max(x, a), b); }

  // Inicializa mensaje
  compute();
})();
</script>
</body>
</html>