<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sistema de Predicción Avanzado - Football Stats</title>
    <style>
        :root { --primary: #2c3e50; --accent: #e74c3c; --success: #27ae60; --bg: #f8f9fa; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 1100px; margin: auto; }
        .header { text-align: center; padding: 20px; background: var(--primary); color: white; border-radius: 8px 8px 0 0; }
        .grid-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; background: white; padding: 20px; border-bottom: 5px solid var(--accent); }
        textarea { width: 100%; height: 250px; border: 1px solid #ddd; border-radius: 4px; padding: 10px; font-family: monospace; font-size: 11px; box-sizing: border-box; }
        .btn-calc { width: 100%; padding: 20px; background: var(--success); color: white; border: none; font-size: 1.2rem; font-weight: bold; cursor: pointer; border-radius: 0 0 8px 8px; transition: 0.3s; }
        .btn-calc:hover { background: #219150; }
        
        .results { display: none; margin-top: 30px; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .card h3 { margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px; color: var(--primary); }
        
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 8px; border-bottom: 1px solid #f9f9f9; }
        .val { font-weight: bold; color: var(--accent); }
        .highlight { background: #fff3cd; padding: 15px; border-radius: 5px; border-left: 5px solid #ffc107; font-weight: bold; text-align: center; font-size: 1.1em; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Predictor Estadístico Profesional</h1>
        <p>Copia y pega los datos completos de cada equipo abajo</p>
    </div>

    <div class="grid-inputs">
        <div>
            <h3>Datos Equipo LOCAL (Newcastle Jets)</h3>
            <textarea id="localTxt" placeholder="Pega aquí el bloque de texto completo..."></textarea>
        </div>
        <div>
            <h3>Datos Equipo VISITANTE (Macarthur FC)</h3>
            <textarea id="visitTxt" placeholder="Pega aquí el bloque de texto completo..."></textarea>
        </div>
    </div>
    <button class="btn-calc" onclick="analizarTodo()">GENERAR ANÁLISIS 360°</button>

    <div id="resultsArea" class="results">
        <div class="card">
            <h3>Probabilidades 1X2</h3>
            <div id="prob1x2"></div>
        </div>

        <div class="card">
            <h3>Mercado de Goles (Over/Under)</h3>
            <div id="probGoles"></div>
        </div>

        <div class="card">
            <h3>Corners y Dinámica</h3>
            <div id="probExtra"></div>
        </div>

        <div class="card" style="grid-column: 1 / -1;">
            <h3>Sugerencia de Apuesta</h3>
            <div id="sugerenciaFinal" class="highlight"></div>
        </div>
    </div>
</div>

<script>
function extract(text, regex, isPercent = false) {
    const match = text.match(regex);
    if (!match) return 0;
    let val = parseFloat(match[1]);
    return isPercent ? val / 100 : val;
}

function analizarTodo() {
    const l = document.getElementById('localTxt').value;
    const v = document.getElementById('visitTxt').value;

    if(!l || !v) return alert("Pega los datos de ambos equipos");

    // --- EXTRACCIÓN DE DATOS AVANZADA ---
    const statsL = {
        ppg: extract(l, /PPG \(Home\):\s*([\d.]+)/),
        gf: extract(l, /Goals scored per game\s*([\d.]+)/),
        ga: extract(l, /Goals conceded per game\s*([\d.]+)/),
        over25: extract(l, /% over 2.5 goals\s*(\d+)%/, true),
        btts: extract(l, /% both teams scored\s*(\d+)%/, true),
        corners: extract(l, /Corners For[\s\S]*?Home\s*([\d.]+)/),
        cornersCon: extract(l, /Corners Against[\s\S]*?Home\s*([\d.]+)/),
        scoredFirst: extract(l, /% Team scored first\s*(\d+)%/, true),
        leadDefending: extract(l, /Lead-defending rate\s*(\d+)%/, true),
        avgMinScored: extract(l, /Average minute scored first\s*(\d+)/)
    };

    const statsV = {
        ppg: extract(v, /PPG \(Away\):\s*([\d.]+)/),
        gf: extract(v, /Goals scored per game\s*([\d.]+)/),
        ga: extract(v, /Goals conceded per game\s*([\d.]+)/),
        over25: extract(v, /% over 2.5 goals\s*(\d+)%/, true),
        btts: extract(v, /% both teams scored\s*(\d+)%/, true),
        corners: extract(v, /Corners For[\s\S]*?Away\s*([\d.]+)/),
        cornersCon: extract(v, /Corners Against[\s\S]*?Away\s*([\d.]+)/),
        scoredFirst: extract(v, /% Team scored first\s*(\d+)%/, true),
        equalizing: extract(v, /Equalizing rate\s*(\d+)%/, true),
        avgMinConceded: extract(v, /Average minute conceded first\s*(\d+)/)
    };

    // --- CÁLCULOS LÓGICOS ---
    // 1. Probabilidades 1X2 (Ajustado por PPG y defensa de liderato)
    const factorL = (statsL.ppg * 0.6) + (statsL.scoredFirst * 0.4);
    const factorV = (statsV.ppg * 0.6) + (statsV.equalizing * 0.4);
    const totalFactor = factorL + factorV + 0.4;
    
    const pL = (factorL / totalFactor) * 100;
    const pV = (factorV / totalFactor) * 100;
    const pE = 100 - pL - pV;

    // 2. Proyección de Goles (Promedio cruzado)
    const expL = (statsL.gf + statsV.ga) / 2;
    const expV = (statsV.gf + statsL.ga) / 2;
    const totalXG = expL + expV;
    const probOver25 = ((statsL.over25 + statsV.over25) / 2) * 100;

    // 3. Corners
    const totalCorners = statsL.corners + statsV.corners;

    // --- RENDERIZADO ---
    document.getElementById('resultsArea').style.display = 'grid';

    document.getElementById('prob1x2').innerHTML = `
        <div class="stat-row"><span>Victoria Local:</span> <span class="val">${pL.toFixed(1)}%</span></div>
        <div class="stat-row"><span>Empate:</span> <span class="val">${pE.toFixed(1)}%</span></div>
        <div class="stat-row"><span>Victoria Visitante:</span> <span class="val">${pV.toFixed(1)}%</span></div>
    `;

    document.getElementById('probGoles').innerHTML = `
        <div class="stat-row"><span>Goles Esperados (xG):</span> <span class="val">${totalXG.toFixed(2)}</span></div>
        <div class="stat-row"><span>Probabilidad Over 2.5:</span> <span class="val">${probOver25.toFixed(1)}%</span></div>
        <div class="stat-row"><span>Ambos Anotan:</span> <span class="val">${((statsL.btts + statsV.btts)/2*100).toFixed(1)}%</span></div>
    `;

    document.getElementById('probExtra').innerHTML = `
        <div class="stat-row"><span>Córners Totales Est.:</span> <span class="val">${totalCorners.toFixed(1)}</span></div>
        <div class="stat-row"><span>Min. Primero en Marcar:</span> <span class="val">${statsL.avgMinScored} (L) / ${statsV.avgMinConceded} (V)</span></div>
        <div class="stat-row"><span>Defensa de Liderato (L):</span> <span class="val">${(statsL.leadDefending*100).toFixed(0)}%</span></div>
    `;

    // --- LÓGICA DE SUGERENCIA ---
    let pick = "";
    if(pL > 45 && totalXG > 2.5) pick = "Gana Local y Más de 1.5 Goles";
    else if(probOver25 > 65) pick = "Más de 2.5 Goles (Partido Abierto)";
    else if(pL > 35 && pE > 30) pick = "Doble Oportunidad: Local o Empate";
    else pick = "Hándicap Asiático +1.0 Visitante";

    document.getElementById('sugerenciaFinal').innerHTML = `PROYECCIÓN: ${pick} <br> <small>Confianza basada en datos: ${(Math.max(pL, pV, probOver25)).toFixed(1)}%</small>`;
}
</script>

</body>
</html>
