<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Poisson de Fútbol (Dark Mode)</title>
    <style>
        /* Estilos para el Modo Oscuro */
        body { 
            font-family: 'Arial', sans-serif; 
            margin: 20px; 
            background-color: #1e1e1e; /* Fondo oscuro */
            color: #f0f0f0; /* Texto claro */
        }
        .container { 
            max-width: 800px; 
            margin: auto; 
            background: #252526; /* Contenedor más claro que el fondo */
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5); 
        }
        h1 { 
            color: #00bcd4; /* Azul cian brillante */
            text-align: center; 
        }
        .input-group, .results-table { 
            margin-bottom: 20px; 
            padding: 15px; 
            border: 1px solid #3c3c3c; 
            border-radius: 5px; 
            background-color: #2d2d30; /* Fondo de grupos */
        }
        .input-group h2 { 
            color: #ffffff; 
            border-bottom: 1px solid #4a4a4a; 
            padding-bottom: 5px; 
            margin-top: 0; 
        }
        label { 
            display: block; 
            margin-top: 10px; 
            font-weight: bold; 
            color: #ccc; 
        }
        input[type="number"] { 
            width: 100%; 
            padding: 10px; 
            margin-top: 5px; 
            border: 1px solid #555; 
            border-radius: 4px; 
            box-sizing: border-box; 
            background-color: #3e3e42; /* Fondo de inputs */
            color: #ffffff; 
        }
        button { 
            background-color: #4CAF50; /* Verde, resaltado */
            color: white; 
            padding: 12px 15px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 16px; 
            margin-top: 15px; 
            width: 100%; 
            transition: background-color 0.3s;
        }
        button:hover { 
            background-color: #45a049; 
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 15px; 
        }
        th, td { 
            border: 1px solid #3c3c3c; 
            padding: 12px; 
            text-align: left; 
        }
        th { 
            background-color: #383838; 
            color: #00bcd4;
        }
        td {
            background-color: #2d2d30;
        }
        .resultado { 
            font-weight: bold; 
            color: #ff9800; /* Naranja, para resaltar resultados */
            font-size: 1.1em;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>⚽ Calculadora Poisson de Fútbol</h1>

    <div class="input-group">
        <h2>Promedios de Goles de la Liga</h2>
        <label for="gl_l">Goles Promedio Local Liga ($\text{GL}_{\text{L}}$):</label>
        <input type="number" id="gl_l" value="1.5" step="0.01">
        <label for="gl_v">Goles Promedio Visitante Liga ($\text{GL}_{\text{V}}$):</label>
        <input type="number" id="gl_v" value="1.2" step="0.01">
    </div>

    <div class="input-group">
        <h2>Estadísticas del Equipo Local (Home)</h2>
        <label for="gf_l">Goles a Favor Local (en casa):</label>
        <input type="number" id="gf_l" value="1.8" step="0.01">
        <label for="gc_l">Goles Recibidos Local (en casa):</label>
        <input type="number" id="gc_l" value="0.9" step="0.01">
    </div>

    <div class="input-group">
        <h2>Estadísticas del Equipo Visitante (Away)</h2>
        <label for="gf_v">Goles a Favor Visitante (fuera):</label>
        <input type="number" id="gf_v" value="1.4" step="0.01">
        <label for="gc_v">Goles Recibidos Visitante (fuera):</label>
        <input type="number" id="gc_v" value="1.3" step="0.01">
    </div>

    <button onclick="calcularPoisson()">Calcular Probabilidades</button>

    <div id="resultados" class="results-table" style="display:none;">
        <h2>Resultados de Probabilidad</h2>

        <h3>Goles Esperados ($\lambda$)</h3>
        <p>Local ($\lambda_{\text{L}}$): <span id="lambda_l" class="resultado"></span></p>
        <p>Visitante ($\lambda_{\text{V}}$): <span id="lambda_v" class="resultado"></span></p>

        <h3>Mercados Principales</h3>
        <table>
            <thead>
                <tr><th>Mercado</th><th>Probabilidad</th></tr>
            </thead>
            <tbody>
                <tr><td>**1X2** - Local (1)</td><td id="p_1" class="resultado"></td></tr>
                <tr><td>**1X2** - Empate (X)</td><td id="p_x" class="resultado"></td></tr>
                <tr><td>**1X2** - Visitante (2)</td><td id="p_2" class="resultado"></td></tr>
            </tbody>
        </table>

        <h3>Otros Mercados</h3>
        <table>
            <thead>
                <tr><th>Mercado</th><th>Probabilidad</th></tr>
            </thead>
            <tbody>
                <tr><td>Draw No Bet (DNB 1)</td><td id="p_dnb1" class="resultado"></td></tr>
                <tr><td>Draw No Bet (DNB 2)</td><td id="p_dnb2" class="resultado"></td></tr>
                <tr><td>Ambos Anotan (Sí)</td><td id="p_btts_yes" class="resultado"></td></tr>
                <tr><td>Over 0.5 Goles</td><td id="p_over05" class="resultado"></td></tr>
                <tr><td>Over 1.5 Goles</td><td id="p_over15" class="resultado"></td></tr>
                <tr><td>Over 2.5 Goles</td><td id="p_over25" class="resultado"></td></tr>
                <tr><td>Over 3.5 Goles</td><td id="p_over35" class="resultado"></td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    // Función Factorial
    function factorial(n) {
        if (n === 0 || n === 1) return 1;
        let result = 1;
        for (let i = 2; i <= n; i++) {
            result *= i;
        }
        return result;
    }

    // Distribución de Poisson
    function poisson(k, lambda) {
        if (lambda <= 0) return 0;
        return (Math.pow(lambda, k) * Math.exp(-lambda)) / factorial(k);
    }

    // Función principal de cálculo
    function calcularPoisson() {
        // 1. Obtener datos de entrada
        const GL_L = parseFloat(document.getElementById('gl_l').value); 
        const GL_V = parseFloat(document.getElementById('gl_v').value); 
        const GF_L = parseFloat(document.getElementById('gf_l').value); 
        const GC_L = parseFloat(document.getElementById('gc_l').value); 
        const GF_V = parseFloat(document.getElementById('gf_v').value); 
        const GC_V = parseFloat(document.getElementById('gc_v').value); 

        // Validar entradas
        if (GL_L <= 0 || GL_V <= 0) {
            alert("Los promedios de goles de la liga deben ser mayores a 0.");
            return;
        }

        // 2. Calcular Fuerzas y Potenciales
        const FA_L = GF_L / GL_L; // Fuerza Ataque Local
        const PD_V = GC_V / GL_L; // Potencial Defensivo Visitante
        const FA_V = GF_V / GL_V; // Fuerza Ataque Visitante
        const PD_L = GC_L / GL_V; // Potencial Defensivo Local

        // 3. Calcular Goles Esperados (Lambda)
        const lambda_L = FA_L * PD_V * GL_L;
        const lambda_V = FA_V * PD_L * GL_V;

        document.getElementById('lambda_l').textContent = lambda_L.toFixed(3);
        document.getElementById('lambda_v').textContent = lambda_V.toFixed(3);

        // 4. Crear la Matriz de Probabilidades (hasta 5 goles)
        const MAX_GOALS = 5; 
        let prob_matrix = [];
        let p_1 = 0, p_x = 0, p_2 = 0; // 1X2
        let p_total_goles = {}; 
        let p_local_0 = poisson(0, lambda_L);
        let p_visitante_0 = poisson(0, lambda_V);

        for (let i = 0; i <= MAX_GOALS; i++) { // Goles Local (gL)
            prob_matrix[i] = [];
            let p_gL = poisson(i, lambda_L);
            for (let j = 0; j <= MAX_GOALS; j++) { // Goles Visitante (gV)
                let p_gV = poisson(j, lambda_V);
                let p_score = p_gL * p_gV;
                prob_matrix[i][j] = p_score;

                // Sumar para 1X2
                if (i > j) {
                    p_1 += p_score;
                } else if (i === j) {
                    p_x += p_score;
                } else {
                    p_2 += p_score;
                }

                // Sumar para Goles Totales
                const total = i + j;
                p_total_goles[total] = (p_total_goles[total] || 0) + p_score;
            }
        }

        // 5. Ajustar 1X2 para que sume 100%
        const p_total_scores = p_1 + p_x + p_2;
        if (p_total_scores > 0) {
            const ratio = 1 / p_total_scores;
            p_1 *= ratio;
            p_x *= ratio;
            p_2 *= ratio;
        }


        // 6. Cálculo de Mercados Específicos

        // Draw No Bet 
        const p_dnb1 = p_1 / (1 - p_x);
        const p_dnb2 = p_2 / (1 - p_x);

        // Ambos Anotan (BTTS)
        // P(Sí) = 1 - P(Local no anota O Visitante no anota)
        const p_0_0 = prob_matrix[0][0];
        const p_btts_no = p_local_0 + p_visitante_0 - p_0_0;
        const p_btts_yes = 1 - p_btts_no;

        // Over/Under
        let p_total_0 = p_total_goles[0] || 0; 
        let p_total_1 = p_total_goles[1] || 0; 
        let p_total_2 = p_total_goles[2] || 0; 
        let p_total_3 = p_total_goles[3] || 0; 
        

        const p_under05 = p_total_0;
        const p_over05 = 1 - p_under05;

        const p_under15 = p_total_0 + p_total_1;
        const p_over15 = 1 - p_under15;

        const p_under25 = p_total_0 + p_total_1 + p_total_2;
        const p_over25 = 1 - p_under25;

        const p_under35 = p_total_0 + p_total_1 + p_total_2 + p_total_3;
        const p_over35 = 1 - p_under35;


        // 7. Mostrar Resultados (formato de porcentaje)
        const formatP = (p) => isNaN(p) ? '0.00%' : (p * 100).toFixed(2) + '%';

        document.getElementById('p_1').textContent = formatP(p_1);
        document.getElementById('p_x').textContent = formatP(p_x);
        document.getElementById('p_2').textContent = formatP(p_2);
        
        document.getElementById('p_dnb1').textContent = formatP(p_dnb1);
        document.getElementById('p_dnb2').textContent = formatP(p_dnb2);
        document.getElementById('p_btts_yes').textContent = formatP(p_btts_yes);

        document.getElementById('p_over05').textContent = formatP(p_over05);
        document.getElementById('p_over15').textContent = formatP(p_over15);
        document.getElementById('p_over25').textContent = formatP(p_over25);
        document.getElementById('p_over35').textContent = formatP(p_over35);
        
        document.getElementById('resultados').style.display = 'block';
    }
</script>

</body>
</html>
