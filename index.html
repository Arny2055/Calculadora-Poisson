<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Analizador de Patrones - Full Stats</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #3b82f6; --success: #10b981; --danger: #ef4444; --warning: #f59e0b; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); padding: 20px; line-height: 1.6; }
        .container { max-width: 1200px; margin: auto; }
        textarea { width: 100%; height: 140px; background: #1e293b; color: #fff; border: 2px solid #334155; border-radius: 8px; padding: 12px; margin-bottom: 15px; font-family: monospace; font-size: 11px; }
        .btn { background: var(--accent); color: white; border: none; padding: 16px; cursor: pointer; border-radius: 8px; font-weight: bold; width: 100%; font-size: 16px; transition: 0.2s; }
        .btn:hover { background: #2563eb; transform: translateY(-1px); }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; border-top: 4px solid var(--accent); }
        .card h3 { margin: 0 0 15px 0; font-size: 14px; color: #94a3b8; text-transform: uppercase; }
        .row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #334155; }
        .win { color: var(--success); font-weight: bold; }
        .loss { color: var(--danger); font-weight: bold; }
        .alert-box { background: #450a0a; border-left: 6px solid var(--danger); padding: 15px; margin: 20px 0; border-radius: 8px; }
        .success-box { background: #064e3b; border-left: 6px solid var(--success); padding: 15px; margin: 20px 0; border-radius: 8px; }
    </style>
</head>
<body>

<div class="container">
    <h1>üìä Herramienta de Miner√≠a de Datos Betting</h1>
    <p style="color: #94a3b8;">Pega tus datos (incluyendo la fila de nombres de columna) abajo:</p>
    
    <textarea id="dataInput" placeholder="Name | Desired Outcome | Odd | League..."></textarea>
    <button class="btn" onclick="runAnalysis()">ANALIZAR PATRONES GANADORES</button>

    <div id="results" style="display:none;">
        <div id="goldPattern" class="success-box"></div>
        <div id="redFlags" class="alert-box"></div>

        <div class="grid">
            <div class="card">
                <h3>üèÜ Rendimiento por Liga</h3>
                <div id="leagueData"></div>
            </div>
            <div class="card">
                <h3>üí∞ An√°lisis de Cuotas</h3>
                <div id="oddData"></div>
            </div>
            <div class="card">
                <h3>üî• Ataques y Presi√≥n (FT)</h3>
                <div id="attackData"></div>
            </div>
        </div>
    </div>
</div>

<script>
function runAnalysis() {
    const input = document.getElementById('dataInput').value.trim();
    if (!input) return;

    const lines = input.split('\n');
    const headerLine = lines[0].toLowerCase();
    const sep = headerLine.includes('\t') ? '\t' : ',';
    const headers = headerLine.split(sep).map(h => h.trim());

    // Buscador de columnas mejorado para tus nuevos datos
    const find = (keys) => headers.findIndex(h => keys.some(k => h === k || h.includes(k)));

    const idx = {
        league: find(['league', 'liga']),
        match: find(['match', 'partido']),
        result: headers.lastIndexOf('result'), // El √∫ltimo "Result" suele ser el final
        odd: find(['odd']),
        daH: find(['home dangerous attacks at ft']),
        daA: find(['away dangerous attacks at ft']),
        posH: find(['home position']),
        posA: find(['away position'])
    };

    let stats = { ligas: {}, odds: {}, attacks: {fuerte:{w:0,t:0}, debil:{w:0,t:0}}, total: {w:0, t:0} };

    lines.slice(1).forEach(line => {
        const col = line.split(sep);
        if (col.length < headers.length) return;

        const isWin = col[idx.result] && col[idx.result].toLowerCase().includes('winning');
        const liga = col[idx.league] || 'Desconocida';
        const cuota = parseFloat(col[idx.odd]?.replace(',', '.')) || 0;
        const totalDA = (parseInt(col[idx.daH]) || 0) + (parseInt(col[idx.daA]) || 0);

        stats.total.t++; if(isWin) stats.total.w++;

        // Agrupar Ligas
        if (!stats.ligas[liga]) stats.ligas[liga] = {w:0, t:0};
        stats.ligas[liga].t++; if(isWin) stats.ligas[liga].w++;

        // Agrupar Cuotas (Rango 0.5)
        const range = cuota ? (Math.floor(cuota * 2) / 2).toFixed(2) : "0.00";
        if (!stats.odds[range]) stats.odds[range] = {w:0, t:0};
        stats.odds[range].t++; if(isWin) stats.odds[range].w++;

        // Agrupar Ataques (Umbral 100 ataques peligrosos totales en FT)
        const catAtk = totalDA >= 90 ? 'fuerte' : 'debil';
        stats.attacks[catAtk].t++; if(isWin) stats.attacks[catAtk].w++;
    });

    display(stats);
}

function display(s) {
    document.getElementById('results').style.display = 'block';
    
    // 1. Ligas
    const ligasSorted = Object.entries(s.ligas).sort((a,b) => (b[1].w/b[1].t) - (a[1].w/a[1].t));
    document.getElementById('leagueData').innerHTML = ligasSorted.map(([n, v]) => {
        const wr = (v.w/v.t*100).toFixed(0);
        return `<div class="row"><span>${n}</span><span class="${wr > 50 ? 'win' : 'loss'}">${wr}%</span></div>`;
    }).join('');

    // 2. Cuotas
    const oddsSorted = Object.entries(s.odds).sort((a,b) => a[0] - b[0]);
    document.getElementById('oddData').innerHTML = oddsSorted.map(([n, v]) => 
        `<div class="row"><span>Cuota ~${n}</span><span class="win">${(v.w/v.t*100).toFixed(0)}%</span></div>`
    ).join('');

    // 3. Ataques
    document.getElementById('attackData').innerHTML = `
        <div class="row"><span>Partidos con +90 DA Totales</span><span class="win">${(s.attacks.fuerte.w/s.attacks.fuerte.t*100 || 0).toFixed(0)}%</span></div>
        <div class="row"><span>Partidos con -90 DA Totales</span><span class="loss">${(s.attacks.debil.w/s.attacks.debil.t*100 || 0).toFixed(0)}%</span></div>
    `;

    // 4. Mensajes de Patrones
    const mejorLiga = ligasSorted[0];
    const peorLiga = ligasSorted[ligasSorted.length - 1];

    document.getElementById('goldPattern').innerHTML = `
        <strong>‚úÖ ESTRATEGIA RECOMENDADA:</strong> Tu mayor tasa de √©xito est√° en <b>${mejorLiga[0]}</b> (${(mejorLiga[1].w/mejorLiga[1].t*100).toFixed(0)}%). 
        El total de acierto general es del <b>${(s.total.w/s.total.t*100).toFixed(1)}%</b>.
    `;

    document.getElementById('redFlags').innerHTML = `
        <strong>‚ö†Ô∏è ALERTA DE P√âRDIDAS:</strong> Evita apostar en <b>${peorLiga[0]}</b>. 
        Los partidos con poca actividad ofensiva (-90 Dangerous Attacks) tienen un acierto de solo el <b>${(s.attacks.debil.w/s.attacks.debil.t*100 || 0).toFixed(0)}%</b>.
    `;
}
</script>
</body>
</html>
