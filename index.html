<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Estadísticas Over/Under</title>
<style>
  body {font-family: Arial, sans-serif; background:#0b1220; color:#fff; padding:20px;}
  h1, h2 {color:#06b6d4;}
  select, input, button {padding:6px; margin:5px; border-radius:4px; border:1px solid #06b6d4;}
  table {border-collapse: collapse; width:100%; margin-top:10px;}
  th, td {border:1px solid #444; padding:6px; text-align:center;}
  th {background:#06b6d4; color:#fff;}
  .green {background:#16a34a;}
  .orange {background:#f59e0b;}
  .red {background:#dc2626;}
</style>
</head>
<body>
  <h1>Estadísticas Over/Under (últimos 10)</h1>
  <input type="file" id="fileInput" accept=".json"><br><br>
  
  <label>Selecciona Liga:</label>
  <select id="leagueSelect"></select>
  
  <br><br>
  <label>Equipo Local:</label>
  <select id="homeSelect"></select>
  
  <label>Equipo Visitante:</label>
  <select id="awaySelect"></select>
  
  <br><br>
  <label>Odd Over 2.5:</label>
  <input type="number" id="oddOver" step="0.01">
  <label>Odd Under 2.5:</label>
  <input type="number" id="oddUnder" step="0.01">
  
  <br><br>
  <button id="analyzeBtn">Analizar</button>
  
  <div id="results"></div>
  
<script>
let allMatches = [];

function getClass(p){
  if (p >= 70) return "green";
  if (p >= 50) return "orange";
  return "red";
}

function calcOver(matches, team, isHome, line){
  let filtered = matches.filter(m => 
    isHome ? m.Match.startsWith(team) : m.Match.endsWith(team)
  ).slice(-10);

  if (filtered.length === 0) return 0;
  let count = filtered.filter(m=>{
    let [h,a] = m["Result FT"].split("-").map(Number);
    return (h+a) > line;
  }).length;
  return Math.round((count/filtered.length)*100);
}

function analyze(leagueMatches, homeTeam, awayTeam){
  let overs = [0.5,1.5,2.5,3.5];
  let rows = overs.map(line=>{
    let home = calcOver(leagueMatches, homeTeam, true, line);
    let away = calcOver(leagueMatches, awayTeam, false, line);
    let avg = Math.round((home+away)/2);

    return `<tr>
      <td>Over ${line}</td>
      <td class="${getClass(home)}">${home}%</td>
      <td class="${getClass(away)}">${away}%</td>
      <td class="${getClass(avg)}">${avg}%</td>
    </tr>`;
  }).join("");

  return `<table>
    <tr><th></th><th>Home</th><th>Away</th><th>Match</th></tr>
    ${rows}
  </table>`;
}

function valueCheck(prob, odd){
  let implied = 100/odd;
  return prob > implied ? `<span class="green">Value Odd</span>` : `<span class="red">No Value</span>`;
}

// Cargar JSON
document.getElementById("fileInput").addEventListener("change", function(e){
  let file = e.target.files[0];
  let reader = new FileReader();
  reader.onload = function(event){
    allMatches = JSON.parse(event.target.result);
    let leagues = [...new Set(allMatches.map(m=>m.League))];
    
    let leagueSelect = document.getElementById("leagueSelect");
    leagueSelect.innerHTML = "<option value=''>--Selecciona--</option>" +
      leagues.map(l=>`<option value="${l}">${l}</option>`).join("");
  }
  reader.readAsText(file);
});

// Al seleccionar liga, llenar equipos
document.getElementById("leagueSelect").addEventListener("change", function(){
  let league = this.value;
  let leagueMatches = allMatches.filter(m=>m.League === league);
  let teams = [...new Set(leagueMatches.flatMap(m=>m.Match.split(" - ")))];
  
  document.getElementById("homeSelect").innerHTML = teams.map(t=>`<option value="${t}">${t}</option>`).join("");
  document.getElementById("awaySelect").innerHTML = teams.map(t=>`<option value="${t}">${t}</option>`).join("");
});

// Botón analizar
document.getElementById("analyzeBtn").addEventListener("click", function(){
  let league = document.getElementById("leagueSelect").value;
  let homeTeam = document.getElementById("homeSelect").value;
  let awayTeam = document.getElementById("awaySelect").value;
  let oddOver = parseFloat(document.getElementById("oddOver").value);
  let oddUnder = parseFloat(document.getElementById("oddUnder").value);

  if (!league || !homeTeam || !awayTeam) {
    alert("Debes seleccionar liga y equipos.");
    return;
  }
  
  let leagueMatches = allMatches.filter(m=>m.League === league);
  let table = analyze(leagueMatches, homeTeam, awayTeam);

  // cálculo específico para Over 2.5
  let homeOver25 = calcOver(leagueMatches, homeTeam, true, 2.5);
  let awayOver25 = calcOver(leagueMatches, awayTeam, false, 2.5);
  let matchOver25 = Math.round((homeOver25+awayOver25)/2);

  let valueOdds = "";
  if (oddOver && oddUnder){
    valueOdds = `
      <p>Odd Over 2.5: ${oddOver} → ${valueCheck(matchOver25, oddOver)}</p>
      <p>Odd Under 2.5: ${oddUnder} → ${valueCheck(100-matchOver25, oddUnder)}</p>
    `;
  }

  document.getElementById("results").innerHTML = `
    <h2>${homeTeam} (Home) vs ${awayTeam} (Away)</h2>
    ${table}
    ${valueOdds}
  `;
});
</script>
</body>
</html>