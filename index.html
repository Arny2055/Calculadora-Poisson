<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora [DATA STREAM] - MODE: DARK WEB</title>
    <style>
        /* --- ESTILOS DARK WEB BASE --- */
        body {
            font-family: 'Courier New', Courier, monospace; /* Fuente de terminal */
            margin: 0;
            background-color: #0d0d0d; /* Fondo Negro Oscuro */
            color: #00ff41; /* Texto Principal Verde Fluorescente */
        }
        .container {
            max-width: 950px;
            margin: auto;
            background: #1a1a1a; /* Contenedor Gris Oscuro */
            padding: 25px;
            border-radius: 0; /* Sin bordes redondeados para look terminal */
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.4); /* Sombra verde de ne√≥n */
            border: 1px solid #00ff41; /* Borde Verde */
        }
        h1, h2, h3 {
            text-align: center;
            color: #00ff41;
            text-shadow: 0 0 5px rgba(0, 255, 65, 0.7); /* Efecto ne√≥n en t√≠tulos */
            margin-bottom: 20px;
        }
        h1::before, h1::after {
            content: ">> ";
            color: #ff00ff; /* Magenta */
        }
        hr {
            border-color: #ff00ff; /* Separadores Magenta */
            margin: 30px 0;
            box-shadow: 0 0 5px rgba(255, 0, 255, 0.5);
        }

        /* --- LAYOUT Y SECCIONES --- */
        .grid-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .section-box {
            padding: 15px;
            border: 1px solid #ff00ff; /* Borde Magenta */
            background-color: #2a2a2a;
            box-shadow: inset 0 0 8px rgba(255, 0, 255, 0.3);
        }
        
        /* --- ENTRADAS DE DATOS --- */
        .match-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }
        .match-row label {
            width: 70px;
            font-weight: bold;
            color: #00ff41;
            flex-shrink: 0;
        }
        .match-row input[type="number"], .match-row select {
            padding: 5px;
            border: 1px solid #ff00ff;
            border-radius: 0;
            background-color: #0d0d0d; /* Fondo de input negro */
            color: #00ff41; /* Texto de input verde */
            box-shadow: inset 0 0 5px rgba(0, 255, 65, 0.5);
        }
        .match-row select {
            width: 100%;
        }
        
        /* --- ESTILOS DE RESULTADO (COLORES) --- */
        .result-won { 
            background-color: #008000 !important; /* Verde oscuro fuerte */
            color: #ffffff !important; 
            border-color: #00ff00 !important;
        }
        .result-lost { 
            background-color: #800000 !important; /* Rojo oscuro fuerte */
            color: #ffffff !important; 
            border-color: #ff0000 !important;
        }
        .result-default { 
            background-color: #0d0d0d; 
            color: #00ff41; 
        }

        /* --- BOTONES --- */
        button {
            width: 100%;
            padding: 10px;
            border: 1px solid;
            border-radius: 0;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            font-weight: bold;
            text-shadow: 0 0 3px rgba(0, 0, 0, 0.8);
        }
        #calc-roi-btn { 
            background-color: #0056b3; 
            color: #00ff41; 
            border-color: #00ff41;
            box-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
        }
        #calc-roi-btn:hover { background-color: #00ff41; color: #1a1a1a; box-shadow: 0 0 15px rgba(0, 255, 65, 0.8); }
        
        #save-match-btn { 
            background-color: #008000; 
            color: #ffffff; 
            border-color: #00ff41;
            box-shadow: 0 0 8px rgba(0, 255, 65, 0.5);
        }
        #save-match-btn:hover { background-color: #00ff41; color: #1a1a1a; }

        /* --- RESULTADOS Y TABLA --- */
        #results {
            padding: 15px;
            border-radius: 0;
            background-color: #2a2a2a;
            border: 2px solid #ff00ff;
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
        }
        .positive { color: #00ff41; font-weight: bold; } /* Ganancia Verde */
        .negative { color: #ff00ff; font-weight: bold; } /* P√©rdida Magenta */
        .zero { color: #ffff00; font-weight: bold; } /* Cero Amarillo */
        
        .history-section {
            background-color: #1a1a1a;
            border: 1px solid #00ff41;
            box-shadow: 0 0 10px rgba(0, 255, 65, 0.4);
        }
        #match-history-table {
            border: 1px solid #ff00ff;
        }
        #match-history-table th, #match-history-table td {
            border: 1px solid #555;
            background-color: #1a1a1a;
        }
        #match-history-table th {
            background-color: #000;
            color: #00ff41;
            border-bottom: 2px solid #ff00ff;
        }
        .history-roi-summary {
            border-bottom: 1px solid #ff00ff;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>[DATA STREAM] - CALCULADORA DE ROI</h1>

        <section>
            <h2>[ANALYSIS] ROI HIST√ìRICO (STAKE 1 UNIT)</h2>
            <p>INGRESE DATOS DE RENDIMIENTO BASE POR EQUIPO. FILTRO M√çNIMO: 15%</p>
            <div class="grid-layout">
                <div class="section-box">
                    <h3 style="color: #ff00ff;">üè† SECCI√ìN LOCAL</h3>
                    <div id="local-matches"></div>
                </div>

                <div class="section-box">
                    <h3 style="color: #ff00ff;">‚úàÔ∏è SECCI√ìN VISITANTE</h3>
                    <div id="visitor-matches"></div>
                </div>
            </div>
            <button id="calc-roi-btn" onclick="calculateROI()">// INICIAR C√ÅLCULO ROI //</button>

            <div id="results" style="display: none;">
                <div class="result-item" id="roi-local-output"></div>
                <div class="result-item" id="roi-visitor-output"></div>
                <div class="result-item" id="roi-combined-output"></div>
            </div>
        </section>
        
        <hr>

        <section style="max-width: 450px; margin: 0 auto;">
            <div class="section-box">
                <h3 style="color: #00ff41;">üíæ REGISTRO DE APUESTAS [O/U | BTTS]</h3>
                <p>REGISTRE OPERACIONES CON STAKE REAL.</p>
                <div class="match-row">
                    <label for="reg-market">MERCADO:</label>
                    <select id="reg-market">
                        <option value="OU">OVER/UNDER</option>
                        <option value="BTTS">BTTS</option>
                    </select>
                </div>
                <div class="match-row">
                    <label for="reg-stake">STAKE:</label>
                    <input type="number" id="reg-stake" step="0.01" min="0.01" placeholder="INVERSI√ìN">
                </div>
                <div class="match-row">
                    <label for="reg-quota">CUOTA:</label>
                    <input type="number" id="reg-quota" step="0.01" min="1.01" placeholder="CUOTA APOSTADA">
                </div>
                <div class="match-row">
                    <label for="reg-result">RESULTADO:</label>
                    <select id="reg-result" onchange="applyResultStyle(this)" class="result-default">
                        <option value="" selected disabled>-- SELECCIONE --</option>
                        <option value="1">GANADO</option>
                        <option value="0">PERDIDO</option>
                    </select>
                </div>
                <button id="save-match-btn" onclick="saveMatchToHistory()">// REGISTRAR OPERACI√ìN // </button>
            </div>
        </section>

        <section class="history-section">
            <h2>üìú DATA LOG: REGISTRO DE APUESTAS</h2>
            
            <div class="history-roi-summary" id="historical-roi-summary">
                </div>
            
            <table id="match-history-table">
                <thead>
                    <tr>
                        <th>#ID</th>
                        <th>MERCADO</th>
                        <th>STAKE</th>
                        <th>CUOTA</th>
                        <th>ESTADO</th>
                        <th>GANANCIA NETA</th>
                        <th>ROI (%)</th>
                    </tr>
                </thead>
                <tbody id="match-history-body">
                    </tbody>
            </table>
        </section>
    </div>

    <script>
        const NUM_MATCHES = 5;
        const INVESTMENT_PER_MATCH = 1; 
        const TOTAL_INVESTMENT_HISTORIC = NUM_MATCHES * INVESTMENT_PER_MATCH;
        const MIN_ROI_THRESHOLD = 15; // Umbral de ROI del 15%

        let matchHistory = []; // Array para almacenar todos los partidos registrados
        let historicalRoiData = { roiLocal: 0, roiVisitor: 0 }; // Objeto para guardar los √∫ltimos ROIs hist√≥ricos calculados

        // --- Funciones de Utilidad y Estilos ---

        /** Aplica la clase CSS de color seg√∫n el resultado seleccionado. */
        function applyResultStyle(selectElement) {
            const value = selectElement.value;
            selectElement.classList.remove('result-won', 'result-lost', 'result-default');
            
            if (value === '1') {
                selectElement.classList.add('result-won');
            } else if (value === '0') {
                selectElement.classList.add('result-lost');
            } else {
                selectElement.classList.add('result-default');
            }
        }

        /** Genera los campos de entrada para los 5 partidos hist√≥ricos (Stake 1). */
        function generateInputs(teamId, prefix) {
            const container = document.getElementById(teamId);
            let html = '';
            for (let i = 1; i <= NUM_MATCHES; i++) {
                html += `
                    <div class="match-row">
                        <label>P. ${i}:</label>
                        <input type="number" id="${prefix}-quota-${i}" step="0.01" min="1.01" placeholder="CUOTA" value="2.00" required>
                        <select id="${prefix}-result-${i}" onchange="applyResultStyle(this)" class="result-default">
                            <option value="" selected disabled>RES.</option>
                            <option value="1">GAN.</option>
                            <option value="0">PER.</option>
                        </select>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        // --- L√≥gica de ROI Hist√≥rico (Stake 1) ---

        /** Calcula la ganancia neta para un equipo en los 5 partidos hist√≥ricos. */
        function calculateNetProfit(prefix) {
            let totalReturn = 0;
            for (let i = 1; i <= NUM_MATCHES; i++) {
                const quotaInput = document.getElementById(`${prefix}-quota-${i}`);
                const resultSelect = document.getElementById(`${prefix}-result-${i}`);
                
                if (!quotaInput.value || isNaN(parseFloat(quotaInput.value)) || resultSelect.value === "") {
                    return null;
                }
                
                const quota = parseFloat(quotaInput.value);
                const isWon = parseInt(resultSelect.value);

                if (isWon === 1) {
                    totalReturn += quota; 
                } 
            }
            return totalReturn - TOTAL_INVESTMENT_HISTORIC; 
        }

        /** Calcula el ROI hist√≥rico, guarda los valores y actualiza el resumen. */
        function calculateROI() {
            const netProfitLocal = calculateNetProfit('local');
            const netProfitVisitor = calculateNetProfit('visitor');

            if (netProfitLocal === null || netProfitVisitor === null) {
                alert('üö® ERROR: COMPLETAR TODOS LOS CAMPOS DE CUOTA Y RESULTADO PARA AN√ÅLISIS HIST√ìRICO.');
                historicalRoiData = { roiLocal: 0, roiVisitor: 0 };
                updateHistoricalSummary();
                return;
            }

            const roiLocal = (netProfitLocal / TOTAL_INVESTMENT_HISTORIC) * 100;
            const roiVisitor = (netProfitVisitor / TOTAL_INVESTMENT_HISTORIC) * 100;
            
            // Guardamos los valores para el filtro del resumen
            historicalRoiData.roiLocal = roiLocal;
            historicalRoiData.roiVisitor = roiVisitor;

            // Actualizamos el resumen del historial con los nuevos ROIs
            updateHistoricalSummary();

            // Opcional: mostrar los resultados en la secci√≥n de "Resultados ROI Hist√≥rico" (oculta)
            const totalNetProfit = netProfitLocal + netProfitVisitor;
            const roiCombined = (totalNetProfit / (TOTAL_INVESTMENT_HISTORIC * 2)) * 100;
            
            document.getElementById('roi-local-output').innerHTML = formatResult('LOCAL', roiLocal);
            document.getElementById('roi-visitor-output').innerHTML = formatResult('VISITANTE', roiVisitor);
            document.getElementById('roi-combined-output').innerHTML = formatResult('COMBINADO', roiCombined);
            document.getElementById('results').style.display = 'block';
        }


        // --- L√≥gica de Registro de Apuestas Reales (Stake y Mercado Variable) ---

        /** Guarda una apuesta en el historial y actualiza la tabla. */
        function saveMatchToHistory() {
            const market = document.getElementById('reg-market').value;
            const stakeInput = document.getElementById('reg-stake').value;
            const quotaInput = document.getElementById('reg-quota').value;
            const resultSelect = document.getElementById('reg-result').value;

            if (!stakeInput || !quotaInput || resultSelect === "") {
                alert('üö® ERROR: COMPLETAR STAKE, CUOTA Y RESULTADO.');
                return;
            }

            const stake = parseFloat(stakeInput);
            const quota = parseFloat(quotaInput);
            const isWon = parseInt(resultSelect);
            
            if (stake <= 0 || quota <= 1.0) {
                alert('üö® ERROR: STAKE DEBE SER > 0 Y CUOTA > 1.0');
                return;
            }

            // C√°lculos del partido guardado
            const grossReturn = isWon === 1 ? (quota * stake) : 0; 
            const netProfit = grossReturn - stake; 
            const roi = (netProfit / stake) * 100; 

            const match = {
                id: matchHistory.length + 1,
                market: market,
                stake: stake,
                quota: quota,
                result: isWon,
                netProfit: netProfit,
                roi: roi
            };

            matchHistory.push(match);
            updateHistoryTable();

            // Limpiar campos y dar feedback
            document.getElementById('reg-stake').value = '';
            document.getElementById('reg-quota').value = '';
            document.getElementById('reg-result').value = ''; 
            document.getElementById('reg-result').classList.add('result-default');
            document.getElementById('reg-result').classList.remove('result-won', 'result-lost');
            alert(`‚úÖ REGISTRO #${match.id} [${market}] GUARDADO.`);
        }

        /** Calcula el ROI Total de todas las apuestas en el historial (O/U & BTTS). */
        function calculateTotalROI() {
            if (matchHistory.length === 0) {
                return { totalInvestment: 0, totalNetProfit: 0, totalROI: 0 };
            }

            let totalInvestment = 0;
            let totalNetProfit = 0;

            matchHistory.forEach(match => {
                totalInvestment += match.stake;
                totalNetProfit += match.netProfit;
            });

            const totalROI = (totalNetProfit / totalInvestment) * 100;
            
            return { totalInvestment, totalNetProfit, totalROI };
        }

        /** Actualiza el resumen de ROI en la parte superior del historial, aplicando el filtro del 15%. */
        function updateHistoricalSummary() {
            const historySummary = document.getElementById('historical-roi-summary');
            const totalROIData = calculateTotalROI(); // ROI de las apuestas reales
            let summaryHTML = '';
            let historicalSummaryItems = [];

            // 1. ROI LOCAL: Aplicar filtro
            if (historicalRoiData.roiLocal >= MIN_ROI_THRESHOLD) {
                historicalSummaryItems.push(`
                    <div style="font-size:1.0em;">
                        ${formatResult(`üè† ROI LOCAL`, historicalRoiData.roiLocal)}
                    </div>`);
            }

            // 2. ROI VISITANTE: Aplicar filtro
            if (historicalRoiData.roiVisitor >= MIN_ROI_THRESHOLD) {
                historicalSummaryItems.push(`
                    <div style="font-size:1.0em;">
                        ${formatResult(`‚úàÔ∏è ROI VISITANTE`, historicalRoiData.roiVisitor)}
                    </div>`);
            }
            
            // Unir los elementos hist√≥ricos
            summaryHTML = historicalSummaryItems.join('');

            // 3. ROI GENERAL (Siempre se muestra si hay apuestas reales o no)
            const roiGeneralFormatted = formatResult(`‚ú® ROI GENERAL (${matchHistory.length} APUESTAS)`, totalROIData.totalROI);
            
            // A√±adir el ROI General con o sin separador.
            summaryHTML += `
                <div style="font-size:1.0em; font-weight: bold; ${historicalSummaryItems.length > 0 ? 'border-left: 1px solid #ff00ff; padding-left: 20px;' : ''}">
                    ${roiGeneralFormatted}
                </div>
            `;
            
            historySummary.innerHTML = summaryHTML;
        }


        /** Actualiza la tabla de historial con los datos del array. */
        function updateHistoryTable() {
            const tableBody = document.getElementById('match-history-body');
            tableBody.innerHTML = ''; 

            matchHistory.forEach(match => {
                const row = tableBody.insertRow();
                row.insertCell().textContent = match.id;
                row.insertCell().textContent = match.market;
                row.insertCell().textContent = match.stake.toFixed(2);
                row.insertCell().textContent = match.quota.toFixed(2);
                
                const resultCell = row.insertCell();
                resultCell.textContent = match.result === 1 ? 'GANADO' : 'PERDIDO';
                resultCell.classList.add(match.result === 1 ? 'positive' : 'negative');
                
                const profitCell = row.insertCell();
                profitCell.textContent = match.netProfit.toFixed(2);
                profitCell.classList.add(match.netProfit >= 0 ? 'positive' : 'negative');

                const roiCell = row.insertCell();
                roiCell.textContent = `${match.roi.toFixed(2)}%`;
                roiCell.classList.add(match.roi >= 0 ? 'positive' : 'negative');
            });
            
            // Recalcula y actualiza el resumen (incluyendo el ROI General de las apuestas reales)
            updateHistoricalSummary(); 
        }

        /** Formatea el resultado de ROI con color. */
        function formatResult(label, roi) {
            const roundedRoi = roi.toFixed(2);
            let className;
            let sign = roi >= 0 ? '+' : '';

            if (roi > 0) {
                className = 'positive';
            } else if (roi < 0) {
                className = 'negative';
                sign = ''; 
            } else {
                className = 'zero';
            }
            return `[${label}]: <span class="${className}">${sign}${roundedRoi}%</span>`;
        }
        
        // Inicializar inputs al cargar la p√°gina
        window.onload = function() {
            generateInputs('local-matches', 'local');
            generateInputs('visitor-matches', 'visitor');
            updateHistoricalSummary(); // Inicializa el resumen
        };
    </script>

</body>
</html>
