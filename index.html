<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herramienta de Backtesting de Fútbol</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #resultados { margin-top: 20px; padding: 10px; border: 1px solid #ccc; white-space: pre-wrap; background-color: #f9f9f9; }
        .success { color: green; font-weight: bold; }
        .failure { color: red; }
    </style>
</head>
<body>

    <h1>Herramienta de Backtesting de Fútbol ⚽</h1>

    <input type="file" id="jsonFile" accept=".json">
    <button onclick="iniciarBacktesting()">Iniciar Backtesting</button>

    <h2>Resultados</h2>
    <div id="resultados">Carga un archivo JSON para comenzar...</div>

    <script>
        let datosPartidos = []; // Aquí se almacenarán los datos del JSON

        document.getElementById('jsonFile').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    // Intenta parsear el contenido como JSON
                    datosPartidos = JSON.parse(e.target.result);
                    document.getElementById('resultados').innerHTML = `<p class="success">Archivo JSON cargado correctamente. Se encontraron ${datosPartidos.length} partidos.</p>`;
                } catch (error) {
                    document.getElementById('resultados').innerHTML = `<p class="failure">Error al leer o parsear el archivo JSON: ${error.message}</p>`;
                    datosPartidos = [];
                }
            };
            reader.readAsText(file);
        });

        function iniciarBacktesting() {
            if (datosPartidos.length === 0) {
                document.getElementById('resultados').innerHTML = '<p class="failure">Por favor, primero carga un archivo JSON.</p>';
                return;
            }

            let victorias = 0;
            let perdidas = 0;
            let totalApostado = 0;
            let gananciaNeta = 0;
            let resultadosHTML = '<h3>Reporte de Backtesting:</h3>';

            // --- Lógica de Backtesting ---
            datosPartidos.forEach((partido, index) => {
                // Supongamos que tu estrategia es apostar al "Más de 2.5 Goles"
                // usando la cuota promedio de pre-partido (Avg>2)

                // 1. Definir la Regla de la Estrategia (Ejemplo: Apostar si la cuota es >= 1.35)
                const cuotaMas2_5 = parseFloat(partido.AvgB365_2_5_G); // Ajusta esta clave a la que uses para "Over 2.5"
                const cuotaMinima = 1.35;
                const apuesta = 1; // Apuesta fija por partido (unidad)

                if (cuotaMas2_5 && cuotaMas2_5 >= cuotaMinima) {
                    totalApostado += apuesta;

                    // 2. Determinar el Resultado Real
                    // FTHG (Full Time Home Goals) + FTAG (Full Time Away Goals)
                    const golesTotales = parseInt(partido.FTHG) + parseInt(partido.FTAG);
                    const esGanadora = golesTotales > 2.5; // Gana si hay 3 o más goles

                    // 3. Calcular Ganancias/Pérdidas
                    if (esGanadora) {
                        const ganancia = (cuotaMas2_5 - 1) * apuesta;
                        gananciaNeta += ganancia;
                        victorias++;
                        resultadosHTML += `<p>Partido #${index + 1}: ✅ Gana. Goles: ${golesTotales}. Cuota: ${cuotaMas2_5}. Ganancia: +${ganancia.toFixed(2)}</p>`;
                    } else {
                        gananciaNeta -= apuesta;
                        perdidas++;
                        resultadosHTML += `<p>Partido #${index + 1}: ❌ Pierde. Goles: ${golesTotales}. Cuota: ${cuotaMas2_5}. Pérdida: -${apuesta.toFixed(2)}</p>`;
                    }
                } else {
                    //resultadosHTML += `<p>Partido #${index + 1}: - No cumple estrategia (Cuota ${cuotaMas2_5 || 'N/A'})</p>`;
                }
            });
            // --- Fin de Lógica de Backtesting ---

            // --- Resumen de Resultados ---
            const porcentajeAcierto = totalApostado > 0 ? ((victorias / (victorias + perdidas)) * 100).toFixed(2) : 0;
            const rendimiento = totalApostado > 0 ? ((gananciaNeta / totalApostado) * 100).toFixed(2) : 0;

            resultadosHTML += '<hr>';
            resultadosHTML += `<h4>RESUMEN FINAL</h4>`;
            resultadosHTML += `<p>Total de Apuestas (Que cumplen estrategia): <span class="success">${victorias + perdidas}</span></p>`;
            resultadosHTML += `<p>Victorias: <span class="success">${victorias}</span></p>`;
            resultadosHTML += `<p>Pérdidas: <span class="failure">${perdidas}</span></p>`;
            resultadosHTML += `<p>Porcentaje de Acierto: <span class="${porcentajeAcierto >= 50 ? 'success' : 'failure'}">${porcentajeAcierto}%</span></p>`;
            resultadosHTML += `<p>Ganancia/Pérdida Neta (Profit/Loss): <span class="${gananciaNeta >= 0 ? 'success' : 'failure'}">${gananciaNeta.toFixed(2)} unidades</span></p>`;
            resultadosHTML += `<p>Rendimiento (ROI): <span class="${rendimiento >= 0 ? 'success' : 'failure'}">${rendimiento}%</span></p>`;

            document.getElementById('resultados').innerHTML = resultadosHTML;
        }

    </script>

</body>
</html>
