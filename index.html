<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AnÃ¡lisis Over 2.5 â€” Ãšltimos 8â€“10 Partidos</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #121212;
    color: #eee;
    padding: 30px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 {
    color: #00e676;
  }
  .container {
    background: #1e1e1e;
    padding: 25px 30px;
    border-radius: 10px;
    width: 95%;
    max-width: 950px;
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
  }
  input[type="file"] {
    background: #2a2a2a;
    border: none;
    padding: 10px;
    border-radius: 6px;
    color: #fff;
    cursor: pointer;
    width: 100%;
    margin-bottom: 20px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
  }
  th, td {
    border-bottom: 1px solid #333;
    padding: 8px;
    text-align: center;
  }
  th {
    background: #00e676;
    color: #111;
  }
  tr:hover {
    background: #222;
  }
</style>
</head>
<body>

<h1>ðŸ“Š AnÃ¡lisis Over 2.5 (Ãšltimos 8â€“10 Partidos)</h1>

<div class="container">
  <input type="file" id="fileInput" accept=".json">
  <div id="tabla-container"></div>
</div>

<script>
document.getElementById('fileInput').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(event) {
    try {
      let data = JSON.parse(event.target.result);
      if (!Array.isArray(data)) data = [data];

      // Filtrar partidos vÃ¡lidos con resultado final
      data = data.filter(item => item["Result FT"] && item["Match"]);

      // Ordenar por fecha si existe el campo Date
      data.sort((a, b) => new Date(a.Date) - new Date(b.Date));

      const stats = calcularProbabilidades(data);
      mostrarTabla(stats);
    } catch (err) {
      alert("Error al leer el archivo JSON. Verifica su formato.");
    }
  };
  reader.readAsText(file);
});

function calcularProbabilidades(data) {
  const equipos = {};

  data.forEach(item => {
    const match = item.Match.split(" - ");
    if (match.length < 2) return;

    const local = match[0].trim();
    const visita = match[1].trim();
    const resultado = item["Result FT"].split("-");
    const golesLocal = parseInt(resultado[0]);
    const golesVisita = parseInt(resultado[1]);
    const totalGoles = golesLocal + golesVisita;
    const esOver = totalGoles > 2.5 ? 1 : 0;

    // Agregar partido a historial de local y visita
    equipos[local] = equipos[local] || { local: [] };
    equipos[local].local.push(esOver);

    equipos[visita] = equipos[visita] || { visita: [] };
    equipos[visita].visita.push(esOver);
  });

  const resultados = [];

  for (const equipo in equipos) {
    for (const rol in equipos[equipo]) {
      const partidos = equipos[equipo][rol];
      if (!partidos || partidos.length < 8) continue;

      // Tomar los Ãºltimos 8, 9 o 10 (si hay mÃ¡s)
      const ultimos = partidos.slice(-10);
      if (ultimos.length < 8) continue; // descartar si no alcanza 8

      const jugados = ultimos.length;
      const ganados = ultimos.reduce((a, b) => a + b, 0);
      const prob = ganados / jugados;
      const cuota = 1 / prob;

      resultados.push({
        equipo,
        rol,
        jugados,
        ganados,
        probabilidad: (prob * 100).toFixed(1) + "%",
        cuota: cuota.toFixed(2)
      });
    }
  }

  return resultados.sort((a, b) => parseFloat(b.probabilidad) - parseFloat(a.probabilidad));
}

function mostrarTabla(datos) {
  const container = document.getElementById('tabla-container');
  if (datos.length === 0) {
    container.innerHTML = "<p>No hay equipos con al menos 8 partidos recientes.</p>";
    return;
  }

  let html = `
    <table>
      <thead>
        <tr>
          <th>Equipo</th>
          <th>Rol</th>
          <th>Partidos (Ãºltimos)</th>
          <th>Overs 2.5</th>
          <th>Probabilidad</th>
          <th>Cuota Justa</th>
        </tr>
      </thead>
      <tbody>
  `;

  datos.forEach(d => {
    html += `
      <tr>
        <td>${d.equipo}</td>
        <td>${d.rol}</td>
        <td>${d.jugados}</td>
        <td>${d.ganados}</td>
        <td>${d.probabilidad}</td>
        <td>${d.cuota}</td>
      </tr>
    `;
  });

  html += "</tbody></table>";
  container.innerHTML = html;
}
</script>

</body>
</html>