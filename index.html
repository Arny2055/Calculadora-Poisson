<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sistema Maestro de Inteligencia en Apuestas</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #3b82f6; --success: #10b981; --danger: #ef4444; --gold: #fbbf24; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 20px; font-size: 14px; }
        .container { max-width: 1400px; margin: auto; }
        textarea { width: 100%; height: 100px; background: #334155; color: white; border: 1px solid #475569; border-radius: 8px; padding: 12px; margin-bottom: 10px; font-family: monospace; }
        .btn { background: var(--accent); color: white; border: none; padding: 15px; cursor: pointer; border-radius: 6px; font-weight: bold; width: 100%; transition: 0.3s; margin-bottom: 10px; }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; border-bottom: 4px solid #334155; }
        .league-section { background: var(--card); border-radius: 12px; padding: 20px; margin-top: 30px; border-left: 5px solid var(--accent); }
        .row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #2d3748; align-items: center; }
        .roi-tag { font-weight: bold; padding: 2px 6px; border-radius: 4px; }
        .pos { color: var(--success); background: rgba(16, 185, 129, 0.1); }
        .neg { color: var(--danger); background: rgba(239, 68, 68, 0.1); }
        .sim-box { background: #1e3a8a; padding: 20px; border-radius: 12px; border: 2px solid var(--gold); margin-top: 15px; text-align: center; }
        h2, h3, h4 { margin-top: 0; color: var(--gold); text-transform: uppercase; letter-spacing: 1px; }
        .chk-row { display: flex; align-items: center; gap: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>üöÄ Betting Command Center Pro</h1>
    <textarea id="dataInput" placeholder="Pega tus datos con encabezados aqu√≠..."></textarea>
    <button class="btn" onclick="mainAnalysis()">1. ANALIZAR TODO EL HISTORIAL</button>

    <div id="resultsMain" style="display:none;">
        <div class="grid">
            <div class="card">
                <h3>‚öñÔ∏è Simulador por Cuotas</h3>
                <p style="font-size:12px; color:#94a3b8;">Desmarca rangos para ver c√≥mo sube tu ROI real.</p>
                <div id="oddsFilterList"></div>
                <button class="btn" style="background:var(--gold); color:#000; margin-top:10px;" onclick="runSimulation()">RE-CALCULAR ESTRATEGIA</button>
                <div id="simOutput" class="sim-box"></div>
            </div>

            <div class="card">
                <h3>üõ°Ô∏è Gesti√≥n de Riesgo</h3>
                <div class="row"><span>Peor Racha Hist√≥rica:</span> <span id="maxLoss" class="neg" style="font-weight:bold;">0</span></div>
                <div class="row"><span>Bankroll Necesario:</span> <span id="bankReq" style="color:var(--gold); font-weight:bold;">0 u.</span></div>
                <div class="row"><span>Stake M√°ximo Sugerido:</span> <span id="stakeSugg">0%</span></div>
                <div id="riskAdvice" style="margin-top:15px; font-size:12px; color:#94a3b8;"></div>
            </div>

            <div class="card">
                <h3>üíé Equipos con m√°s Valor</h3>
                <div id="topTeams"></div>
            </div>
        </div>

        <h2 style="margin-top:40px;">üî¨ Micro-Patrones por Liga (Independientes)</h2>
        <div id="leagueBreakdown"></div>
    </div>
</div>

<script>
let globalData = [];

function mainAnalysis() {
    const input = document.getElementById('dataInput').value.trim();
    if (!input) return;

    const lines = input.split('\n');
    const headers = lines[0].split('\t').map(h => h.trim().toLowerCase());
    const find = (keys) => headers.findIndex(h => keys.some(k => h.includes(k)));

    const idx = {
        league: find(['league', 'liga']),
        date: find(['date', 'fecha']),
        match: find(['match']),
        result: headers.lastIndexOf('result'),
        odd: find(['odd'])
    };

    globalData = [];
    let leagues = {};
    let oddsGroups = {};
    let teams = {};
    let maxLoss = 0, currLoss = 0;

    lines.slice(1).forEach(line => {
        const col = line.split('\t').map(c => c.trim());
        if (col.length < 5) return;

        const isWin = col.some((c, i) => i >= idx.result && c.toLowerCase() === 'winning');
        const odd = parseFloat(col[idx.odd]?.replace(',','.')) || 0;
        const league = col[idx.league] || "Otras";
        const dateStr = col[idx.date] || "";
        const [hT, aT] = col[idx.match] ? col[idx.match].split(' - ') : ['?', '?'];

        if(odd > 0) {
            const floor = (Math.floor(odd * 10) / 10).toFixed(2);
            const range = `${floor} - ${(parseFloat(floor)+0.10).toFixed(2)}`;
            
            const matchObj = { odd, isWin, league, range, dateStr, teams: [hT, aT] };
            globalData.push(matchObj);

            // Rachas
            if(isWin) { maxLoss = Math.max(maxLoss, currLoss); currLoss = 0; }
            else { currLoss++; }

            // Agrupar por cuotas para el filtro
            if(!oddsGroups[range]) oddsGroups[range] = {s:0, r:0, w:0};
            oddsGroups[range].s++; oddsGroups[range].r += (isWin?odd:0); oddsGroups[range].w += (isWin?1:0);

            // Agrupar por Ligas
            if(!leagues[league]) leagues[league] = { s:0, r:0, days:{}, hours:{} };
            leagues[league].s++; leagues[league].r += (isWin?odd:0);

            // D√≠a y Hora por liga
            let day = "N/A", slot = "Sin Hora";
            const d = dateStr.toLowerCase();
            if(d.includes('lun')) day="Lunes"; else if(d.includes('mar')) day="Martes"; else if(d.includes('dom')) day="Domingo"; // ... (simplificado para el script)
            
            const hhMatch = dateStr.match(/(\d{2}):(\d{2})/);
            const hh = hhMatch ? parseInt(hhMatch[1]) : -1;
            if(hh >= 13 && hh < 18) slot="Tarde"; else if(hh >= 18 && hh < 22) slot="Noche"; else slot="Otros";

            if(!leagues[league].days[day]) leagues[league].days[day] = {s:0, r:0};
            leagues[league].days[day].s++; leagues[league].days[day].r += (isWin?odd:0);

            // Equipos ROI
            [hT, aT].forEach(t => {
                if(!t) return;
                if(!teams[t]) teams[t] = {s:0, r:0};
                teams[t].s++; teams[t].r += (isWin?odd:0);
            });
        }
    });

    maxLoss = Math.max(maxLoss, currLoss);
    renderResults(oddsGroups, leagues, teams, maxLoss);
}

function renderResults(odds, leagues, teams, ml) {
    document.getElementById('resultsMain').style.display = 'block';
    
    // Checkboxes de Cuotas
    const oddsCont = document.getElementById('oddsFilterList');
    oddsCont.innerHTML = "";
    Object.entries(odds).sort((a,b) => parseFloat(a[0]) - parseFloat(b[0])).forEach(([range, d]) => {
        const roi = ((d.r/d.s - 1)*100).toFixed(1);
        oddsCont.innerHTML += `<div class="row"><div class="chk-row"><input type="checkbox" checked class="rng-chk" value="${range}"><span>${range}</span></div><span class="roi-tag ${roi>=0?'pos':'neg'}">${roi}%</span></div>`;
    });

    // Riesgo
    document.getElementById('maxLoss').innerText = ml;
    const br = (ml * 3) + 5;
    document.getElementById('bankReq').innerText = br + " uds.";
    document.getElementById('stakeSugg').innerText = (100/br).toFixed(1) + "%";

    // Equipos
    const topT = Object.entries(teams).filter(e => e[1].s > 1).sort((a,b) => (b[1].r/b[1].s) - (a[1].r/a[1].s)).slice(0,6);
    document.getElementById('topTeams').innerHTML = topT.map(([n, d]) => `<div class="row"><span>${n}</span><span class="pos">+${((d.r/d.s-1)*100).toFixed(0)}% ROI</span></div>`).join('');

    // Ligas
    const lDiv = document.getElementById('leagueBreakdown');
    lDiv.innerHTML = "";
    Object.entries(leagues).forEach(([name, data]) => {
        const lRoi = ((data.r/data.s-1)*100).toFixed(1);
        lDiv.innerHTML += `<div class="league-section"><h4>${name} (ROI: ${lRoi}%)</h4><div class="grid"><div class="card"><h5>D√≠as Rentables</h5>${Object.entries(data.days).map(([d,s]) => `<div class="row"><span>${d}</span><span>${((s.r/s.s-1)*100).toFixed(0)}%</span></div>`).join('')}</div></div></div>`;
    });
}

function runSimulation() {
    const selected = Array.from(document.querySelectorAll('.rng-chk:checked')).map(c => c.value);
    let s=0, r=0, w=0;
    globalData.forEach(m => {
        if(selected.includes(m.range)) { s++; r+= (m.isWin?m.odd:0); if(m.isWin) w++; }
    });
    const roi = s > 0 ? ((r/s - 1)*100).toFixed(2) : 0;
    document.getElementById('simOutput').innerHTML = `<h4>ROI SIMULADO: ${roi}%</h4><p>Partidos: ${s} | Acierto: ${(w/s*100).toFixed(1)}%</p>`;
}
</script>
</body>
</html>
