<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Football Backtester v5.0 (Versus Mode)</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <style>
        :root {
            --bg-main: #0f172a;
            --bg-panel: #1e293b;
            --bg-input: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --border: #334155;
        }

        * { box-sizing: border-box; outline: none; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-primary);
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* HEADER */
        header {
            background-color: var(--bg-panel);
            padding: 0 20px;
            height: 60px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }

        .brand { font-weight: 700; display: flex; align-items: center; gap: 10px; min-width: 180px; }
        .tag { font-size:0.7em; background:var(--accent); padding:2px 6px; border-radius:4px; color:white; }
        .url-bar { display: flex; flex-grow: 1; gap: 10px; }
        .url-input { background: var(--bg-main); border: 1px solid var(--border); color: white; padding: 6px 12px; border-radius: 6px; width: 100%; font-family: monospace; }
        .btn { padding: 6px 12px; border-radius: 6px; cursor: pointer; border: none; font-weight: 600; display: flex; align-items: center; gap: 8px; color:white; font-size: 0.85rem;}
        .btn-primary { background: var(--accent); }
        .btn-secondary { background: var(--bg-input); }
        .btn-run { background: var(--success); width: 100%; justify-content: center; padding: 12px; margin-top: auto; font-size: 1rem; }
        input[type="file"] { display: none; }

        /* LAYOUT */
        .container { display: grid; grid-template-columns: 280px 1fr; height: calc(100vh - 60px); overflow: hidden; }

        /* SIDEBAR */
        .sidebar { background-color: var(--bg-panel); border-right: 1px solid var(--border); padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .sidebar h3 { margin: 0; font-size: 0.7rem; text-transform: uppercase; color: var(--text-secondary); letter-spacing: 1px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        
        .control-group label { display: block; margin-bottom: 4px; font-size: 0.8rem; color: var(--text-secondary); }
        select, input[type="number"], input[type="date"] { width: 100%; padding: 6px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 4px; color: white; font-size: 0.85rem; }
        input[type="range"] { width: 100%; accent-color: var(--accent); height: 4px; }
        .range-display { display: flex; justify-content: space-between; color: var(--accent); font-size: 0.75rem; }

        /* NEW: MATCHUP SELECTORS */
        .matchup-selectors { display: flex; flex-direction: column; gap: 10px; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 6px; border: 1px solid var(--border); }
        .vs-badge { align-self: center; background: var(--text-secondary); color: var(--bg-main); font-size: 0.7rem; padding: 2px 6px; border-radius: 10px; font-weight: bold; }

        /* MAIN */
        .main { padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }

        /* KPIS */
        .kpi-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; flex-shrink: 0; }
        .kpi-card { background: var(--bg-panel); padding: 10px; border-radius: 6px; border: 1px solid var(--border); }
        .kpi-title { font-size: 0.75rem; color: var(--text-secondary); }
        .kpi-value { font-size: 1.2rem; font-weight: 700; margin-top: 2px; }
        .text-green { color: var(--success); }
        .text-red { color: var(--danger); }

        /* MATCHUP CARD (NUEVO) */
        .matchup-card {
            background: linear-gradient(145deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid var(--accent);
            border-radius: 8px;
            padding: 15px;
            display: none; /* Oculto por defecto */
            flex-shrink: 0;
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown { from { opacity:0; transform:translateY(-10px); } to { opacity:1; transform:translateY(0); } }

        .matchup-header { text-align: center; margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .matchup-header h2 { margin: 0; font-size: 1.1rem; color: white; }
        .matchup-header span { color: var(--text-secondary); font-size: 0.8rem; }

        .matchup-content { display: grid; grid-template-columns: 1fr auto 1fr; gap: 20px; align-items: center; }
        .team-stat-box { text-align: center; }
        .team-name { font-size: 1.1rem; font-weight: bold; color: var(--accent); margin-bottom: 5px; }
        .stat-row { display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 4px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 2px; }
        .stat-label { color: var(--text-secondary); }
        
        .vs-divider { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px; }
        .vs-circle { width: 30px; height: 30px; background: var(--accent); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem; }

        /* CHARTS & TABLES */
        .charts-section { display: flex; flex-direction: column; gap: 15px; flex-shrink: 0; }
        .chart-box-full { height: 180px; background: var(--bg-panel); border-radius: 6px; border: 1px solid var(--border); padding: 10px; }
        
        .split-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; height: 250px; }
        .panel-box { background: var(--bg-panel); border-radius: 6px; border: 1px solid var(--border); display: flex; flex-direction: column; overflow: hidden; }
        .panel-header { padding: 8px 12px; background: rgba(0,0,0,0.2); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .panel-title { font-weight: 600; font-size: 0.85rem; color: var(--text-secondary); }

        .table-scroll { overflow-y: auto; flex-grow: 1; }
        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        th { text-align: left; padding: 8px; background: #252f45; position: sticky; top: 0; color: var(--text-secondary); z-index: 1; }
        td { padding: 6px 8px; border-bottom: 1px solid var(--border); }
        tr:hover { background: rgba(255,255,255,0.03); }

        /* Loading */
        #loadingOverlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); z-index: 999; text-align: center; padding-top: 20%; }
        .spinner { font-size: 2.5rem; color: var(--accent); animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loadingOverlay"><i class="fas fa-circle-notch spinner"></i><h3 style="margin-top:15px; color:#ccc;">Procesando Datos...</h3></div>

    <header>
        <div class="brand"><i class="fas fa-trophy"></i> Backtester <span class="tag">v5.0 VS</span></div>
        <div class="url-bar">
            <input type="text" id="urlInput" class="url-input" placeholder="URL CSV (Ej: football-data.co.uk)">
            <button onclick="loadFromUrl()" class="btn btn-primary"><i class="fas fa-cloud-download-alt"></i> Cargar</button>
        </div>
        <label for="fileInput" class="btn btn-secondary"><i class="fas fa-folder-open"></i> Local</label>
        <input type="file" id="fileInput" accept=".csv">
    </header>

    <div class="container">
        <aside class="sidebar">
            <div class="matchup-selectors">
                <h3 style="border:none; margin-bottom:5px; color:white;">‚öîÔ∏è Enfrentamiento</h3>
                <div class="control-group">
                    <label>Equipo Local (Casa)</label>
                    <select id="teamHomeSelect"><option value="">Sel. Local</option></select>
                </div>
                <div class="vs-badge">VS</div>
                <div class="control-group">
                    <label>Equipo Visitante (Fuera)</label>
                    <select id="teamAwaySelect"><option value="">Sel. Visita</option></select>
                </div>
                <button class="btn btn-primary" style="width:100%; justify-content:center; margin-top:5px;" onclick="analyzeMatchup()">
                    Ver Rentabilidad
                </button>
            </div>

            <h3>Configuraci√≥n</h3>
            <div class="control-group">
                <label>Mercado</label>
                <select id="marketSelect">
                    <option value="H">Local (1)</option>
                    <option value="D">Empate (X)</option>
                    <option value="A">Visita (2)</option>
                    <option value="O25">Over 2.5 Goles</option>
                    <option value="U25">Under 2.5 Goles</option>
                </select>
            </div>

            <div class="control-group">
                <label>Gesti√≥n de Stake</label>
                <select id="stakeType">
                    <option value="flat">Plano (Fijo)</option>
                    <option value="percent">% Banca</option>
                </select>
            </div>
            <div class="control-group">
                <label>Valor / Banca</label>
                <div style="display:flex; gap:5px;">
                    <input type="number" id="stakeValue" value="1" step="0.1">
                    <input type="number" id="initialBank" value="1000">
                </div>
            </div>

            <h3>Filtros Globales</h3>
            <div class="control-group">
                <div class="range-display"><span>Cuota: <b id="lblMin">1.20</b> - <b id="lblMax">3.00</b></span></div>
                <input type="range" id="minOdds" min="1.01" max="10" step="0.01" value="1.20">
                <input type="range" id="maxOdds" min="1.01" max="20" step="0.01" value="3.00" style="margin-top:5px;">
            </div>
            <div class="control-group">
                <label>Liga</label>
                <select id="leagueSelect"><option value="all">Todas</option></select>
            </div>
            
            <button class="btn btn-run" onclick="runBacktest()"><i class="fas fa-play"></i> BACKTEST GLOBAL</button>
        </aside>

        <main class="main">
            
            <div id="matchupCard" class="matchup-card">
                <div class="matchup-header">
                    <h2>An√°lisis de Rentabilidad Contextual</h2>
                    <span id="matchupStrategy">Estrategia: Ganador Local</span>
                </div>
                <div class="matchup-content">
                    <div class="team-stat-box">
                        <div class="team-name" id="muHomeName">Arsenal</div>
                        <div style="color:#aaa; font-size:0.8rem; margin-bottom:10px;">Jugando en Casa üè†</div>
                        
                        <div class="stat-row"><span class="stat-label">Muestras:</span> <span id="muHomeBets">0</span></div>
                        <div class="stat-row"><span class="stat-label">Acierto:</span> <span id="muHomeWin">0%</span></div>
                        <div class="stat-row"><span class="stat-label">Profit:</span> <span id="muHomePL" style="font-weight:bold;">0.00</span></div>
                        <div class="stat-row"><span class="stat-label">Yield:</span> <span id="muHomeYield">0%</span></div>
                    </div>

                    <div class="vs-divider">
                        <div class="vs-circle">VS</div>
                        <div style="font-size:0.7rem; color:#666;">Historial Directo</div>
                        <div id="h2hResult" style="font-weight:bold; color:white;">-</div>
                    </div>

                    <div class="team-stat-box">
                        <div class="team-name" id="muAwayName">Chelsea</div>
                        <div style="color:#aaa; font-size:0.8rem; margin-bottom:10px;">Jugando Fuera ‚úàÔ∏è</div>
                        
                        <div class="stat-row"><span class="stat-label">Muestras:</span> <span id="muAwayBets">0</span></div>
                        <div class="stat-row"><span class="stat-label">Acierto:</span> <span id="muAwayWin">0%</span></div>
                        <div class="stat-row"><span class="stat-label">Profit:</span> <span id="muAwayPL" style="font-weight:bold;">0.00</span></div>
                        <div class="stat-row"><span class="stat-label">Yield:</span> <span id="muAwayYield">0%</span></div>
                    </div>
                </div>
            </div>

            <div class="kpi-grid">
                <div class="kpi-card"><div class="kpi-title">Apuestas (Global)</div><div class="kpi-value" id="valBets">0</div></div>
                <div class="kpi-card"><div class="kpi-title">Win Rate</div><div class="kpi-value" id="valWinRate">0%</div></div>
                <div class="kpi-card"><div class="kpi-title">Profit</div><div class="kpi-value" id="valProfit">0.00</div></div>
                <div class="kpi-card"><div class="kpi-title">Yield</div><div class="kpi-value" id="valYield">0%</div></div>
                <div class="kpi-card"><div class="kpi-title" style="color:#ef4444;">Drawdown</div><div class="kpi-value text-red" id="valDrawdown">0%</div></div>
            </div>

            <div class="charts-section">
                <div class="chart-box-full">
                    <canvas id="equityChart"></canvas>
                </div>
                
                <div class="split-row">
                    <div class="panel-box">
                        <div class="panel-header"><span class="panel-title">Por Ligas</span></div>
                        <div style="padding:10px; flex-grow:1;"><canvas id="leagueChart"></canvas></div>
                    </div>
                    <div class="panel-box">
                        <div class="panel-header"><span class="panel-title">Ranking Equipos (Profit)</span></div>
                        <div class="table-scroll">
                            <table id="teamTable">
                                <thead><tr><th>Equipo</th><th>Sit.</th><th>P/L</th></tr></thead>
                                <tbody id="teamTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel-box" style="height: 250px; flex-shrink:0;">
                <div class="panel-header"><span class="panel-title">Historial Detallado</span></div>
                <div class="table-scroll">
                    <table id="resultsTable">
                        <thead><tr><th>Fecha</th><th>Partido</th><th>Sel</th><th>Cuota</th><th>Res</th><th>P/L</th><th>Banca</th></tr></thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- VARIABLES ---
        let rawData = [];
        let chartEq=null, chartLg=null;

        // --- CARGA ---
        document.getElementById('fileInput').addEventListener('change', e=>parseCSV(e.target.files[0]));
        async function loadFromUrl() {
            const url = document.getElementById('urlInput').value.trim();
            if(!url) return alert("URL vac√≠a");
            document.getElementById('loadingOverlay').style.display='block';
            try {
                const r = await fetch('https://api.allorigins.win/raw?url='+encodeURIComponent(url));
                if(!r.ok) throw new Error();
                const t = await r.text();
                Papa.parse(t, { header:true, dynamicTyping:true, skipEmptyLines:true, complete:r=>processData(r.data) });
            } catch(e){ alert("Error cargando"); document.getElementById('loadingOverlay').style.display='none'; }
        }
        function parseCSV(f){ document.getElementById('loadingOverlay').style.display='block'; Papa.parse(f,{header:true, dynamicTyping:true, skipEmptyLines:true, complete:r=>processData(r.data)}); }

        function processData(data) {
            rawData = data.map(r => {
                if(!r.Date || !r.HomeTeam) return null;
                let d = r.Date; if(d.includes('/')) { const p=d.split('/'); d=`${p[2].length===2?'20'+p[2]:p[2]}-${p[1]}-${p[0]}`; }
                return {
                    date:d, league:r.Div, home:r.HomeTeam, away:r.AwayTeam, res:r.FTR, goalsH:r.FTHG, goalsA:r.FTAG,
                    oddsH:r.B365H||r.AvgH, oddsD:r.B365D||r.AvgD, oddsA:r.B365A||r.AvgA,
                    oddsO25:r['B365>2.5']||r.Avg25, oddsU25:r['B365<2.5']||r.Avg25_1
                };
            }).filter(x=>x && x.oddsH);

            // Llenar Selectores
            const teams = [...new Set([...rawData.map(x=>x.home), ...rawData.map(x=>x.away)])].sort();
            const populate = (id) => {
                const s = document.getElementById(id); s.innerHTML='<option value="">Seleccionar</option>';
                teams.forEach(t => s.add(new Option(t,t)));
            };
            populate('teamHomeSelect'); populate('teamAwaySelect');
            
            const lgSel = document.getElementById('leagueSelect'); lgSel.innerHTML='<option value="all">Todas</option>';
            [...new Set(rawData.map(x=>x.league))].sort().forEach(l=>lgSel.add(new Option(l,l)));

            document.getElementById('loadingOverlay').style.display='none';
            runBacktest();
        }

        // --- L√ìGICA BACKTEST ---
        function calculateProfit(row, mkt, stake, min, max) {
            let o=0, w=false;
            if(mkt==='H'){ o=row.oddsH; w=row.res==='H'; }
            else if(mkt==='D'){ o=row.oddsD; w=row.res==='D'; }
            else if(mkt==='A'){ o=row.oddsA; w=row.res==='A'; }
            else if(mkt==='O25'){ o=row.oddsO25; w=(row.goalsH+row.goalsA)>2.5; }
            else if(mkt==='U25'){ o=row.oddsU25||1.9; w=(row.goalsH+row.goalsA)<2.5; }
            
            if(!o || o<min || o>max) return null; // No Bet
            return { pnl: w ? (stake*o - stake) : -stake, won: w, odds: o };
        }

        function runBacktest() {
            if(!rawData.length) return;
            const mkt = document.getElementById('marketSelect').value;
            const stT = document.getElementById('stakeType').value;
            const stV = parseFloat(document.getElementById('stakeValue').value);
            const bank0 = parseFloat(document.getElementById('initialBank').value);
            const minO = parseFloat(document.getElementById('minOdds').value);
            const maxO = parseFloat(document.getElementById('maxOdds').value);
            const lg = document.getElementById('leagueSelect').value;

            let bank=bank0, peak=bank0, maxDD=0, wins=0, hist=[{x:'Inicio', y:bank0}], rows=[], lgP={}, tmP={};

            const filtered = rawData.filter(r => lg==='all' || r.league===lg);

            filtered.forEach(r => {
                const stake = (stT==='flat') ? stV : (bank*(stV/100));
                const res = calculateProfit(r, mkt, stake, minO, maxO);
                
                if(res) {
                    bank += res.pnl;
                    if(res.won) wins++;
                    if(bank>peak) peak=bank;
                    let dd = (peak-bank)/peak*100; if(dd>maxDD) maxDD=dd;

                    hist.push({x:r.date, y:bank});
                    rows.push({date:r.date, match:`${r.home} v ${r.away}`, sel:mkt, odds:res.odds, res:`${r.goalsH}-${r.goalsA}`, pnl:res.pnl, bank:bank});

                    if(!lgP[r.league]) lgP[r.league]=0; lgP[r.league]+=res.pnl;
                    
                    // Stats Equipos (Acumular)
                    if(!tmP[r.home]) tmP[r.home]=0; tmP[r.home]+=res.pnl;
                    if(!tmP[r.away]) tmP[r.away]=0; tmP[r.away]+=res.pnl;
                }
            });

            updateGlobalUI(hist, rows, wins, bank0, bank, maxDD, lgP, tmP);
        }

        // --- NUEVO: ANALIZADOR MATCHUP ---
        function analyzeMatchup() {
            const tH = document.getElementById('teamHomeSelect').value;
            const tA = document.getElementById('teamAwaySelect').value;
            if(!tH || !tA) return alert("Selecciona ambos equipos");

            // Obtener config actual
            const mkt = document.getElementById('marketSelect').value;
            const minO = parseFloat(document.getElementById('minOdds').value);
            const maxO = parseFloat(document.getElementById('maxOdds').value);
            const stV = 1; // Usamos stake 1u para normalizar

            // 1. Analizar Local en Casa
            let hBets=0, hWins=0, hPnl=0;
            rawData.filter(r => r.home === tH).forEach(r => {
                const res = calculateProfit(r, mkt, stV, minO, maxO);
                if(res) { hBets++; hPnl+=res.pnl; if(res.won) hWins++; }
            });

            // 2. Analizar Visita Fuera
            let aBets=0, aWins=0, aPnl=0;
            rawData.filter(r => r.away === tA).forEach(r => {
                const res = calculateProfit(r, mkt, stV, minO, maxO);
                if(res) { aBets++; aPnl+=res.pnl; if(res.won) aWins++; }
            });

            // 3. H2H Directo (Simple)
            const h2h = rawData.filter(r => (r.home===tH && r.away===tA));
            const lastMatch = h2h.length ? h2h[h2h.length-1].res + ` (${h2h[h2h.length-1].goalsH}-${h2h[h2h.length-1].goalsA})` : "N/A";

            // Renderizar Card
            document.getElementById('matchupCard').style.display = 'block';
            document.getElementById('matchupStrategy').innerText = "Estrategia Actual: " + mkt;
            
            // Fill Home
            document.getElementById('muHomeName').innerText = tH;
            document.getElementById('muHomeBets').innerText = hBets;
            document.getElementById('muHomeWin').innerText = hBets ? ((hWins/hBets)*100).toFixed(0)+'%' : '0%';
            document.getElementById('muHomePL').innerText = hPnl.toFixed(2) + 'u';
            document.getElementById('muHomePL').className = "stat-value " + (hPnl>=0?'text-green':'text-red');
            document.getElementById('muHomeYield').innerText = hBets ? ((hPnl/hBets)*100).toFixed(1)+'%' : '0%';

            // Fill Away
            document.getElementById('muAwayName').innerText = tA;
            document.getElementById('muAwayBets').innerText = aBets;
            document.getElementById('muAwayWin').innerText = aBets ? ((aWins/aBets)*100).toFixed(0)+'%' : '0%';
            document.getElementById('muAwayPL').innerText = aPnl.toFixed(2) + 'u';
            document.getElementById('muAwayPL').className = "stat-value " + (aPnl>=0?'text-green':'text-red');
            document.getElementById('muAwayYield').innerText = aBets ? ((aPnl/aBets)*100).toFixed(1)+'%' : '0%';

            document.getElementById('h2hResult').innerText = lastMatch;
        }

        // --- UI UPDATES ---
        function updateGlobalUI(hist, rows, wins, start, end, dd, lgData, tmData) {
            const tot = rows.length;
            const prof = end-start;
            
            document.getElementById('valBets').innerText = tot;
            document.getElementById('valWinRate').innerText = tot?((wins/tot)*100).toFixed(1)+'%':'0%';
            document.getElementById('valProfit').innerText = prof.toFixed(2);
            document.getElementById('valYield').innerText = tot?((prof/tot)*100).toFixed(1)+'%':'0%';
            document.getElementById('valDrawdown').innerText = '-'+dd.toFixed(2)+'%';

            // Tabla Principal
            const tb = document.getElementById('tableBody'); tb.innerHTML='';
            rows.slice(-50).reverse().forEach(r => {
                tb.innerHTML += `<tr><td>${r.date}</td><td>${r.match}</td><td>${r.sel}</td><td>${r.odds.toFixed(2)}</td><td>${r.res}</td><td class="${r.pnl>=0?'text-green':'text-red'}">${r.pnl.toFixed(2)}</td><td>${r.bank.toFixed(0)}</td></tr>`;
            });

            // Tabla Equipos
            const tbTeam = document.getElementById('teamTableBody'); tbTeam.innerHTML='';
            Object.entries(tmData).sort((a,b)=>b[1]-a[1]).slice(0,20).forEach(t => {
                tbTeam.innerHTML += `<tr><td style="color:white; font-weight:bold;">${t[0]}</td><td>Gen</td><td class="${t[1]>=0?'text-green':'text-red'}">${t[1].toFixed(2)}</td></tr>`;
            });

            renderCharts(hist, lgData);
        }

        function renderCharts(hist, lgData) {
            const ctxEq = document.getElementById('equityChart').getContext('2d');
            if(chartEq) chartEq.destroy();
            const pts = hist.length>800 ? hist.filter((_,i)=>i%5===0) : hist;
            chartEq = new Chart(ctxEq, { type:'line', data:{labels:pts.map(p=>p.x), datasets:[{data:pts.map(p=>p.y), borderColor:'#3b82f6', borderWidth:2, pointRadius:0, fill:true, backgroundColor:'rgba(59,130,246,0.1)'}]}, options:{responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{x:{display:false},y:{grid:{color:'#334155'}}}}});

            const ctxLg = document.getElementById('leagueChart').getContext('2d');
            if(chartLg) chartLg.destroy();
            const lgArr = Object.entries(lgData).sort((a,b)=>b[1]-a[1]);
            chartLg = new Chart(ctxLg, { type:'bar', data:{labels:lgArr.map(x=>x[0]), datasets:[{data:lgArr.map(x=>x[1]), backgroundColor:lgArr.map(x=>x[1]>=0?'#10b981':'#ef4444')}]}, options:{responsive:true, maintainAspectRatio:false, indexAxis:'y', plugins:{legend:{display:false}}, scales:{x:{grid:{color:'#334155'}}}}});
        }

        // Listeners Inputs
        document.getElementById('minOdds').addEventListener('input', e=>document.getElementById('lblMin').innerText=parseFloat(e.target.value).toFixed(2));
        document.getElementById('maxOdds').addEventListener('input', e=>document.getElementById('lblMax').innerText=parseFloat(e.target.value).toFixed(2));
    </script>
</body>
</html>
