<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Analizador de Patrones HT/FT - v4.0</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #3b82f6; --success: #10b981; --danger: #ef4444; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 1000px; margin: auto; }
        textarea { width: 100%; height: 150px; background: #334155; color: white; border: 1px solid #475569; border-radius: 8px; padding: 12px; font-family: monospace; }
        .btn { background: var(--accent); color: white; border: none; padding: 15px; cursor: pointer; border-radius: 6px; font-weight: bold; width: 100%; margin: 15px 0; font-size: 16px; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #334155; }
        .win { color: var(--success); font-weight: bold; }
        .loss { color: var(--danger); font-weight: bold; }
        .summary-box { padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 18px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <h1>ðŸ”¬ Analizador de Datos Betting (Corregido)</h1>
    <textarea id="dataInput" placeholder="Pega aquÃ­ tus filas de Excel..."></textarea>
    <button class="btn" onclick="process()">ANALIZAR AHORA</button>

    <div id="results" style="display:none;">
        <div id="generalStats" class="summary-box" style="background: #1e293b; border: 1px solid #3b82f6;"></div>
        
        <div class="card">
            <h3>ðŸ“Š Porcentajes por Liga</h3>
            <div id="leagueTable"></div>
        </div>

        <div class="card">
            <h3>ðŸ’° Efectividad por Cuota</h3>
            <div id="oddTable"></div>
        </div>
    </div>
</div>

<script>
function process() {
    const input = document.getElementById('dataInput').value.trim();
    if (!input) return;

    const lines = input.split('\n');
    const header = lines[0].split('\t');
    
    // Buscar Ã­ndices de forma flexible
    const findIdx = (names) => header.findIndex(h => names.some(n => h.toLowerCase().includes(n.toLowerCase())));
    
    const idxLeague = findIdx(['league', 'liga']);
    const idxOdd = findIdx(['odd']);
    
    let stats = { total: 0, wins: 0, leagues: {}, odds: {} };

    lines.slice(1).forEach(line => {
        const cols = line.split('\t').map(c => c.trim());
        if (cols.length < 3) return;

        // BÃšSQUEDA DE RESULTADO: Buscamos "Winning" en cualquier columna de la fila
        // Esto evita errores si la columna Result se mueve
        const isWin = cols.some(cell => cell.toLowerCase() === 'winning');
        
        const league = cols[idxLeague] || "Desconocida";
        const oddVal = parseFloat(cols[idxOdd]?.replace(',', '.')) || 0;
        const oddRange = oddVal ? (Math.floor(oddVal * 1.5) / 1.5).toFixed(2) : "N/A";

        stats.total++;
        if (isWin) stats.wins++;

        // Ligas
        if (!stats.leagues[league]) stats.leagues[league] = { w: 0, t: 0 };
        stats.leagues[league].t++;
        if (isWin) stats.leagues[league].w++;

        // Cuotas
        if (!stats.odds[oddRange]) stats.odds[oddRange] = { w: 0, t: 0 };
        stats.odds[oddRange].t++;
        if (isWin) stats.odds[oddRange].w++;
    });

    display(stats);
}

function display(s) {
    document.getElementById('results').style.display = 'block';
    const wrGeneral = (s.wins / s.total * 100).toFixed(1);
    
    document.getElementById('generalStats').innerHTML = `
        Acierto Total: <span class="win">${wrGeneral}%</span> (${s.wins}/${s.total} partidos)
    `;

    // Tabla Ligas
    let ligaHtml = "";
    Object.entries(s.leagues).sort((a,b) => b[1].w - a[1].w).forEach(([name, data]) => {
        const p = (data.w / data.t * 100).toFixed(0);
        ligaHtml += `<div class="row"><span>${name}</span><span class="${p > 50 ? 'win' : 'loss'}">${p}% (${data.w}/${data.t})</span></div>`;
    });
    document.getElementById('leagueTable').innerHTML = ligaHtml;

    // Tabla Cuotas
    let oddHtml = "";
    Object.entries(s.odds).sort((a,b) => a[0] - b[0]).forEach(([range, data]) => {
        const p = (data.w / data.t * 100).toFixed(0);
        oddHtml += `<div class="row"><span>Rango Cuota ${range}</span><span class="win">${p}%</span></div>`;
    });
    document.getElementById('oddTable').innerHTML = oddHtml;
}
</script>
</body>
</html>
