<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crystal Wave | Quantum Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-deep: #050810;
            --bg-side: #080d17;
            --card-glass: rgba(17, 25, 40, 0.75);
            --accent: #f47b20;
            --neon-blue: #00d2ff;
            --neon-purple: #9d50bb;
            --text-gold: #e2b714;
            --border: rgba(255, 255, 255, 0.1);
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: radial-gradient(circle at top right, #0a192f, var(--bg-deep));
            color: white;
            display: flex;
            min-height: 100vh;
            overflow: hidden;
        }

        /* SIDEBAR ESTILO BETTRACKPRO */
        .sidebar {
            width: 260px;
            background: var(--bg-side);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 25px 0;
            z-index: 100;
        }

        .brand {
            padding: 0 25px 40px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3rem;
            font-weight: 900;
            color: #fff;
            letter-spacing: 1px;
        }

        .brand i { color: var(--accent); text-shadow: 0 0 10px var(--accent); }

        .nav-link {
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            color: #6a737d;
            text-decoration: none;
            transition: 0.3s;
            font-size: 0.9rem;
            border-left: 3px solid transparent;
        }

        .nav-link:hover, .nav-link.active {
            color: white;
            background: linear-gradient(90deg, rgba(244, 123, 32, 0.1), transparent);
            border-left: 3px solid var(--accent);
        }

        /* MAIN CONTENT AREA */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }

        .glass-card {
            background: var(--card-glass);
            backdrop-filter: blur(16px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            margin-bottom: 25px;
        }

        .input-sections {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        textarea {
            width: 100%; height: 85px; background: rgba(0,0,0,0.3); border: 1px solid var(--border);
            border-radius: 10px; color: var(--neon-blue); padding: 12px; font-family: 'Consolas', monospace;
            font-size: 10px; resize: none;
        }

        .btn-quantum {
            background: linear-gradient(45deg, var(--accent), #ff9a44);
            color: white; border: none; padding: 18px; border-radius: 12px;
            font-weight: 900; cursor: pointer; width: 100%; transition: 0.4s;
            text-transform: uppercase; letter-spacing: 2px;
            box-shadow: 0 4px 15px rgba(244, 123, 32, 0.3);
        }

        .btn-quantum:hover { transform: scale(1.02); box-shadow: 0 0 25px var(--accent); }

        /* ANALYTICS GRID */
        .analytics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            display: none;
        }

        .stat-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .stat-item span { color: #8b949e; font-size: 0.85rem; }
        .stat-item b { color: var(--neon-blue); font-size: 1.1rem; }

        .probability-bar {
            height: 6px; background: #161b22; border-radius: 10px; margin-top: 8px; overflow: hidden;
        }

        .bar-fill { height: 100%; background: var(--accent); transition: 1s ease-out; width: 0%; }

        /* HEATMAP MARCADORES */
        .score-heatmap {
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 15px;
        }

        .score-tile {
            background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px;
            text-align: center; border: 1px solid var(--border); transition: 0.3s;
        }

        .score-tile:hover { background: var(--border); transform: translateY(-5px); }
        .score-tile small { display: block; color: var(--text-gold); font-weight: bold; margin-bottom: 5px; }

        .badge {
            background: var(--accent); color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px;
        }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="brand"><i class="fa-solid fa-bolt-lightning"></i> CRYSTAL WAVE</div>
        <a href="#" class="nav-link"><i class="fa-solid fa-gauge-high"></i> Dashboard</a>
        <a href="#" class="nav-link"><i class="fa-solid fa-chart-pie"></i> Estrategias</a>
        <a href="#" class="nav-link active"><i class="fa-solid fa-microchip"></i> Poisson Quantum</a>
        <a href="#" class="nav-link"><i class="fa-solid fa-scale-balanced"></i> Arbitraje</a>
        <a href="#" class="nav-link"><i class="fa-solid fa-clock-rotate-left"></i> Historial</a>
    </aside>

    <main class="main-content">
        <div class="glass-card">
            <h3 style="margin-top:0"><i class="fa-solid fa-database"></i> Ingesta de Datos</h3>
            <div class="input-sections">
                <div><label>Home Table</label><textarea id="hData" oninput="parseH()"></textarea></div>
                <div><label>Away Table</label><textarea id="vData" oninput="parseV()"></textarea></div>
                <div><label>League Average</label><textarea id="sData" oninput="parseS()"></textarea></div>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr 200px; gap:15px">
                <select id="selH" style="background:#161b22; color:white; border:1px solid var(--border); padding:10px; border-radius:8px;"></select>
                <select id="selV" style="background:#161b22; color:white; border:1px solid var(--border); padding:10px; border-radius:8px;"></select>
                <button class="btn-quantum" onclick="ignite()">Ignite Analysis</button>
            </div>
        </div>

        <div id="quantumView" class="analytics-grid">
            <div class="glass-card">
                <h3><i class="fa-solid fa-trophy"></i> Win Probability</h3>
                <div class="stat-item"><span>Victoria Local</span><b id="valPH">0%</b></div>
                <div class="probability-bar"><div class="bar-fill" id="barPH"></div></div>
                
                <div class="stat-item"><span>Empate</span><b id="valPD">0%</b></div>
                <div class="probability-bar"><div class="bar-fill" id="barPD"></div></div>
                
                <div class="stat-item"><span>Victoria Visita</span><b id="valPV">0%</b></div>
                <div class="probability-bar"><div class="bar-fill" id="barPV"></div></div>
                
                <div style="margin-top:20px">
                    <div class="stat-item"><span>Doble Oportunidad 1X</span><b id="val1X">0%</b></div>
                    <div class="stat-item"><span>Handicap Asiático (0)</span><b id="hcap0">0%</b></div>
                </div>
            </div>

            <div class="glass-card">
                <h3><i class="fa-solid fa-bullseye"></i> Goal Markets</h3>
                <div class="stat-item"><span>Over 1.5 Goles</span><b id="ov15">0%</b></div>
                <div class="stat-item"><span>Over 2.5 Goles</span><b id="ov25">0%</b></div>
                <div class="stat-item"><span>Ambos Marcan (BTTS)</span><b id="btts">0%</b></div>
                <div class="stat-item"><span>Clean Sheet Local</span><b id="csL">0%</b></div>
                
                <div style="margin-top:15px; background:rgba(0,0,0,0.3); padding:15px; border-radius:12px; text-align:center">
                    <span style="font-size:0.7rem; color:var(--accent)">EXPECTATIVA DE GOLES TOTAL</span>
                    <h2 id="totalXG" style="margin:5px 0; color:white">0.00</h2>
                </div>
            </div>

            <div class="glass-card">
                <h3><i class="fa-solid fa-gears"></i> Engineering</h3>
                <div id="auditBox" style="font-size:0.75rem; font-family:monospace; color:#8b949e">
                    Iniciando sistemas...
                </div>
            </div>

            <div class="glass-card" style="grid-column: span 3;">
                <h3><i class="fa-solid fa-fire-flame-curved"></i> Smart Heatmap (Top 10 Marcadores)</h3>
                <div id="scoreHeatmap" class="score-heatmap"></div>
            </div>
        </div>
    </main>

<script>
    let dbH = {}, dbV = {}, lH = 1.58, lV = 1.22;

    function parse(t) {
        const d = {};
        t.split('\n').forEach(line => {
            const m = line.trim().match(/^(\d+)\s+(.+?)\s+(\d+)\s+\d+\s+\d+\s+\d+\s+(\d+)\s+(\d+)/);
            if(m) { const gp = parseInt(m[3]); d[m[2].trim()] = { f: parseInt(m[4])/gp, a: parseInt(m[5])/gp }; }
        });
        return d;
    }

    function parseH() { dbH = parse(document.getElementById('hData').value); fill(); }
    function parseV() { dbV = parse(document.getElementById('vData').value); fill(); }
    function parseS() {
        const t = document.getElementById('sData').value;
        const hm = t.match(/Home goals per match:\s*([\d.]+)/);
        const am = t.match(/Away goals per match:\s*([\d.]+)/);
        if(hm) lH = parseFloat(hm[1]); if(am) lV = parseFloat(am[1]);
    }

    function fill() {
        const sh = document.getElementById('selH'); const sv = document.getElementById('selV');
        sh.innerHTML = sv.innerHTML = "";
        Object.keys(dbH).sort().forEach(t => sh.add(new Option(t, t)));
        Object.keys(dbV).sort().forEach(t => sv.add(new Option(t, t)));
    }

    function poi(k, l) {
        let f = 1; for(let i=2; i<=k; i++) f *= i;
        return (Math.pow(l, k) * Math.exp(-l)) / f;
    }

    function ignite() {
        const tH = document.getElementById('selH').value;
        const tV = document.getElementById('selV').value;
        if(!dbH[tH] || !dbV[tV]) return;

        const xH = (dbH[tH].f / lH) * (dbV[tV].a / lH) * lH;
        const xV = (dbV[tV].f / lV) * (dbH[tH].a / lV) * lV;

        document.getElementById('auditBox').innerHTML = `
            LOCAL: ${tH}<br>Att Force: ${(dbH[tH].f/lH).toFixed(2)} | Def Force: ${(dbH[tH].a/lV).toFixed(2)}<hr>
            VISITA: ${tV}<br>Att Force: ${(dbV[tV].f/lV).toFixed(2)} | Def Force: ${(dbV[tV].a/lH).toFixed(2)}<hr>
            QUANTUM xG: ${xH.toFixed(2)} vs ${xV.toFixed(2)}
        `;

        let pH=0, pD=0, pV=0, o15=0, o25=0, sc = [];
        const limit = 20;

        for(let i=0; i<=limit; i++) {
            for(let j=0; j<=limit; j++) {
                let p = poi(i, xH) * poi(j, xV);
                if(i > j) pH += p; else if(i === j) pD += p; else pV += p;
                if(i + j > 1.5) o15 += p;
                if(i + j > 2.5) o25 += p;
                if(i <= 4 && j <= 4) sc.push({ s: `${i}-${j}`, p: p });
            }
        }

        // Animación y UI
        document.getElementById('quantumView').style.display = 'grid';
        document.getElementById('valPH').innerText = (pH*100).toFixed(1) + "%";
        document.getElementById('barPH').style.width = (pH*100) + "%";
        document.getElementById('valPD').innerText = (pD*100).toFixed(1) + "%";
        document.getElementById('barPD').style.width = (pD*100) + "%";
        document.getElementById('valPV').innerText = (pV*100).toFixed(1) + "%";
        document.getElementById('barPV').style.width = (pV*100) + "%";
        
        document.getElementById('val1X').innerText = ((pH+pD)*100).toFixed(1) + "%";
        document.getElementById('hcap0').innerText = (pH/(pH+pV)*100).toFixed(1) + "%";
        document.getElementById('ov15').innerText = (o15*100).toFixed(1) + "%";
        document.getElementById('ov25').innerText = (o25*100).toFixed(1) + "%";
        document.getElementById('btts').innerText = ((1-poi(0,xH))*(1-poi(0,xV))*100).toFixed(1) + "%";
        document.getElementById('csL').innerText = (poi(0,xV)*100).toFixed(1) + "%";
        document.getElementById('totalXG').innerText = (xH + xV).toFixed(2);

        sc.sort((a,b) => b.p - a.p);
        let hHtml = "";
        sc.slice(0, 10).forEach(m => {
            hHtml += `<div class="score-tile"><small>${m.s}</small><b>${(m.p*100).toFixed(1)}%</b></div>`;
        });
        document.getElementById('scoreHeatmap').innerHTML = hHtml;
    }
</script>
</body>
</html>
