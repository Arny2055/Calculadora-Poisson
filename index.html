<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizador Pro - Home vs Away</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --accent: #38bdf8; --win: #10b981; }
        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: white; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 600px; background: var(--card); padding: 25px; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); }
        h1 { text-align: center; color: var(--accent); margin-bottom: 20px; font-size: 22px; }
        textarea { width: 100%; height: 150px; background: #0f172a; border: 1px solid #334155; border-radius: 12px; color: #94a3b8; padding: 12px; font-size: 13px; resize: none; margin-bottom: 15px; }
        .btn-group { display: flex; gap: 10px; }
        button { flex: 1; padding: 14px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-main { background: var(--accent); color: #0f172a; }
        .btn-img { background: var(--win); color: white; display: none; }
        
        /* Tarjeta de Pronóstico */
        #prediction-card { margin-top: 25px; display: none; background: linear-gradient(145deg, #1e293b, #0f172a); padding: 30px; border-radius: 20px; border: 1px solid #334155; text-align: center; }
        .teams-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .team { flex: 1; }
        .team-name { font-size: 1.2rem; font-weight: 700; min-height: 3em; display: flex; align-items: center; justify-content: center; text-transform: uppercase; color: #f8fafc; }
        .score { font-size: 4rem; font-weight: 900; color: var(--accent); line-height: 1; margin: 10px 0; }
        .vs { font-weight: 900; color: #475569; padding: 0 10px; }
        .result-badge { background: rgba(56, 189, 248, 0.1); border: 1px solid var(--accent); color: var(--accent); padding: 12px; border-radius: 10px; font-weight: 800; font-size: 1.1rem; margin-top: 10px; }
        .market-tip { margin-top: 15px; color: #94a3b8; font-size: 0.95rem; border-top: 1px solid #334155; padding-top: 15px; }
        .footer-tag { font-size: 9px; opacity: 0.4; margin-top: 20px; letter-spacing: 2px; }
    </style>
</head>
<body>

<div class="container">
    <h1>⚽ Pronóstico de Tabla</h1>
    <textarea id="dataInput" placeholder="Pega aquí toda la tabla, desde los nombres de los equipos..."></textarea>
    
    <div class="btn-group">
        <button class="btn-main" onclick="analyze()">GENERAR PRONÓSTICO</button>
        <button id="imgBtn" class="btn-img" onclick="saveImage()">DESCARGAR PNG</button>
    </div>

    <div id="prediction-card">
        <div class="teams-row">
            <div class="team">
                <div class="team-name" id="hName">EQUIPO LOCAL</div>
                <div class="score" id="hScore">0</div>
            </div>
            <div class="vs">VS</div>
            <div class="team">
                <div class="team-name" id="aName">EQUIPO VISITANTE</div>
                <div class="score" id="aScore">0</div>
            </div>
        </div>
        <div class="result-badge" id="predictionResult">CARGANDO...</div>
        <div class="market-tip" id="marketTip">Sugerencia: ---</div>
        <div class="footer-tag">AI STATS PREDICTOR PRO</div>
    </div>
</div>

<script>
function analyze() {
    const rawText = document.getElementById('dataInput').value.trim();
    if (!rawText) return;

    const lines = rawText.split('\n').map(l => l.trim()).filter(l => l !== "");
    
    // --- LÓGICA DE NOMBRES ---
    // Buscamos la línea que NO sea "Home vs Away Stats" y que tenga mucho texto (los nombres)
    let homeName = "Local";
    let awayName = "Visitante";
    
    for (let i = 0; i < lines.length; i++) {
        if (lines[i].toLowerCase().includes('home vs away')) continue;
        if (lines[i].includes('(home matches)')) break; // Paramos si ya llegamos a los paréntesis
        
        // Detectar si la línea tiene una separación grande (tab o múltiples espacios)
        let parts = lines[i].split(/\t|\s{3,}/);
        if (parts.length >= 2) {
            homeName = parts[0].trim();
            awayName = parts[1].trim();
            break;
        }
    }

    // --- LÓGICA DE ESTADÍSTICAS ---
    const getValues = (keyword) => {
        const idx = lines.findIndex(l => l.toLowerCase().includes(keyword.toLowerCase()));
        if (idx === -1) return [0, 0];
        // Los números suelen estar en la línea siguiente
        const valLine = lines[idx + 1];
        const matches = valLine.match(/(\d+(\.\d+)?)/g);
        return matches ? matches.map(Number) : [0, 0];
    };

    const gf = getValues("Goals For");
    const ga = getValues("Goals Against");
    const cs = getValues("Clean sheets");

    // Algoritmo: xG (Goles esperados)
    let xH = (gf[0] + ga[1]) / 2;
    let xA = (gf[1] + ga[0]) / 2;
    
    // Bonus por portería a cero (defensa)
    xH -= (cs[1] / 100) * 0.5;
    xA -= (cs[0] / 100) * 0.5;

    const finalH = Math.max(0, Math.round(xH + 0.1)); // +0.1 ventaja campo
    const finalA = Math.max(0, Math.round(xA));

    // Inyectar datos
    document.getElementById('hName').innerText = homeName;
    document.getElementById('aName').innerText = awayName;
    document.getElementById('hScore').innerText = finalH;
    document.getElementById('aScore').innerText = finalA;

    // Resultado
    let resText = "EMPATE TÉCNICO";
    if (finalH > finalA) resText = "GANA " + homeName.toUpperCase();
    if (finalA > finalH) resText = "GANA " + awayName.toUpperCase();
    
    document.getElementById('predictionResult').innerText = resText;
    document.getElementById('marketTip').innerHTML = `<b>Sugerencia:</b> ${(finalH + finalA >= 2.5) ? '+2.5 Goles' : '-2.5 Goles'} | Ambos Marcan: ${(gf[0]>0.8 && gf[1]>0.8) ? 'SÍ' : 'NO'}`;

    // Mostrar card y botón
    document.getElementById('prediction-card').style.display = 'block';
    document.getElementById('imgBtn').style.display = 'block';
}

function saveImage() {
    const card = document.getElementById('prediction-card');
    html2canvas(card, { backgroundColor: '#0f172a', scale: 2 }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'Pronostico_Match.png';
        link.href = canvas.toDataURL();
        link.click();
    });
}
</script>

</body>
</html>
