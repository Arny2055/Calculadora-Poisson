<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mega Calculadora Poisson de F√∫tbol</title>
    <style>
        /* Estilos para el Modo Oscuro */
        body { 
            font-family: 'Arial', sans-serif; 
            margin: 20px; 
            background-color: #1a1a1a; 
            color: #f0f0f0; 
        }
        .container { 
            max-width: 900px; 
            margin: auto; 
            background: #242424; 
            padding: 25px; 
            border-radius: 10px; 
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.7); 
        }
        h1 { 
            color: #00e0ff; /* Azul cian */
            text-align: center; 
            margin-bottom: 25px;
        }
        h2 {
            color: #a0a0a0;
            border-bottom: 1px solid #3a3a3a;
            padding-bottom: 5px;
            margin-top: 20px;
        }
        .input-group, .results-table { 
            margin-bottom: 20px; 
            padding: 15px; 
            border: 1px solid #333; 
            border-radius: 8px; 
            background-color: #2c2c2c; 
        }
        label { 
            display: block; 
            margin-top: 10px; 
            font-weight: bold; 
            color: #ccc; 
        }
        input[type="number"] { 
            width: 100%; 
            padding: 10px; 
            margin-top: 5px; 
            border: 1px solid #555; 
            border-radius: 4px; 
            box-sizing: border-box; 
            background-color: #3e3e42; 
            color: #ffffff; 
        }
        button { 
            background-color: #4CAF50; 
            color: white; 
            padding: 12px 15px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 16px; 
            margin-top: 15px; 
            width: 100%; 
            transition: background-color 0.3s;
        }
        button:hover { 
            background-color: #45a049; 
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 15px; 
        }
        th, td { 
            border: 1px solid #3a3a3a; 
            padding: 10px; 
            text-align: left; 
        }
        th { 
            background-color: #333; 
            color: #00e0ff;
        }
        td {
            background-color: #2c2c2c;
        }
        .resultado { 
            font-weight: bold; 
            color: #ffcc00; /* Amarillo/Dorado para resultados */
            font-size: 1.1em;
        }
        .score-list {
            list-style: none;
            padding: 0;
        }
        .score-list li {
            background-color: #3a3a3a;
            margin-bottom: 5px;
            padding: 8px;
            border-radius: 4px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>üî¢ Mega Calculadora Poisson de Goles</h1>

    <div class="input-group">
        <h2>üìä Promedios de Goles (Liga y Equipos)</h2>
        
        <div style="display: flex; gap: 20px;">
            <div style="flex: 1;">
                <h3>Promedios de la Liga</h3>
                <label for="gl_l">Goles Promedio Local Liga ($\text{GL}_{\text{L}}$):</label>
                <input type="number" id="gl_l" value="1.5" step="0.01">
                <label for="gl_v">Goles Promedio Visitante Liga ($\text{GL}_{\text{V}}$):</label>
                <input type="number" id="gl_v" value="1.2" step="0.01">
            </div>
            
            <div style="flex: 1;">
                <h3>Equipo Local (Home)</h3>
                <label for="gf_l">Goles a Favor Local (en casa):</label>
                <input type="number" id="gf_l" value="1.8" step="0.01">
                <label for="gc_l">Goles En Contra Local (en casa):</label>
                <input type="number" id="gc_l" value="0.9" step="0.01">
            </div>
            
            <div style="flex: 1;">
                <h3>Equipo Visitante (Away)</h3>
                <label for="gf_v">Goles a Favor Visitante (fuera):</label>
                <input type="number" id="gf_v" value="1.4" step="0.01">
                <label for="gc_v">Goles En Contra Visitante (fuera):</label>
                <input type="number" id="gc_v" value="1.3" step="0.01">
            </div>
        </div>
    </div>

    <button onclick="calcularPoisson()">Calcular TODAS las Probabilidades</button>

    <div id="resultados" class="results-table" style="display:none;">
        <h2>üéØ Goles Esperados ($\lambda$)</h2>
        <p>Local ($\lambda_{\text{L}}$): <span id="lambda_l" class="resultado"></span></p>
        <p>Visitante ($\lambda_{\text{V}}$): <span id="lambda_v" class="resultado"></span></p>

        <div style="display: flex; gap: 20px;">
            
            <div style="flex: 1;">
                <h2>üèÜ Mercados Principales</h2>
                <table>
                    <thead><tr><th>Mercado</th><th>Probabilidad</th></tr></thead>
                    <tbody>
                        <tr><td>**1X2** - Local (1)</td><td id="p_1" class="resultado"></td></tr>
                        <tr><td>**1X2** - Empate (X)</td><td id="p_x" class="resultado"></td></tr>
                        <tr><td>**1X2** - Visitante (2)</td><td id="p_2" class="resultado"></td></tr>
                        <tr><td>**Doble Opci√≥n** - 1X</td><td id="p_1x" class="resultado"></td></tr>
                        <tr><td>**Doble Opci√≥n** - X2</td><td id="p_x2" class="resultado"></td></tr>
                        <tr><td>**Doble Opci√≥n** - 12</td><td id="p_12" class="resultado"></td></tr>
                        <tr><td>**DNB** - Local (1)</td><td id="p_dnb1" class="resultado"></td></tr>
                        <tr><td>**DNB** - Visitante (2)</td><td id="p_dnb2" class="resultado"></td></tr>
                        <tr><td>**Ambos Anotan** (S√≠)</td><td id="p_btts_yes" class="resultado"></td></tr>
                        <tr><td>**Ambos Anotan** (No)</td><td id="p_btts_no" class="resultado"></td></tr>
                    </tbody>
                </table>
            </div>

            <div style="flex: 1;">
                <h2>‚öΩ Goles Totales (Over/Under)</h2>
                <table>
                    <thead><tr><th>Mercado</th><th>Probabilidad</th></tr></thead>
                    <tbody>
                        <tr><td>**Over 0.5**</td><td id="p_over05" class="resultado"></td></tr>
                        <tr><td>**Under 0.5**</td><td id="p_under05" class="resultado"></td></tr>
                        <tr><td>**Over 1.5**</td><td id="p_over15" class="resultado"></td></tr>
                        <tr><td>**Under 1.5**</td><td id="p_under15" class="resultado"></td></tr>
                        <tr><td>**Over 2.5**</td><td id="p_over25" class="resultado"></td></tr>
                        <tr><td>**Under 2.5**</td><td id="p_under25" class="resultado"></td></tr>
                        <tr><td>**Over 3.5**</td><td id="p_over35" class="resultado"></td></tr>
                        <tr><td>**Under 3.5**</td><td id="p_under35" class="resultado"></td></tr>
                        <tr><td>**Over 4.5**</td><td id="p_over45" class="resultado"></td></tr>
                        <tr><td>**Under 4.5**</td><td id="p_under45" class="resultado"></td></tr>
                        <tr><td>**Over 5.5**</td><td id="p_over55" class="resultado"></td></tr>
                        <tr><td>**Under 5.5**</td><td id="p_under55" class="resultado"></td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div style="display: flex; gap: 20px;">
            <div style="flex: 1;">
                <h2>ü•Ö Goles por Equipo (O/U)</h2>
                <table>
                    <thead><tr><th>Local</th><th>Probabilidad</th></tr></thead>
                    <tbody>
                        <tr><td>Local **Over 0.5**</td><td id="p_l_over05" class="resultado"></td></tr>
                        <tr><td>Local **Under 0.5**</td><td id="p_l_under05" class="resultado"></td></tr>
                        <tr><td>Local **Over 1.5**</td><td id="p_l_over15" class="resultado"></td></tr>
                        <tr><td>Local **Under 1.5**</td><td id="p_l_under15" class="resultado"></td></tr>
                        <tr><td>Local **Over 2.5**</td><td id="p_l_over25" class="resultado"></td></tr>
                        <tr><td>Local **Under 2.5**</td><td id="p_l_under25" class="resultado"></td></tr>
                    </tbody>
                </table>
            </div>
            
            <div style="flex: 1; padding-top: 40px;">
                <table>
                    <thead><tr><th>Visitante</th><th>Probabilidad</th></tr></thead>
                    <tbody>
                        <tr><td>Visitante **Over 0.5**</td><td id="p_v_over05" class="resultado"></td></tr>
                        <tr><td>Visitante **Under 0.5**</td><td id="p_v_under05" class="resultado"></td></tr>
                        <tr><td>Visitante **Over 1.5**</td><td id="p_v_over15" class="resultado"></td></tr>
                        <tr><td>Visitante **Under 1.5**</td><td id="p_v_under15" class="resultado"></td></tr>
                        <tr><td>Visitante **Over 2.5**</td><td id="p_v_over25" class="resultado"></td></tr>
                        <tr><td>Visitante **Under 2.5**</td><td id="p_v_under25" class="resultado"></td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <h2 style="margin-top: 30px;">ü•á Top 5 Resultados Exactos M√°s Probables</h2>
        <ul id="top_scores" class="score-list">
            </ul>
    </div>
</div>

<script>
    // --- L√≥gica Matem√°tica y de C√°lculo ---

    // Funci√≥n Factorial
    function factorial(n) {
        if (n === 0 || n === 1) return 1;
        let result = 1;
        for (let i = 2; i <= n; i++) {
            result *= i;
        }
        return result;
    }

    // Distribuci√≥n de Poisson
    function poisson(k, lambda) {
        if (lambda <= 0) return 0;
        return (Math.pow(lambda, k) * Math.exp(-lambda)) / factorial(k);
    }
    
    // Funci√≥n para formatear las probabilidades a porcentaje
    const formatP = (p) => isNaN(p) ? '0.00%' : (p * 100).toFixed(2) + '%';
    
    // Funci√≥n principal de c√°lculo
    function calcularPoisson() {
        // 1. Obtener datos de entrada
        const GL_L = parseFloat(document.getElementById('gl_l').value); 
        const GL_V = parseFloat(document.getElementById('gl_v').value); 
        const GF_L = parseFloat(document.getElementById('gf_l').value); 
        const GC_L = parseFloat(document.getElementById('gc_l').value); 
        const GF_V = parseFloat(document.getElementById('gf_v').value); 
        const GC_V = parseFloat(document.getElementById('gc_v').value); 

        if (GL_L <= 0 || GL_V <= 0) {
            alert("Los promedios de goles de la liga deben ser mayores a 0 para calcular.");
            return;
        }

        // 2. Calcular Goles Esperados (Lambda)
        const FA_L = GF_L / GL_L; // Fuerza Ataque Local
        const PD_V = GC_V / GL_L; // Potencial Defensivo Visitante
        const FA_V = GF_V / GL_V; // Fuerza Ataque Visitante
        const PD_L = GC_L / GL_V; // Potencial Defensivo Local

        const lambda_L = FA_L * PD_V * GL_L;
        const lambda_V = FA_V * PD_L * GL_V;

        document.getElementById('lambda_l').textContent = lambda_L.toFixed(3);
        document.getElementById('lambda_v').textContent = lambda_V.toFixed(3);

        // 3. Crear la Matriz de Probabilidades (hasta 6 goles)
        const MAX_GOALS = 6; 
        let p_1 = 0, p_x = 0, p_2 = 0; // 1X2
        let p_total_goles = {}; 
        let top_scores_list = []; // Para resultados exactos
        let p_local_0 = poisson(0, lambda_L);
        let p_visitante_0 = poisson(0, lambda_V);
        let p_local_under = [p_local_0];
        let p_visitante_under = [p_visitante_0];

        for (let i = 0; i <= MAX_GOALS; i++) { // Goles Local (gL)
            let p_gL = poisson(i, lambda_L);
            if (i > 0) p_local_under.push(p_local_under[i-1] + p_gL);
            
            for (let j = 0; j <= MAX_GOALS; j++) { // Goles Visitante (gV)
                let p_gV = poisson(j, lambda_V);
                if (i === 0 && j > 0) p_visitante_under.push(p_visitante_under[j-1] + p_gV);

                let p_score = p_gL * p_gV;
                top_scores_list.push({ score: `${i}-${j}`, prob: p_score });

                // Sumar para 1X2
                if (i > j) {
                    p_1 += p_score;
                } else if (i === j) {
                    p_x += p_score;
                } else {
                    p_2 += p_score;
                }

                // Sumar para Goles Totales
                const total = i + j;
                p_total_goles[total] = (p_total_goles[total] || 0) + p_score;
            }
        }

        // 4. Ajustar 1X2 para que sume 100% (manejo de la "cola")
        const p_total_scores = p_1 + p_x + p_2;
        if (p_total_scores > 0) {
            const ratio = 1 / p_total_scores;
            p_1 *= ratio;
            p_x *= ratio;
            p_2 *= ratio;
        }

        // 5. C√°lculo de Mercados Espec√≠ficos

        // Doble Oportunidad
        const p_1x = p_1 + p_x;
        const p_x2 = p_x + p_2;
        const p_12 = p_1 + p_2;

        // Draw No Bet 
        const p_dnb1 = p_1 / (1 - p_x);
        const p_dnb2 = p_2 / (1 - p_x);

        // Ambos Anotan (BTTS)
        // P(S√≠) = 1 - P(Local no anota O Visitante no anota)
        const p_0_0 = poisson(0, lambda_L) * poisson(0, lambda_V);
        const p_btts_no = poisson(0, lambda_L) + poisson(0, lambda_V) - p_0_0;
        const p_btts_yes = 1 - p_btts_no;

        // Goles Totales (Over/Under)
        let cumulativo_total = 0;
        const p_under_total = {};
        for(let t = 0; t <= 5; t++) {
            cumulativo_total += (p_total_goles[t] || 0);
            p_under_total[t + 0.5] = cumulativo_total;
        }

        // 6. Goles por Equipo (Over/Under)
        const p_l_under05 = p_local_under[0];
        const p_l_under15 = p_local_under[1];
        const p_l_under25 = p_local_under[2];

        const p_v_under05 = p_visitante_under[0];
        const p_v_under15 = p_visitante_under[1];
        const p_v_under25 = p_visitante_under[2];


        // 7. Mostrar Resultados

        // Mercados Principales
        document.getElementById('p_1').textContent = formatP(p_1);
        document.getElementById('p_x').textContent = formatP(p_x);
        document.getElementById('p_2').textContent = formatP(p_2);
        
        document.getElementById('p_1x').textContent = formatP(p_1x);
        document.getElementById('p_x2').textContent = formatP(p_x2);
        document.getElementById('p_12').textContent = formatP(p_12);
        
        document.getElementById('p_dnb1').textContent = formatP(p_dnb1);
        document.getElementById('p_dnb2').textContent = formatP(p_dnb2);
        document.getElementById('p_btts_yes').textContent = formatP(p_btts_yes);
        document.getElementById('p_btts_no').textContent = formatP(p_btts_no);
        
        // Goles Totales
        document.getElementById('p_under05').textContent = formatP(p_under_total[0.5]);
        document.getElementById('p_over05').textContent = formatP(1 - p_under_total[0.5]);
        document.getElementById('p_under15').textContent = formatP(p_under_total[1.5]);
        document.getElementById('p_over15').textContent = formatP(1 - p_under_total[1.5]);
        document.getElementById('p_under25').textContent = formatP(p_under_total[2.5]);
        document.getElementById('p_over25').textContent = formatP(1 - p_under_total[2.5]);
        document.getElementById('p_under35').textContent = formatP(p_under_total[3.5]);
        document.getElementById('p_over35').textContent = formatP(1 - p_under_total[3.5]);
        document.getElementById('p_under45').textContent = formatP(p_under_total[4.5]);
        document.getElementById('p_over45').textContent = formatP(1 - p_under_total[4.5]);
        document.getElementById('p_under55').textContent = formatP(p_under_total[5.5]);
        document.getElementById('p_over55').textContent = formatP(1 - p_under_total[5.5]);

        // Goles por Equipo
        document.getElementById('p_l_under05').textContent = formatP(p_l_under05);
        document.getElementById('p_l_over05').textContent = formatP(1 - p_l_under05);
        document.getElementById('p_l_under15').textContent = formatP(p_l_under15);
        document.getElementById('p_l_over15').textContent = formatP(1 - p_l_under15);
        document.getElementById('p_l_under25').textContent = formatP(p_l_under25);
        document.getElementById('p_l_over25').textContent = formatP(1 - p_l_under25);

        document.getElementById('p_v_under05').textContent = formatP(p_v_under05);
        document.getElementById('p_v_over05').textContent = formatP(1 - p_v_under05);
        document.getElementById('p_v_under15').textContent = formatP(p_v_under15);
        document.getElementById('p_v_over15').textContent = formatP(1 - p_v_under15);
        document.getElementById('p_v_under25').textContent = formatP(p_v_under25);
        document.getElementById('p_v_over25').textContent = formatP(1 - p_v_under25);
        
        // Top 5 Resultados Exactos
        top_scores_list.sort((a, b) => b.prob - a.prob);
        const top_5 = top_scores_list.slice(0, 5);
        
        const top_scores_ul = document.getElementById('top_scores');
        top_scores_ul.innerHTML = ''; // Limpiar lista anterior
        top_5.forEach(item => {
            const li = document.createElement('li');
            li.innerHTML = `**${item.score}** - Probabilidad: <span class="resultado">${formatP(item.prob)}</span>`;
            top_scores_ul.appendChild(li);
        });

        document.getElementById('resultados').style.display = 'block';
    }
</script>

</body>
</html>
