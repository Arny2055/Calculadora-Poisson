<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pronosticador HT - Poisson</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f7f6; color: #333; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; }
        .match-selector { display: flex; gap: 20px; margin-bottom: 30px; justify-content: space-around; }
        .team-box { display: flex; flex-direction: column; width: 45%; }
        select { padding: 10px; border-radius: 5px; border: 1px solid #ddd; font-size: 16px; }
        button { display: block; width: 100%; padding: 15px; background: #27ae60; color: white; border: none; border-radius: 5px; font-size: 18px; cursor: pointer; transition: 0.3s; }
        button:hover { background: #219150; }
        .results { margin-top: 30px; display: none; }
        .result-card { background: #f9f9f9; padding: 15px; border-left: 5px solid #27ae60; margin-bottom: 15px; }
        .prob-bar { background: #e0e0e0; height: 10px; border-radius: 5px; margin-top: 5px; overflow: hidden; }
        .prob-fill { background: #27ae60; height: 100%; width: 0%; transition: width 0.5s; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background: #eee; }
    </style>
</head>
<body>

<div class="container">
    <h1>HT Goals Predictor</h1>
    <p style="text-align: center;">Basado en estadísticas de la primera mitad (Home/Away)</p>

    <div class="match-selector">
        <div class="team-box">
            <label>Local (Home)</label>
            <select id="homeTeam"></select>
        </div>
        <div class="team-box">
            <label>Visitante (Away)</label>
            <select id="awayTeam"></select>
        </div>
    </div>

    <button onclick="calculateHT()">Analizar Probabilidades HT</button>

    <div id="results" class="results">
        <div class="result-card">
            <h3>Expectativa de Goles al Descanso</h3>
            <p id="expGoals"></p>
        </div>

        <div class="result-card">
            <h3>Mercados Over/Under HT</h3>
            <div id="markets"></div>
        </div>

        <div class="result-card">
            <h3>Marcador Exacto HT (Top 5)</h3>
            <table id="scoreTable">
                <thead>
                    <tr><th>Marcador</th><th>Probabilidad</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
// Data basada en tu tabla
const teamData = {
    "Arsenal": { hScored: 1.00, hConceded: 0.13, aScored: 0.44, aConceded: 0.33 },
    "Aston Villa": { hScored: 0.78, hConceded: 0.33, aScored: 0.50, aConceded: 1.00 },
    "Bournemouth": { hScored: 0.44, hConceded: 0.22, aScored: 1.00, aConceded: 1.13 },
    "Brentford": { hScored: 0.75, hConceded: 0.50, aScored: 0.33, aConceded: 1.00 },
    "Brighton": { hScored: 0.67, hConceded: 0.56, aScored: 0.13, aConceded: 0.88 },
    "Burnley": { hScored: 0.38, hConceded: 0.88, aScored: 0.44, aConceded: 1.00 },
    "Chelsea": { hScored: 0.75, hConceded: 0.13, aScored: 0.56, aConceded: 0.89 },
    "Crystal Palace": { hScored: 0.50, hConceded: 0.38, aScored: 0.56, aConceded: 0.44 },
    "Everton": { hScored: 0.56, hConceded: 0.78, aScored: 0.50, aConceded: 0.63 },
    "Fulham": { hScored: 0.67, hConceded: 0.56, aScored: 0.63, aConceded: 0.63 },
    "Leeds Utd": { hScored: 1.00, hConceded: 0.22, aScored: 0.50, aConceded: 1.00 },
    "Liverpool": { hScored: 0.63, hConceded: 0.25, aScored: 0.22, aConceded: 0.67 },
    "Manchester City": { hScored: 1.33, hConceded: 0.44, aScored: 1.13, aConceded: 0.25 },
    "Manchester Utd": { hScored: 1.11, hConceded: 0.33, aScored: 0.67, aConceded: 0.67 },
    "Newcastle Utd": { hScored: 0.78, hConceded: 0.11, aScored: 0.56, aConceded: 0.44 },
    "Nottm Forest": { hScored: 0.63, hConceded: 0.50, aScored: 0.22, aConceded: 0.89 },
    "Sunderland": { hScored: 0.38, hConceded: 0.38, aScored: 0.22, aConceded: 0.56 },
    "Tottenham": { hScored: 0.44, hConceded: 0.67, aScored: 0.75, aConceded: 0.75 },
    "West Ham Utd": { hScored: 0.75, hConceded: 1.00, aScored: 0.22, aConceded: 0.67 },
    "Wolverhampton": { hScored: 0.67, hConceded: 1.11, aScored: 0.00, aConceded: 0.50 }
};

const leagueAvgHT = 0.59; // Promedio general de la liga al HT

// Poblar selectores
const homeSelect = document.getElementById('homeTeam');
const awaySelect = document.getElementById('awayTeam');

Object.keys(teamData).sort().forEach(team => {
    homeSelect.add(new Option(team, team));
    awaySelect.add(new Option(team, team));
});

// Función de Poisson
function poisson(k, lambda) {
    return (Math.exp(-lambda) * Math.pow(lambda, k)) / factorial(k);
}

function factorial(n) {
    if (n === 0 || n === 1) return 1;
    let res = 1;
    for (let i = 2; i <= n; i++) res *= i;
    return res;
}

function calculateHT() {
    const home = document.getElementById('homeTeam').value;
    const away = document.getElementById('awayTeam').value;
    
    // Cálculo de xG (Expectativa de goles) para HT
    // Fórmula: (Goles Marcados Local / Promedio Liga) * (Goles Recibidos Visitante / Promedio Liga) * Promedio Liga
    const homeExpHT = (teamData[home].hScored / leagueAvgHT) * (teamData[away].aConceded / leagueAvgHT) * leagueAvgHT;
    const awayExpHT = (teamData[away].aScored / leagueAvgHT) * (teamData[home].hConceded / leagueAvgHT) * leagueAvgHT;

    const totalExp = homeExpHT + awayExpHT;

    // Mostrar resultados
    document.getElementById('results').style.display = 'block';
    document.getElementById('expGoals').innerHTML = `Local: <b>${homeExpHT.toFixed(2)}</b> | Visitante: <b>${awayExpHT.toFixed(2)}</b><br>Total esperado: <b>${totalExp.toFixed(2)}</b>`;

    // Calcular Probabilidades por marcador (hasta 3 goles cada uno en HT)
    let matrix = [];
    let prob05 = 0;
    let prob15 = 0;

    for (let h = 0; h <= 3; h++) {
        for (let a = 0; a <= 3; a++) {
            let p = poisson(h, homeExpHT) * poisson(a, awayExpHT);
            matrix.push({ score: `${h} - ${a}`, prob: p });
            if (h + a > 0.5) prob05 += p;
            if (h + a > 1.5) prob15 += p;
        }
    }

    // Dibujar Mercados
    document.getElementById('markets').innerHTML = `
        <div>Over 0.5 HT: ${(prob05 * 100).toFixed(1)}% <div class="prob-bar"><div class="prob-fill" style="width:${prob05 * 100}%"></div></div></div>
        <div style="margin-top:10px">Over 1.5 HT: ${(prob15 * 100).toFixed(1)}% <div class="prob-bar"><div class="prob-fill" style="width:${prob15 * 100}%"></div></div></div>
    `;

    // Dibujar Tabla de Marcadores
    matrix.sort((a, b) => b.prob - a.prob);
    const tbody = document.querySelector('#scoreTable tbody');
    tbody.innerHTML = '';
    matrix.slice(0, 5).forEach(m => {
        const row = `<tr><td>${m.score}</td><td>${(m.prob * 100).toFixed(1)}%</td></tr>`;
        tbody.innerHTML += row;
    });
}
</script>

</body>
</html>
