<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>XLS a JSON</title>
<style>
  body { font-family: Arial, sans-serif; background:#0d1117; color:#e6edf3; text-align:center; padding:40px; }
  input, button { margin:20px 10px; padding:10px 15px; border:none; border-radius:5px; cursor:pointer; }
  input { background:#21262d; color:#e6edf3; }
  button { background:#238636; color:#fff; font-weight:bold; }
  button:hover { background:#2ea043; }
  textarea { width:90%; height:400px; margin-top:20px; background:#161b22; color:#e6edf3; border:1px solid #30363d; padding:10px; font-family: monospace; }
</style>
</head>
<body>
  <h2>Convertir XLS/XLSX a JSON</h2>
  <input type="file" id="fileInput" accept=".xls,.xlsx" />
  <button id="downloadBtn" disabled>Descargar JSON</button>
  <br>
  <textarea id="output" placeholder="Aquí aparecerá el JSON..."></textarea>

  <!-- Librería XLSX desde CDN -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script>
    let jsonResult = null;
    let fileName = "convertido.json"; // nombre por defecto

    document.getElementById('fileInput').addEventListener('change', function(e){
      const file = e.target.files[0];
      if(!file) return;

      // Guardamos el nombre base del archivo
      fileName = file.name.replace(/\.[^/.]+$/, "") + ".json";

      const reader = new FileReader();
      reader.onload = function(e){
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type: 'array'});

        // Convierte cada hoja a JSON
        const result = {};
        workbook.SheetNames.forEach(sheetName => {
          const sheet = workbook.Sheets[sheetName];
          result[sheetName] = XLSX.utils.sheet_to_json(sheet, {defval:null});
        });

        jsonResult = result;
        document.getElementById('output').value = JSON.stringify(result, null, 2);
        document.getElementById('downloadBtn').disabled = false;
      };
      reader.readAsArrayBuffer(file);
    });

    document.getElementById('downloadBtn').addEventListener('click', function(){
      if(!jsonResult) return;

      const blob = new Blob([JSON.stringify(jsonResult, null, 2)], {type: "application/json"});
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = fileName; // ahora conserva el nombre original
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>