<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Calculadora de Overround — OU / BTTS / 1X2 / N-way</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
<style>
  :root{
    --bg:#0f1115; --panel:#171a21; --panel2:#1f2430; --text:#e8ecf3; --muted:#9aa3b2;
    --accent:#7aa2ff; --accent2:#5dd4a4; --warn:#ffb84d; --danger:#ff6b6b; --ok:#79e2a6; --border:#2a3140;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif; background:linear-gradient(180deg,#0f1115 0%,#121622 100%); color:var(--text)}
  header{padding:20px 16px; border-bottom:1px solid var(--border); background:#10141d; position:sticky; top:0; z-index:5}
  h1{margin:0; font-size:18px; letter-spacing:.3px}
  .wrap{max-width:1100px; margin:0 auto; padding:16px}
  .grid{display:grid; gap:16px}
  @media(min-width:900px){ .grid-cols-2{grid-template-columns:1fr 1fr}}
  .card{background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:14px}
  .card h2{margin:.2rem 0 .8rem; font-size:16px}
  label{font-size:12px; color:var(--muted); display:block; margin:.25rem 0 .35rem}
  input[type="text"],input[type="number"],textarea,select{
    width:100%; background:var(--panel2); color:var(--text); border:1px solid var(--border); border-radius:10px;
    padding:10px 12px; outline:none; font-size:14px;
  }
  textarea{min-height:110px; resize:vertical}
  .btn{display:inline-flex; align-items:center; gap:8px; border:1px solid var(--border); background:#111827; color:var(--text);
       padding:10px 12px; border-radius:10px; cursor:pointer; text-decoration:none; font-size:14px; user-select:none}
  .btn.primary{background:linear-gradient(90deg,#2647ff,#1fa37e); border-color:transparent}
  .btn.ghost{background:transparent}
  .btn.small{padding:6px 10px; font-size:12px}
  .links{display:flex; gap:8px; flex-wrap:wrap}
  .muted{color:var(--muted)}
  .tiny{font-size:11px}
  .sep{height:1px; background:var(--border); margin:12px 0}
  .badge{display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; border:1px solid var(--border)}
  .badge.accept{background:rgba(121,226,166,.1); color:var(--accent2); border-color:#2a5747}
  .badge.medium{background:rgba(255,184,77,.1); color:var(--warn); border-color:#5a4b2b}
  .badge.bad{background:rgba(255,107,107,.1); color:var(--danger); border-color:#5a2b2b}
  table{width:100%; border-collapse:separate; border-spacing:0}
  th,td{padding:10px 12px; border-bottom:1px solid var(--border); text-align:left; font-size:14px; white-space:nowrap}
  th{color:var(--muted); font-weight:600; font-size:12px}
  .right{text-align:right}
  .flex{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .pill{padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:rgba(255,255,255,.03)}
  .copy{cursor:pointer; text-decoration:underline; font-size:12px; color:var(--accent)}
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="flex" style="justify-content:space-between">
        <h1>Calculadora de Overround</h1>
        <div class="links">
          <a class="btn" href="./" aria-label="Volver">← Volver</a>
        </div>
      </div>
    </div>
  </header>

  <div class="wrap grid grid-cols-2">
    <!-- Entrada -->
    <section class="card">
      <h2>1) Introduce cuotas</h2>
      <div class="grid">
        <div>
          <label for="txtOdds">Cuotas decimales (separadas por espacios, comas o saltos de línea)</label>
          <textarea id="txtOdds" placeholder="Ejemplos:
1.95 1.85   (OU/BTTS)
2.50, 3.30, 3.00   (1X2)
1.40
3.80
8.50"></textarea>
          <div class="tiny muted" style="margin-top:6px">Solo cuotas decimales &gt; 1.00. Ignoramos vacíos/ceros.</div>
        </div>

        <div class="flex">
          <button class="btn small" id="btnOU">Plantilla OU: 1.95 / 1.85</button>
          <button class="btn small" id="btnBTTS">Plantilla BTTS: 1.95 / 1.85</button>
          <button class="btn small" id="btn1X2">Plantilla 1X2: 2.40 / 3.30 / 3.10</button>
          <button class="btn small" id="btnClear">Limpiar</button>
        </div>

        <div>
          <label for="decimals">Decimales de salida</label>
          <input type="number" id="decimals" min="0" max="6" step="1" value="2" />
        </div>
      </div>
      <div class="sep"></div>
      <div class="flex">
        <button class="btn primary" id="btnCalc">Calcular</button>
        <span class="tiny muted">Se recalcula automáticamente al escribir.</span>
      </div>
    </section>

    <!-- Resultados -->
    <section class="card">
      <h2>2) Resultados</h2>

      <div class="flex" style="margin-bottom:8px">
        <span class="pill">Suma implícita (Σ1/odd): <b id="sumImp">—</b></span>
        <span class="pill">Overround: <b id="ovPct">—</b> <span id="ovBadge" class="badge" style="margin-left:8px; display:none"></span></span>
      </div>

      <div class="tiny muted">Overround = Σ(1/odd) − 1. Si es 0% no hay margen. 3%–6% medio, &gt;6% alto.</div>

      <div class="sep"></div>
      <h3 class="tiny" style="margin:0 0 6px">Desglose (probabilidades y cuotas “justas”)</h3>
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th class="right">Cuota</th>
            <th class="right">Prob. implícita</th>
            <th class="right">Prob. justa</th>
            <th class="right">Cuota justa</th>
          </tr>
        </thead>
        <tbody id="tblBody"></tbody>
      </table>
      <div class="flex" style="margin-top:10px">
        <span class="tiny muted">La prob. “implícita” es 1/odd. La “justa” es (1/odd)/(1+overround). Cuota justa = 1 / prob. justa.</span>
      </div>

      <div class="sep"></div>
      <div class="flex">
        <a class="btn" id="btnCopyOdds">Copiar cuotas justas</a>
        <a class="btn" id="btnCopyProbs">Copiar probabilidades justas</a>
      </div>
    </section>
  </div>

<script>
(() => {
  "use strict";

  const $ = s => document.querySelector(s);
  const txtOdds = $("#txtOdds");
  const decimals = $("#decimals");
  const sumImp = $("#sumImp");
  const ovPct = $("#ovPct");
  const ovBadge = $("#ovBadge");
  const tbody = $("#tblBody");

  // Badges de overround
  function badgeClass(or){
    if(!isFinite(or)) return ["", ""];
    if(or > 0.06) return ["badge bad", "No aceptable"];
    if(or > 0.03) return ["badge medium", "Medio"];
    return ["badge accept", "Aceptable"];
  }

  function parseOdds(text){
    const parts = (text||"")
      .split(/[\s,;]+/)
      .map(x => x.trim())
      .filter(Boolean)
      .map(Number)
      .filter(x => isFinite(x) && x > 1.000001);
    return parts;
  }

  function fmt(x, d=2){
    if(!isFinite(x)) return "—";
    return Number(x).toFixed(d);
  }
  function pct(x, d=2){
    if(!isFinite(x)) return "—";
    return (100*x).toFixed(d) + "%";
  }

  function compute(){
    const d = Math.max(0, Math.min(6, Number(decimals.value)||2));
    const odds = parseOdds(txtOdds.value);
    tbody.innerHTML = "";
    if(!odds.length){
      sumImp.textContent = "—";
      ovPct.textContent = "—";
      ovBadge.style.display = "none";
      return;
    }

    // Suma de probabilidades implícitas
    const probsImp = odds.map(o => 1/o);
    const s = probsImp.reduce((a,b)=>a+b, 0);
    const overround = Math.max(0, s - 1);

    sumImp.textContent = fmt(s, d);
    ovPct.textContent = pct(overround, 2);

    const [cls, label] = badgeClass(overround);
    ovBadge.className = cls + " badge";
    ovBadge.textContent = label;
    ovBadge.style.display = "inline-block";

    // Probabilidades justas (normalizadas) y cuotas justas
    // prob_justa = prob_imp / (1 + overround)
    const norm = 1 + overround || 1;
    const probsFair = probsImp.map(p => p / norm);
    const oddsFair = probsFair.map(p => p>0 ? 1/p : NaN);

    // Render tabla
    odds.forEach((o, i) => {
      const tr = document.createElement("tr");

      const tdIdx = document.createElement("td");
      tdIdx.textContent = String(i+1);
      tr.appendChild(tdIdx);

      const tdOdd = document.createElement("td");
      tdOdd.className = "right";
      tdOdd.textContent = fmt(o, d);
      tr.appendChild(tdOdd);

      const tdPi = document.createElement("td");
      tdPi.className = "right";
      tdPi.textContent = pct(probsImp[i], 2);
      tr.appendChild(tdPi);

      const tdPf = document.createElement("td");
      tdPf.className = "right";
      tdPf.textContent = pct(probsFair[i], 2);
      tr.appendChild(tdPf);

      const tdOf = document.createElement("td");
      tdOf.className = "right";
      tdOf.textContent = fmt(oddsFair[i], d);
      tr.appendChild(tdOf);

      tbody.appendChild(tr);
    });

    // Handlers de copiar
    $("#btnCopyOdds").onclick = () => {
      const text = oddsFair.map(o => fmt(o, d)).join(" ");
      navigator.clipboard.writeText(text).then(()=> alert("✅ Cuotas justas copiadas."));
    };
    $("#btnCopyProbs").onclick = () => {
      const text = probsFair.map(p => (100*p).toFixed(2) + "%").join(" ");
      navigator.clipboard.writeText(text).then(()=> alert("✅ Probabilidades justas copiadas."));
    };
  }

  // Plantillas
  $("#btnOU").addEventListener("click", () => {
    txtOdds.value = "1.95 1.85";
    compute();
  });
  $("#btnBTTS").addEventListener("click", () => {
    txtOdds.value = "1.95 1.85";
    compute();
  });
  $("#btn1X2").addEventListener("click", () => {
    txtOdds.value = "2.40 3.30 3.10";
    compute();
  });
  $("#btnClear").addEventListener("click", () => {
    txtOdds.value = "";
    compute();
  });

  // Eventos
  $("#btnCalc").addEventListener("click", compute);
  txtOdds.addEventListener("input", compute);
  decimals.addEventListener("input", compute);

  // Init
  compute();
})();
</script>
</body>
</html>
